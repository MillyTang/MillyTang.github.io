<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Comfortably Numb">
<meta property="og:url" content="https://github.com/MillyTang/MillyTang.github.io/index.html">
<meta property="og:site_name" content="Comfortably Numb">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="主体-客体联合创作">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://github.com/MillyTang/MillyTang.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Comfortably Numb</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Comfortably Numb</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">反方向的钟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2022/01/04/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/04/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">2021年终总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-04 10:47:05 / 修改时间：10:47:22" itemprop="dateCreated datePublished" datetime="2022-01-04T10:47:05+08:00">2022-01-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>人类一败涂地</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2022/01/04/VScode%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/04/VScode%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">VScode常用快捷键</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-04 10:27:00" itemprop="dateCreated datePublished" datetime="2022-01-04T10:27:00+08:00">2022-01-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2022/01/04/React-17-Router-16%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/04/React-17-Router-16%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">React@17 & Router@16 项目总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-04 10:25:57" itemprop="dateCreated datePublished" datetime="2022-01-04T10:25:57+08:00">2022-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-07 15:59:47" itemprop="dateModified" datetime="2022-01-07T15:59:47+08:00">2022-01-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="重表单功能项目"><a href="#重表单功能项目" class="headerlink" title="重表单功能项目"></a>重表单功能项目</h2><p>整个项目80%都是填写表单，一开始没防备，生写新建和编辑，痛苦不堪，后来上了 antd 的 Form 表单组件好多了，但是时间紧迫改的又急，业务代码变的很混乱，先记录一下重构思路</p>
<h3 id="示例组件：-1个parent组件-3个child组件，其中，某个child还嵌套了2层，层级较深"><a href="#示例组件：-1个parent组件-3个child组件，其中，某个child还嵌套了2层，层级较深" class="headerlink" title="示例组件： 1个parent组件+3个child组件，其中，某个child还嵌套了2层，层级较深"></a>示例组件： 1个parent组件+3个child组件，其中，某个child还嵌套了2层，层级较深</h3><h4 id="页面卡顿，function-函数组件的UI更新问题"><a href="#页面卡顿，function-函数组件的UI更新问题" class="headerlink" title="页面卡顿，function 函数组件的UI更新问题"></a>页面卡顿，function 函数组件的UI更新问题</h4><h4 id="页面卡顿，children-组件被重复渲染-使用-useMemo-amp-useCallback-amp-useReducer-替换-useState"><a href="#页面卡顿，children-组件被重复渲染-使用-useMemo-amp-useCallback-amp-useReducer-替换-useState" class="headerlink" title="页面卡顿，children 组件被重复渲染: 使用 useMemo &amp; useCallback &amp; useReducer 替换 useState"></a>页面卡顿，children 组件被重复渲染: 使用 useMemo &amp; useCallback &amp; useReducer 替换 useState</h4><h4 id="页面卡顿，child-的-useEffect-狂刷页面，因为有依赖是多层嵌套引用对象类型"><a href="#页面卡顿，child-的-useEffect-狂刷页面，因为有依赖是多层嵌套引用对象类型" class="headerlink" title="页面卡顿，child 的 useEffect 狂刷页面，因为有依赖是多层嵌套引用对象类型"></a>页面卡顿，child 的 useEffect 狂刷页面，因为有依赖是多层嵌套引用对象类型</h4><h4 id="useEffect-内部接口请求的处理-外部请求-出现2个相同定义函数-冗余代码"><a href="#useEffect-内部接口请求的处理-外部请求-出现2个相同定义函数-冗余代码" class="headerlink" title="useEffect 内部接口请求的处理 + 外部请求 = 出现2个相同定义函数 = 冗余代码"></a>useEffect 内部接口请求的处理 + 外部请求 = 出现2个相同定义函数 = 冗余代码</h4><h2 id="类型复用逻辑"><a href="#类型复用逻辑" class="headerlink" title="类型复用逻辑"></a>类型复用逻辑</h2><blockquote>
<p>type &amp;&amp; interface 的使用，考虑项目中类型，简短的可做基础类型的优先考虑 type， 浏览器请求接口的参数和返回值的类型使用 interface，函数&amp;其他变量，集合类型 优先使用 type</p>
</blockquote>
<blockquote>
<p>type和interface 区别在于：inteface无法应用于union type | intersection type | conditional type | tuple，但是可以 augumented 而type不行</p>
</blockquote>
<blockquote>
<p>把类型当作值的集合，理解 类型中的 union type - 交集 和 intersection type -并集</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// type</span></span><br><span class="line"><span class="keyword">type</span> AB = <span class="string">&#x27;A&#x27;</span> | <span class="string">&#x27;B&#x27;</span> <span class="comment">// union type 并集</span></span><br><span class="line"><span class="keyword">type</span> NamedVariable = &#123;age: <span class="built_in">number</span>&#125; &amp; &#123; name: <span class="built_in">string</span>&#125; <span class="comment">// intersection type 交集</span></span><br><span class="line"><span class="keyword">type</span> mytuple = [<span class="built_in">number</span>, <span class="built_in">string</span>] <span class="comment">// tuple元组</span></span><br><span class="line"><span class="comment">// inteface</span></span><br><span class="line"><span class="comment">// a.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> BaseInfo &#123;</span><br><span class="line">  name :<span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// b.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; BaseInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/a.ts&#x27;</span></span><br><span class="line"><span class="keyword">interface</span> BaseInfo &#123;</span><br><span class="line">  phoneNum: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> base: BaseInfo = &#123;</span><br><span class="line">  name: <span class="string">&#x27;xx&#x27;</span>,</span><br><span class="line">  age: <span class="number">21</span>,</span><br><span class="line">  phoneNum: <span class="string">&#x27;19xxxxxxxxx&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 把类型当作值的集合</span></span><br><span class="line"><span class="keyword">type</span> AA = &#123;aa: <span class="string">&#x27;A&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">type</span> BB = &#123;bb: <span class="string">&#x27;B&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">type</span> ABor = AA | BB</span><br><span class="line"><span class="keyword">type</span> ABand = AA &amp; BB</span><br><span class="line"><span class="keyword">type</span> AAkeys = keyof AA <span class="comment">// &#x27;aa&#x27;</span></span><br><span class="line"><span class="keyword">type</span> BBkeys = keyof BB <span class="comment">// &#x27;bb&#x27;</span></span><br><span class="line"><span class="keyword">type</span> ABandKeys = keyof ABand <span class="comment">// &#x27;aa&#x27; | &#x27;bb&#x27;, keyof ABand === (keyof AAkeys) | (keyof BBkeys)</span></span><br><span class="line"><span class="keyword">type</span> ABorKeys = keyof ABor <span class="comment">// never, keyof ABor === (keyof AAkeys) &amp; (keyof BBkeys)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aaa: ABand = &#123;</span><br><span class="line">  aa: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">  bb: <span class="string">&#x27;B&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="useEffect-基于-useMemo-amp-useCallback-导致的更新问题"><a href="#useEffect-基于-useMemo-amp-useCallback-导致的更新问题" class="headerlink" title="useEffect: 基于 useMemo &amp; useCallback 导致的更新问题"></a>useEffect: 基于 useMemo &amp; useCallback 导致的更新问题</h2><p>写Vue3写多了，初次写React项目很不适应，首先面临的一个大问题就是 useEffect 更新 child 组件，数次进入无限循环，把浏览器搞崩了。由于我本人首次写 React 上了强 debuff, 导致首次写的 react 项目业务代码一坨屎，本人痛定思痛，决定对业务代码脱敏后重构一次，以彰显写更棒的代码的决心</p>
<h2 id="改进：-考虑使用-immutable-js"><a href="#改进：-考虑使用-immutable-js" class="headerlink" title="改进： 考虑使用 immutable.js"></a>改进： 考虑使用 immutable.js</h2><h2 id="改进后：-思考-Class-组件-🆚-函数组件-的便利性"><a href="#改进后：-思考-Class-组件-🆚-函数组件-的便利性" class="headerlink" title="改进后： 思考 Class 组件 🆚 函数组件 的便利性"></a>改进后： 思考 Class 组件 🆚 函数组件 的便利性</h2><blockquote>
<p>Class &amp; enum 横跨值&amp;类型</p>
</blockquote>
<h2 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h2><ol>
<li>使用 Vue3 实现相似功能</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/12/07/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/07/hello-world/" class="post-title-link" itemprop="url">Hexo & travis bot坑爹的自动部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-07 14:15:23" itemprop="dateCreated datePublished" datetime="2021-12-07T14:15:23+08:00">2021-12-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="没有修改主题前的自动部署流程十分顺滑"><a href="#没有修改主题前的自动部署流程十分顺滑" class="headerlink" title="没有修改主题前的自动部署流程十分顺滑"></a>没有修改主题前的自动部署流程十分顺滑</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># git:main 分支</span></span><br><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br><span class="line">$ git add .</span><br><span class="line">$ git commit msg</span><br><span class="line">$ git push</span><br><span class="line"><span class="comment"># 剩下的交给travis.bot发布到gh-pages分支</span></span><br></pre></td></tr></table></figure>

<h2 id="一切变故来源于更换了更好看的主题"><a href="#一切变故来源于更换了更好看的主题" class="headerlink" title="一切变故来源于更换了更好看的主题"></a>一切变故来源于更换了更好看的主题</h2><p>  同样操作一遍，线上的直接404，在.travis.yml脚本中增加了 npm install,就此成功了一次，当第三次推送时又不行了，本地server完全OK，查看node版本，换成.travis.yml中的10.22.0,再clean掉，不行，第五次，第六次，尝试了多种办法还是不行，一气之下改成私有部署，本地1个命令，真香。</p>
<h3 id="推荐私有部署-hexo-deployer-git-再无头秃烦恼"><a href="#推荐私有部署-hexo-deployer-git-再无头秃烦恼" class="headerlink" title="推荐私有部署 hexo-deployer-git 再无头秃烦恼"></a>推荐私有部署 hexo-deployer-git 再无头秃烦恼</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="comment"># your-git-repo-url</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">$GH_TOKEN</span> <span class="comment"># 你的token, 跟在travis.com上配置是同一个token,这里写token名：$GH_TOKEN</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">gh-pages</span> <span class="comment"># 发布分支</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置完成后接下来命令行：直接一个命令</span></span><br><span class="line">$ npx hexo clean &amp;&amp; npx hexo deploy</span><br><span class="line"><span class="comment"># 接下来就是vscode-auth =&gt; github.com的认证过程，按照提示操作即可</span></span><br><span class="line"><span class="comment"># 如果碰到 关键字中有 LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to github.com:443错误，更换网络，不要用流量</span></span><br><span class="line"><span class="comment"># 如果碰到 Authentication failed for &#x27;https://github.com/xxx/xxx.github.io/&#x27;，那就是travis上配置的$ $GH_TOKEN与.config.yml中的不一致</span></span><br><span class="line"><span class="comment"># 这两个问题都没碰到，基本成功</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/12/05/fast-to-know-new-project/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/05/fast-to-know-new-project/" class="post-title-link" itemprop="url">精卫填海-新编</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-05 22:13:04" itemprop="dateCreated datePublished" datetime="2021-12-05T22:13:04+08:00">2021-12-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-07 14:15:23" itemprop="dateModified" datetime="2021-12-07T14:15:23+08:00">2021-12-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="第一章-预言成真"><a href="#第一章-预言成真" class="headerlink" title="第一章 预言成真"></a>第一章 预言成真</h2><blockquote>
<p>炎帝之少女-女娃好游泳，已有西方上帝赠与的开光水晶球预示其将溺亡，其父及众人忧心忡忡勒令少女禁止下水，少女忤逆，于预言10年后在东海溺亡。</p>
</blockquote>
<p>女娃死了，炎帝命人在三界搜寻其魂魄。最终在发鸠之山发现了新生的女娃，名曰精卫，可惜肉身损坏不能还魂。</p>
<!-- 变形记仿写 -->
<p>起初，精卫只觉得轻盈了许多，视觉上也看得更高更广了，还能在水里自由的打水漂。过了几个月后，精卫发觉由于无法与家人朋友沟通觉得孤独，而他们却已经开始习惯女娃变成了一只鸟，甚至逗起来了。于是精卫开始觉得愤怒，痛苦，最终精卫大闹议事厅，在议事厅里对着亲人飚屎，尖叫，直至力竭离家出走，回到了发鸠之山。</p>
<p>回到了新生地后精卫到底也觉得没人伺候环绕更让自己难以忍受，只好到东海去扔石子发泄，这里是痛苦之源，只有把东海填平才能泄愤。被好事者告与炎帝，炎帝无可奈何。每日投2次，虽然不多，但毕竟是初为人鸟，然而看热闹的人越来越多，被围观者怂恿每日投掷3次甚至更多，紧接着已经无以为继，怒发冲冠，谁多说一句开始啄人，最后已经没有围观者。没有了围观者，精卫再一次经历了从愤怒到失望的情绪过山车后开始规律投石，心情好投2颗，心情不好只往海里拉泡屎，不仅自己拉，甚至在发鸠之山培养追随者一起拉屎。仇恨早已消失，此后在后悔，愤怒，失望，自闭，仇恨和平静中反复沉沦。</p>
<p>然而东海并没有因为这几颗石子被填满哪怕一立方米，这些投石和每日生物新生的消亡、吃喝拉撒以及泥石冲刷几乎可以忽略不计。</p>
<p>微不足道的石子等同于无效的复仇。然而精卫尚且不能理解这个道理。只能向炎帝发问：复仇并没有解决他的痛苦，到底他的痛苦来源是什么？<br>被扔进不周山的水晶球被炎帝又捡了回来，炎帝要求水晶球再做一则新的预言，要求显示如果女娃在第一个预言之后不再游泳后的命运，否则就会被扔进东海当成填海的边角料。</p>
<h2 id="新预言的故事"><a href="#新预言的故事" class="headerlink" title="新预言的故事"></a>新预言的故事</h2><p>女娃不再游泳，终日沉闷不语，在海边，湖边，河边一切有水的地方保持观望，仿佛下一秒就准备入水。不久开始生病，反反复复怎么都治不好，巫师问了情况，告诉炎帝在家里搞个大水桶，让女娃每日泡一泡，反正面积小高度小游不起来。女娃的病情开始有所缓解，但也终归没治好，就这样预言的10年之期很快过去，女娃离解禁的日子越来越近了。在最后一天女娃纵身一跃跳进了东海溺亡了。</p>
<p>没想到女娃选择自杀来反抗溺亡的命运，但是结局是没有变的，他最终依旧是在预言的时机死亡，反抗并没有作用。</p>
<h2 id="水晶球"><a href="#水晶球" class="headerlink" title="水晶球"></a>水晶球</h2><p>水晶球由于频繁干涉东方神话的独立发展（地狱事务）被谛听一脚踩碎了，形成了现代的溶洞景观，这是后话了。</p>
<h2 id="痛苦的根源"><a href="#痛苦的根源" class="headerlink" title="痛苦的根源"></a>痛苦的根源</h2><p>水晶球的2个预言基本宣告了女娃溺死的既定命运，即使开了上帝视角。<br>无论是选择什么都逃脱不了的死亡。那么在第二则预言后为什么女娃是失去了反抗被预示的既定命运，假如他信上帝的水晶球，那么死前他不信他信上帝，而死后是他不信他不信上帝。终日悔恨，被剥夺了正常的生活，失去了掌控自己的人生的能力才是核心痛苦。</p>
<p>人生所有的可能性被水晶球抹去，再无让人探索的欲望，女娃不再是生机勃勃的女娃，变成了行尸走肉。那么，他的痛苦是来源于水晶球吗？</p>
<p>假如没有水晶球，他依旧无法避免溺亡的结局，但是在溺亡之前他的所剩人生里没有被死亡的恐惧所控制，活着的时候他是完全自由的。<br>没有水晶球也就没有新预言，他和家人还可以通过幻想「假如」来宽慰悲剧，安抚心灵。</p>
<p>水晶球的存在是人生痛苦的潘多拉魔盒，一旦知晓其存在就是悲剧，更遑论打开。可以说，人生少见 「种瓜的瓜」，几乎没有「只要」「就会」，更多的是「假如」「也许」，而潘多拉打开了就只剩下「倒霉」「恐惧」「悲惨」「解脱」「自杀」直到「最终失去一切」。</p>
<p>现代中国神话已经偏离了当时东方神话发展的路线，已经失去了培养神棍和巫婆的土壤，那么，我们就可以脱离水晶球的魔咒了吗？</p>
<p>显然不能，水晶球只是一个隐喻。预示着命运的大致走向和人生发展历程的隐喻。最显而易见的是慢性疾病，乃至癌症。意志的衰弱不一定会拖垮躯体，躯体脱离意志还能靠机器和药物续命，然而，躯体的衰弱几乎会拖垮意志，而意志无法脱离躯体而存在，最终走向共同死亡的结局。要说这两种有何不同，前者只包含一种单纯的痛苦，相当于电脑某个软件中了病毒，经过介入修复后可以康复和正常人无异，后者是多重痛苦，相当于电脑本身硬件出了问题，所有软件都得承受硬件卡顿崩溃的后果，最终不是更换硬件就是成为废弃的电子垃圾。</p>
<p>人当然不会成为一种废弃的电子垃圾，人只有一种结局一种命运：无可避免的死亡。区别在于，健康人的达摩克里斯剑或许永远不会到来，不健康的人24小时都在感受即将死亡的恐惧。</p>
<p>也许是明天，也许是下一刻，达摩克里斯斩下的前1秒，人生只剩下恐惧，没有了其他色彩，其他可能性，带着枷锁，每天除了等待死亡就是无所事事。</p>
<p>女娃死后尚且还可以转生为鸟投石泄愤，结果却是微不足道的复仇，甚至无法从「某种痛苦中」解脱，普通人别无选择，只剩下惨烈的自杀。</p>
<blockquote>
<p>「我永远不会选择自杀」- 加缪</p>
</blockquote>
<p>自杀之所以称得上惨烈，是因为这是最大且唯一的赌注，赌上生命的代价来反抗当下的命运，而结局自己是永远无法知晓的，刹那间却承受了人生最大的痛苦和一瞬间失去了全部的可能性。悲剧就在于，无法知晓反抗的结局，甚至生者也无法断定反抗是有效的。</p>
<p>无法判定的反抗，甚至包含反抗的结局，对于反抗本身来说是微不足道的，对于自己的命运来说却是毁灭性的。为了反抗既定命运，最终，却失去了一切。如加缪所说，自杀最终是无效的。</p>
<!-- ---
title: 他们的失利与他们的傲慢
date: 2021-12-06 21:17:06
tags: 
--- -->
<!-- ## 他们的失利

### 从语言中开始消失的女性

#### 书面语言

`父父子子 君君臣臣` 皆指代男性，`在家从父 出嫁从夫 夫死从子`从少女到妇人到寡妇都是男性亲人的附庸，一个不能独立生活的人。

#### 通俗语言

### 性自由和荡妇羞辱

### 失去子宫，失去后代 失去「位置」，成为附庸

### 成为生育工具，被掠夺的女性的一生

### 微小的权利上强加道德的枷锁

## 他们的野蛮行径

### 掠夺语言第一性：特别的「他」

### 性自由与双标

### 掠夺后代，掠夺继承权

### 定制思想钢印：掠夺话语权-从不是女性却规训女性到制定道德枷锁

### 附庸的背刺：资源绑定的既得利益者们的团结

## 谁的傲慢

谁拥有权力，谁滥用权力，谁践踏底层。上层男性对中下层男性的收割，侵占和压榨，成为附庸的女性无权参与分配与再分配游戏。 -->

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/11/04/review-sth-about-js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/04/review-sth-about-js/" class="post-title-link" itemprop="url">复习前端基础知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-04 16:10:13" itemprop="dateCreated datePublished" datetime="2021-11-04T16:10:13+08:00">2021-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-07 15:59:29" itemprop="dateModified" datetime="2022-01-07T15:59:29+08:00">2022-01-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ts"><a href="#ts" class="headerlink" title="ts"></a>ts</h2><ol>
<li><p><code>class</code> &amp; <code>enum</code> 横跨 类型空间 &amp; 值空间</p>
</li>
<li><p>泛型 可以约束 参数和返回值，而泛型可以用 extends 来约束</p>
</li>
<li><p>keyof 在类型空间使用（基本），返回的是集合（并集）</p>
</li>
<li><p>-? 操作符筛出 undefined </p>
 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Shoes &#123;</span><br><span class="line">  sizes: <span class="built_in">number</span>[]</span><br><span class="line">  types: <span class="built_in">string</span></span><br><span class="line">  colors: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> ShoesKey = keyof Shoes</span><br><span class="line">ShoesKey = <span class="string">&#x27;sizes&#x27;</span> <span class="comment">// 👌</span></span><br><span class="line">ShoesKey = <span class="string">&#x27;types&#x27;</span> <span class="comment">// 👌</span></span><br><span class="line">ShoesKey = <span class="string">&#x27;cost&#x27;</span> <span class="comment">// 🙅‍♂️</span></span><br><span class="line"><span class="comment">// T = sizes | types | cost, 这里泛型T的类型已经被约束了</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buyAShoe</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">ShoesKey</span>&gt;(<span class="params">a: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>函数重载解决以下情况</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多参数函数，函数返回值与单个参数类型相关，参数之间可能有某种关联关系</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> </span></span><br></pre></td></tr></table></figure>

<h2 id="es6-10"><a href="#es6-10" class="headerlink" title="es6 ~ 10"></a>es6 ~ 10</h2><h2 id="vue3"><a href="#vue3" class="headerlink" title="vue3"></a>vue3</h2><h2 id="react"><a href="#react" class="headerlink" title="react"></a>react</h2><h2 id="node"><a href="#node" class="headerlink" title="node"></a>node</h2><h2 id="几种通用模式"><a href="#几种通用模式" class="headerlink" title="几种通用模式"></a>几种通用模式</h2><ol>
<li>单例模式</li>
<li>观察者模式</li>
<li>代理模式/装饰器模式<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 《JS二十年》</span></span><br><span class="line"><span class="comment">// ES2015</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  1. 三表达式内的作用域</span></span><br><span class="line"><span class="comment">// for (const p in x) &#123;body&#125; 的去糖后近似表示</span></span><br><span class="line"><span class="comment">// 循环中的每次迭代使用一个绑定，并在迭代之间传递值</span></span><br><span class="line"><span class="comment">// 对于 const p 来说，每次使用循环的唯一绑定就足够了，因此， p 不能被 for 头部或者循环体内的表达式修改 </span></span><br><span class="line">&#123; <span class="keyword">let</span> $next;</span><br><span class="line">  <span class="keyword">for</span> ($next <span class="keyword">in</span> x) &#123;</span><br><span class="line">    <span class="keyword">const</span> p = $next;</span><br><span class="line">    &#123;body&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. 严格模式下禁止块级函数声明</span></span><br></pre></td></tr></table></figure>

<h2 id="其他示例代码"><a href="#其他示例代码" class="headerlink" title="其他示例代码"></a>其他示例代码</h2><ol>
<li>reTryRequest: 接口轮询，一分钟内轮询直到成功，超时取消</li>
<li>generator or async/await 实现排序动画</li>
<li>vue3 composed 组件示例 + vue3 实现 formWrapper 类型标注</li>
<li>使用 React &amp; vue3 分别实现 autoComplete 组件进行：心智负担，代码量，复杂度，组件设计层面进行比较</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/09/12/ts-type/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/12/ts-type/" class="post-title-link" itemprop="url">TypeScript 类型体操练习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-12 19:00:21" itemprop="dateCreated datePublished" datetime="2021-09-12T19:00:21+08:00">2021-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-06 17:14:48" itemprop="dateModified" datetime="2022-01-06T17:14:48+08:00">2022-01-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>挑战类型体操答案合集，一部分是自己做的，一部分是自己抄的</p>
</blockquote>
<h2 id="热身运动"><a href="#热身运动" class="headerlink" title="热身运动"></a>热身运动</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 期望是一个 string 类型 👉 so eazy</span></span><br><span class="line"><span class="comment">// any -&gt; string</span></span><br><span class="line"><span class="keyword">type</span> HelloWorld = <span class="built_in">string</span></span><br><span class="line"><span class="comment">// 你需要使得如下这行不会抛出异常</span></span><br><span class="line"><span class="keyword">type</span> test = Expect&lt;Equal&lt;HelloWorld, <span class="built_in">string</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="部分前置知识-keyof-typeof-extends-等，具体请移步到官方文档查阅详情"><a href="#部分前置知识-keyof-typeof-extends-等，具体请移步到官方文档查阅详情" class="headerlink" title="部分前置知识: keyof, typeof, extends 等，具体请移步到官方文档查阅详情"></a>部分前置知识: keyof, typeof, extends 等，具体请移步到官方文档查阅详情</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// typeof Type Operator</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="string">&#x27;hello&#x27;</span> <span class="comment">// string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">a?: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;x: <span class="number">10</span>, y: <span class="number">1</span>, ...a&#125; <span class="comment">// 返回具体值，而不是类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> F0 = ReturnType&lt;f&gt; <span class="comment">// ❌ &#x27;f&#x27; refers to a value, but is being used as a type here, you should use &#x27;typeof f&#x27;</span></span><br><span class="line"><span class="keyword">type</span> F1 = ReturnType&lt;<span class="keyword">typeof</span> f&gt; <span class="comment">// &#123;x: number; y:number; a?: string&#125;</span></span><br><span class="line"><span class="comment">// typeof 后面不能跟执行函数</span></span><br><span class="line"><span class="comment">// meant to use = ReturnType&lt;typeof f&gt;</span></span><br><span class="line"><span class="keyword">let</span> shouldcontinue: <span class="keyword">typeof</span> f(<span class="string">&#x27;aaaa&#x27;</span>) <span class="comment">// ❌</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// keyof Type Operator</span></span><br><span class="line"><span class="keyword">type</span> Point = &#123;a: <span class="built_in">string</span>, b: <span class="built_in">string</span>&#125;</span><br><span class="line"><span class="keyword">type</span> P0 = keyof Point <span class="comment">// type P0 = &#x27;a&#x27; | &#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// as 类型断言：key Remapping via as</span></span><br><span class="line"><span class="keyword">type</span> NewKeyType&lt;P&gt; = Capitalize&lt;<span class="built_in">string</span> &amp; P&gt;</span><br><span class="line"><span class="keyword">type</span> MappedTypeWithNewProperties&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> NewKeyType&lt;P&gt;]: T[P]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 条件类型通过never来过滤key</span></span><br><span class="line"><span class="keyword">type</span> RemoveKindField&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> Exclude&lt;P, <span class="string">&#x27;kind&#x27;</span>&gt;]: T[P]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> Circle &#123;</span><br><span class="line">  kind: <span class="string">&#x27;circle&#x27;</span>;</span><br><span class="line">  radius: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> kindlessCircle = RemoveKindField&lt;T&gt; <span class="comment">// type kindlessCircle = &#123;radius: number&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// extends 继承，扩展，衍生，Class继承，非实例，继承单个Class，衍生多个interface，类型约束 K extends keyof T，K 是 T的子类型（类似于Class A extends Class B, A 是 B的子类一个意思）</span></span><br><span class="line"><span class="comment">// 类继承👉协变&amp;逆变</span></span><br><span class="line"><span class="comment">// infer 待推断的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// InstanceType&lt;Type&gt; 提取构造函数的实例函数类型：Class</span></span><br><span class="line"><span class="keyword">class</span> C &#123;</span><br><span class="line">  x = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 类 &amp; 枚举 横跨 类型空间 &amp; 值空间，所以 C 也算一种类型，但是 `typeof C !== C`, 因为 `typeof C` 并非 `C` 的类型，而`InstanceType&lt;typeof C&gt;`才是, 而 `C` 是 构造函数 `constructor`</span></span><br><span class="line"><span class="keyword">type</span> C0 = InstanceType&lt;<span class="keyword">typeof</span> C&gt; <span class="comment">// type C0 = C</span></span><br></pre></td></tr></table></figure>

<h2 id="实现-Pick-lt-T-Keys-gt"><a href="#实现-Pick-lt-T-Keys-gt" class="headerlink" title="实现 Pick&lt;T, Keys&gt;"></a>实现 <code>Pick&lt;T, Keys&gt;</code></h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  description: <span class="built_in">string</span></span><br><span class="line">  completed: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pick&lt;Type, Keys&gt; 👉 MyPick&lt;Type, Keys&gt; 使用方法一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P] <span class="comment">// P in K, K = &#x27;title&#x27; | &#x27;description&#x27; | &#x27;completed&#x27;, `in` means for P in K</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = MyPick&lt;Todo, <span class="string">&#x27;title&#x27;</span> | <span class="string">&#x27;completed&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: TodoPreview = &#123;</span><br><span class="line">    title: <span class="string">&#x27;Clean room&#x27;</span>,</span><br><span class="line">    completed: <span class="literal">false</span>,</span><br><span class="line">    description: <span class="string">&#x27;xxxx&#x27;</span> <span class="comment">// ❌，description 多余属性</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Readonly-lt-T-gt"><a href="#Readonly-lt-T-gt" class="headerlink" title="Readonly&lt;T&gt;"></a><code>Readonly&lt;T&gt;</code></h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  description: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ReadOnly&lt;Type&gt; 👉 MyReadOnly&lt;Type&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReadOnly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: MyReadonly&lt;Todo&gt; = &#123;</span><br><span class="line">  title: <span class="string">&quot;Hey&quot;</span>,</span><br><span class="line">  description: <span class="string">&quot;foobar&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">todo.title = <span class="string">&quot;Hello&quot;</span> <span class="comment">// Error: cannot reassign a readonly property</span></span><br><span class="line">todo.description = <span class="string">&quot;barFoo&quot;</span> <span class="comment">// Error: cannot reassign a readonly property</span></span><br></pre></td></tr></table></figure>

<h2 id="DeepReadonly-lt-T-gt-🌟"><a href="#DeepReadonly-lt-T-gt-🌟" class="headerlink" title="DeepReadonly&lt;T&gt; 🌟"></a><code>DeepReadonly&lt;T&gt;</code> 🌟</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> DeepReadonly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P] <span class="keyword">extends</span> &#123;&#125; ? DeepReadonly&lt;T[P]&gt; : T[P]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ReadonlyAndPick-lt-T-Keys-gt-🌟"><a href="#ReadonlyAndPick-lt-T-Keys-gt-🌟" class="headerlink" title="ReadonlyAndPick&lt;T, Keys&gt; 🌟"></a><code>ReadonlyAndPick&lt;T, Keys&gt;</code> 🌟</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReadonlyAndPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;<span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> P <span class="keyword">extends</span> K ? P : <span class="built_in">never</span>]: T[P]&#125; &amp; &#123;[P <span class="keyword">in</span> keyof T <span class="keyword">as</span> P <span class="keyword">extends</span> K ? <span class="built_in">never</span> : P]:[P]&#125;</span><br><span class="line"><span class="comment">// 使用 Exclude 替代 P extends K ? never : P &amp;&amp; 使用 Pick 替代  P extends K ? P : never</span></span><br><span class="line"><span class="keyword">type</span> ReadonlyAndPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;<span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof Pick&lt;T, K&gt;]: T[P]&#125; &amp; &#123;[P <span class="keyword">in</span> keyof T <span class="keyword">as</span> Exclude&lt;P, K&gt;]: T[P]&#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">type</span> ReadonlyAndPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;<span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof Pick&lt;T, K&gt;]: T[P]&#125; &amp; &#123;[P <span class="keyword">in</span> Exclude&lt;keyof T, K&gt;]: T[P]&#125;</span><br><span class="line"><span class="comment">// 进一步 替换 readonly</span></span><br><span class="line"><span class="keyword">type</span> ReadonlyAndPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = Readonly&lt;Pick&lt;T, K&gt;&gt; &amp; &#123;[P <span class="keyword">in</span> Exclude&lt;keyof T, K&gt;]: T[P]&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Omit-lt-T-Keys-gt"><a href="#Omit-lt-T-Keys-gt" class="headerlink" title="Omit&lt;T, Keys&gt;"></a><code>Omit&lt;T, Keys&gt;</code></h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  description: <span class="built_in">string</span></span><br><span class="line">  completed: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Omit&lt;Type, Keys&gt; 👉 MyOmit&lt;Type, Keys&gt;</span></span><br><span class="line"><span class="keyword">type</span> MyOmit&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> P <span class="keyword">extends</span> K ? <span class="built_in">never</span>: P]: T[P]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 跟上面用 never 过滤属性的方式一致，所以还可以这么写</span></span><br><span class="line"><span class="keyword">type</span> MyOmit1&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> Exclude&lt;P, K&gt;]: T[P];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = MyOmit&lt;Todo, <span class="string">&#x27;description&#x27;</span> | <span class="string">&#x27;title&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: TodoPreview = &#123;</span><br><span class="line">  completed: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Exclude-lt-T-U-gt"><a href="#Exclude-lt-T-U-gt" class="headerlink" title="Exclude&lt;T, U&gt;"></a><code>Exclude&lt;T, U&gt;</code></h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从T中排除可分配给U的类型</span></span><br><span class="line"><span class="comment">// T, U 都是字符串类型</span></span><br><span class="line"><span class="comment">// MyExclude&lt;&#x27;a&#x27; | &#x27;b&#x27; | &#x27;c&#x27;, &#x27;a&#x27;&gt; // 输出 &#x27;b&#x27; | &#x27;c&#x27;</span></span><br><span class="line"><span class="keyword">type</span> MyExclude&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T</span><br></pre></td></tr></table></figure>

<h2 id="ReturnType-lt-T-gt-提取函数的返回类型"><a href="#ReturnType-lt-T-gt-提取函数的返回类型" class="headerlink" title="ReturnType&lt;T&gt; 提取函数的返回类型"></a><code>ReturnType&lt;T&gt;</code> 提取函数的返回类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ReturnType&lt;T&gt; = T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>[]) =&gt; infer R ? R : <span class="built_in">any</span></span><br></pre></td></tr></table></figure>

<h2 id="Parameters-lt-T-gt-提取函数的参数类型"><a href="#Parameters-lt-T-gt-提取函数的参数类型" class="headerlink" title="Parameters&lt;T&gt; 提取函数的参数类型"></a><code>Parameters&lt;T&gt;</code> 提取函数的参数类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Parameters&lt;T&gt; = T <span class="keyword">extends</span> (...args: infer P) =&gt; <span class="built_in">any</span> ? P : T</span><br></pre></td></tr></table></figure>
<h2 id="First-lt-T-gt-of-Array-实现一个泛型类型-使得可以返回数组类型的第一项"><a href="#First-lt-T-gt-of-Array-实现一个泛型类型-使得可以返回数组类型的第一项" class="headerlink" title="First&lt;T&gt; of Array 实现一个泛型类型, 使得可以返回数组类型的第一项"></a><code>First&lt;T&gt;</code> of Array 实现一个泛型类型, 使得可以返回数组类型的第一项</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> arr1 = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">type</span> head1 = First&lt;arr1&gt; <span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">type</span> head2 = First&lt;arr2&gt; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> First&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">any</span>[] ? <span class="built_in">never</span> : T[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h2 id="Length-lt-T-gt-of-Tuple"><a href="#Length-lt-T-gt-of-Tuple" class="headerlink" title="Length&lt;T&gt; of Tuple"></a><code>Length&lt;T&gt;</code> of Tuple</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> tesla = [<span class="string">&#x27;tesla&#x27;</span>, <span class="string">&#x27;model3&#x27;</span>, <span class="string">&#x27;model X&#x27;</span>, <span class="string">&#x27;model Y&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> Length&lt;T&gt; = T <span class="keyword">extends</span> <span class="built_in">any</span>[] ? T[<span class="string">&#x27;length&#x27;</span>] : <span class="built_in">never</span></span><br><span class="line"><span class="keyword">type</span> teslaLength = Length&lt;tesla&gt; <span class="comment">// 4</span></span><br></pre></td></tr></table></figure>
<h2 id="Last-lt-T-gt-of-Array-实现一个泛型类型-使得可以返回数组类型的最后一项"><a href="#Last-lt-T-gt-of-Array-实现一个泛型类型-使得可以返回数组类型的最后一项" class="headerlink" title="Last&lt;T&gt; of Array 实现一个泛型类型, 使得可以返回数组类型的最后一项"></a><code>Last&lt;T&gt;</code> of Array 实现一个泛型类型, 使得可以返回数组类型的最后一项</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> arr1 = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">type</span> tail1 = Last&lt;arr1&gt; <span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">type</span> tail2 = Last&lt;arr2&gt; <span class="comment">// 1</span></span><br><span class="line"><span class="comment">// F 只是一个变量，代表最后一项之前的所有项</span></span><br><span class="line"><span class="keyword">type</span> Last&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [...infer F, infer E]? E: <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Concat-lt-T-P-gt-实现一个Array-concat-方法功能相同的类型"><a href="#Concat-lt-T-P-gt-实现一个Array-concat-方法功能相同的类型" class="headerlink" title="Concat&lt;T, P&gt;: 实现一个Array.concat 方法功能相同的类型"></a><code>Concat&lt;T, P&gt;</code>: 实现一个Array.concat 方法功能相同的类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Concat&lt;T, P&gt; =T <span class="keyword">extends</span> <span class="built_in">any</span>[] ? P <span class="keyword">extends</span> <span class="built_in">any</span>[] ? [...T, ...P] : <span class="built_in">never</span> : <span class="built_in">never</span>;</span><br><span class="line"><span class="comment">// or type Concat&lt;T extends any[], P extends any[]&gt; = [...T, ...P]</span></span><br><span class="line"><span class="keyword">type</span> Result = Concat&lt;[<span class="number">1</span>], [<span class="number">2</span>]&gt; <span class="comment">// [1, 2]</span></span><br></pre></td></tr></table></figure>

<h2 id="Push-lt-T-P-gt-Array-push-类型方法"><a href="#Push-lt-T-P-gt-Array-push-类型方法" class="headerlink" title="Push&lt;T, P&gt;: Array.push 类型方法"></a><code>Push&lt;T, P&gt;</code>: Array.push 类型方法</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Push&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[], P <span class="keyword">extends</span> <span class="built_in">any</span>&gt; = [...T, P]</span><br><span class="line"><span class="keyword">type</span> Result = Push&lt;[<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;3&#x27;</span>&gt; <span class="comment">// [1, 2, &#x27;3&#x27;]</span></span><br></pre></td></tr></table></figure>

<h2 id="Unshift-lt-T-P-gt-Array-unshift-类型方法"><a href="#Unshift-lt-T-P-gt-Array-unshift-类型方法" class="headerlink" title="Unshift&lt;T, P&gt;: Array.unshift 类型方法"></a><code>Unshift&lt;T, P&gt;</code>: Array.unshift 类型方法</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Unshift&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[], P <span class="keyword">extends</span> <span class="built_in">any</span>&gt; = [P, ...T]</span><br><span class="line"><span class="keyword">type</span> Result = Unshift&lt;[<span class="number">1</span>, <span class="number">2</span>], <span class="string">&#x27;3&#x27;</span>&gt; <span class="comment">// [&#x27;3&#x27;, 1, 2]</span></span><br></pre></td></tr></table></figure>


<h2 id="Pop-lt-T-gt-🌟"><a href="#Pop-lt-T-gt-🌟" class="headerlink" title="Pop&lt;T&gt; 🌟"></a><code>Pop&lt;T&gt;</code> 🌟</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Pop&lt;T&gt; = T <span class="keyword">extends</span> [...infer P, infer E] ? P : <span class="built_in">never</span>;  </span><br></pre></td></tr></table></figure>

<h2 id="Shift-lt-T-gt-🌟"><a href="#Shift-lt-T-gt-🌟" class="headerlink" title="Shift&lt;T&gt; 🌟"></a><code>Shift&lt;T&gt;</code> 🌟</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Shift&lt;T&gt; = T <span class="keyword">extends</span> [infer E, ...infer P] ? P : <span class="built_in">never</span>;  </span><br></pre></td></tr></table></figure>

<h2 id="Promise-all-🌟🌟"><a href="#Promise-all-🌟🌟" class="headerlink" title="Promise.all 🌟🌟"></a><code>Promise.all</code> 🌟🌟</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> inferTupleT&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]: T[P] <span class="keyword">extends</span> <span class="built_in">Promise</span>&lt;infer S&gt; ? S : T[P]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">PromiseAll</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">any</span>[]&gt;(<span class="params">values: <span class="keyword">readonly</span> [...T]</span>): <span class="title">Promise</span>&lt;<span class="title">inferTupleT</span>&lt;<span class="title">T</span>&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="title">const</span> <span class="title">promise1</span> = <span class="title">Promise</span>.<span class="title">resolve</span>(<span class="params">3</span>)</span>;</span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">const</span> promise3 = <span class="keyword">new</span> <span class="built_in">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(resolve, <span class="number">100</span>, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> p = PromiseAll([promise1, promise2, promise3] <span class="keyword">as</span> <span class="keyword">const</span>) <span class="comment">// Promise&lt;[number, 42, string]&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="If-lt-truthy-T-F-gt-🌟🌟"><a href="#If-lt-truthy-T-F-gt-🌟🌟" class="headerlink" title="If&lt;truthy, T, F&gt; 🌟🌟"></a><code>If&lt;truthy, T, F&gt;</code> 🌟🌟</h2><blockquote>
<p><code>If&lt;true, T, F&gt; =&gt; T, If&lt;false, T, F&gt; =&gt; F</code></p>
</blockquote>
<blockquote>
<p>这里还需要考虑 <code>any</code> &amp;&amp; <code>boolean</code>, 他俩也(also <strong>never</strong>)被视为 <code>union type</code>, but <code>unknown</code> 却不是</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> If&lt;C, T, F&gt; = C <span class="keyword">extends</span> <span class="literal">true</span> ? T : C <span class="keyword">extends</span> <span class="literal">false</span> ? F : <span class="built_in">never</span>; </span><br><span class="line"><span class="keyword">type</span> A = If&lt;<span class="literal">true</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">type</span> B = If&lt;<span class="literal">false</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// &#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">type</span> C = If&lt;<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// never</span></span><br><span class="line"><span class="comment">// 考虑输入  `any` &amp;&amp; `boolean`</span></span><br><span class="line"><span class="keyword">type</span> D = If&lt;<span class="built_in">boolean</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// &#x27;a&#x27; | &#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">type</span> E = If&lt;<span class="built_in">any</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// &#x27;a&#x27; | &#x27;b&#x27;</span></span><br><span class="line"><span class="comment">// 所以需要去除 naked type，怎么办呢？和下面 IsNever 处理一致, 加入 array, record, function 结构</span></span><br><span class="line"><span class="keyword">type</span> If&lt;C, T, F&gt; = [C] <span class="keyword">extends</span> [<span class="literal">true</span>] ? T : [C] <span class="keyword">extends</span> [<span class="literal">false</span>] ? F : <span class="built_in">never</span>; </span><br><span class="line"><span class="comment">// 此时</span></span><br><span class="line"><span class="keyword">type</span> D = If&lt;<span class="built_in">boolean</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// never</span></span><br><span class="line"><span class="keyword">type</span> E = If&lt;<span class="built_in">any</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// &#x27;a&#x27;</span></span><br><span class="line"><span class="comment">// any 还是不对，还需要破坏any 的 checked type，处理方式就是加入 加入破坏条件 any extends C</span></span><br><span class="line"><span class="keyword">type</span> If&lt;C, T, F&gt; = [C] <span class="keyword">extends</span> [<span class="literal">true</span>] ? (<span class="built_in">any</span> <span class="keyword">extends</span> C ? <span class="built_in">never</span> : T) : [C] <span class="keyword">extends</span> [<span class="literal">false</span>] ? (<span class="built_in">any</span> <span class="keyword">extends</span> C ? <span class="built_in">never</span> : F) : <span class="built_in">never</span>;</span><br><span class="line"><span class="comment">// 此时</span></span><br><span class="line"><span class="keyword">type</span> D = If&lt;<span class="built_in">boolean</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// never</span></span><br><span class="line"><span class="keyword">type</span> E = If&lt;<span class="built_in">any</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>&gt; <span class="comment">// never</span></span><br></pre></td></tr></table></figure>

<h2 id="TupleToUnion-lt-T-gt-元组转联合类型"><a href="#TupleToUnion-lt-T-gt-元组转联合类型" class="headerlink" title="TupleToUnion&lt;T&gt; 元组转联合类型"></a><code>TupleToUnion&lt;T&gt;</code> 元组转联合类型</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TupleToUnion&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T[<span class="built_in">number</span>]</span><br></pre></td></tr></table></figure>

<h2 id="TupleToObject-lt-T-gt-元组转对象"><a href="#TupleToObject-lt-T-gt-元组转对象" class="headerlink" title="TupleToObject&lt;T&gt; 元组转对象"></a><code>TupleToObject&lt;T&gt;</code> 元组转对象</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> tuple = [<span class="string">&#x27;tesla&#x27;</span>, <span class="string">&#x27;model 3&#x27;</span>, <span class="string">&#x27;model X&#x27;</span>, <span class="string">&#x27;model Y&#x27;</span>]</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="comment">// const tuple = [&#x27;tesla&#x27;, &#x27;model 3&#x27;, &#x27;model X&#x27;, &#x27;model Y&#x27;] as const</span></span><br><span class="line"><span class="keyword">type</span> TupleToObject&lt;T <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[]&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> T[<span class="built_in">number</span>]]: P</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> result = TupleToObject&lt;tuple&gt; <span class="comment">// &#123;tesla: &#x27;tesla&#x27;, ...&#125;</span></span><br><span class="line"><span class="comment">// when tuple is const</span></span><br><span class="line"><span class="comment">// type result = TupleToObject&lt;typeof tuple&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="IsNever-lt-T-gt-🌟"><a href="#IsNever-lt-T-gt-🌟" class="headerlink" title="IsNever&lt;T&gt; 🌟"></a><code>IsNever&lt;T&gt;</code> 🌟</h2><blockquote>
<p>conditional type 判断 IsNever 在某种情况下有问题：如果这么写 <code>type IsNever&lt;T&gt; = T extends never ? true : false</code> , 当 <code>type A = IsNever&lt;never&gt;</code> 时 <code>type A = never</code> 而不是 true or false, 查阅<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/47590228">怎么理解 conditional type 中的联合类型与 never</a></p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IsNever</span></span><br><span class="line"><span class="keyword">type</span> IsNever&lt;T&gt; = [T] <span class="keyword">extends</span> [<span class="built_in">never</span>] ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line"><span class="comment">// 将输入变成 不可能是空列表的状态即可，[T] 🉑️， &#123;a: T&#125; 也 🉑️</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://github.com/type-challenges/type-challenges/">类型体操链接</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/09/12/ts-in-vue3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/12/ts-in-vue3/" class="post-title-link" itemprop="url">ts-in-vue3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-12 18:46:11" itemprop="dateCreated datePublished" datetime="2021-09-12T18:46:11+08:00">2021-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-06 17:14:35" itemprop="dateModified" datetime="2022-01-06T17:14:35+08:00">2022-01-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>特别说明：本项目只关注如何写可用 ts 类型，其他诸如：根路径配置类型文件、ts 类型查找顺序、ts 类型体操等均不涉及</p>
</blockquote>
<h2 id="项目中需要使用-ts-类型的文件及其结构"><a href="#项目中需要使用-ts-类型的文件及其结构" class="headerlink" title="项目中需要使用 ts 类型的文件及其结构"></a>项目中需要使用 ts 类型的文件及其结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件名及文件层级</span></span><br><span class="line">|---- server <span class="comment"># 请求</span></span><br><span class="line">|      |--- index.ts <span class="comment"># 请求配置</span></span><br><span class="line">|      |--- api.ts <span class="comment"># 具体api</span></span><br><span class="line">|---- store <span class="comment"># vuex</span></span><br><span class="line">|------|--- modules</span><br><span class="line">|------|--- index.ts</span><br><span class="line">|---- composables <span class="comment"># 逻辑复用组件</span></span><br><span class="line">|------|--- *.ts <span class="comment"># echarts.ts / 变量声明，使用，值更新</span></span><br><span class="line">|---- router <span class="comment"># vue-router</span></span><br><span class="line">|------|--- index.ts</span><br><span class="line">|---- directives <span class="comment"># 自定义全局指令</span></span><br><span class="line">|------|--- index.ts</span><br><span class="line">|---- pages <span class="comment"># 页面</span></span><br><span class="line">|---- components <span class="comment"># 组件（非全局）</span></span><br><span class="line">|---- my.t.ts <span class="comment"># 共用类型定义文件</span></span><br></pre></td></tr></table></figure>

<h2 id="先看项目中出现过的几个-ts-典型写法"><a href="#先看项目中出现过的几个-ts-典型写法" class="headerlink" title="先看项目中出现过的几个 ts 典型写法"></a>先看项目中出现过的几个 ts 典型写法</h2><h3 id="vue-文件内"><a href="#vue-文件内" class="headerlink" title="*.vue 文件内"></a><code>*.vue</code> 文件内</h3><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// some-detail.vue script.lang = ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive, ref, toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; key &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    list: <span class="built_in">Array</span>, <span class="comment">// round 0: 不够准确</span></span><br><span class="line">    <span class="keyword">default</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// setup 内部</span></span><br><span class="line">  <span class="comment">// round 1</span></span><br><span class="line">  setup: <span class="function">(<span class="params">props: <span class="built_in">any</span></span>) =&gt;</span>  &#123;</span><br><span class="line">  <span class="comment">// round 2: ?</span></span><br><span class="line">    <span class="keyword">const</span> leftType: <span class="built_in">any</span> = reactive(&#123;</span><br><span class="line">      rightType: <span class="number">0</span>,</span><br><span class="line">      list: []</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// round 3: ?</span></span><br><span class="line">    <span class="keyword">const</span> newArray = leftType.list.map(v:<span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...v,</span><br><span class="line">        changeSomePropName: v.somePropName</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// round 4: ?</span></span><br><span class="line">    <span class="keyword">const</span> textFunc: <span class="built_in">void</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// do something but do not return anything</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// round 5: ?</span></span><br><span class="line">    <span class="keyword">const</span> hasTrue = ref&lt;<span class="built_in">boolean</span>&gt;(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> isStr = ref&lt;<span class="built_in">string</span>&gt;(<span class="string">&#x27;initStr&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// round 6: ?</span></span><br><span class="line">    <span class="keyword">const</span> &#123; list &#125; = toRefs(props) <span class="comment">// list: any</span></span><br><span class="line">    <span class="comment">// round 7: ?</span></span><br><span class="line">    <span class="keyword">const</span> store: <span class="built_in">any</span> = useStore(key)</span><br><span class="line">    <span class="comment">// round 8: ?</span></span><br><span class="line">    <span class="keyword">const</span> getData = getDataByAxiosApi().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> ret: <span class="built_in">any</span> = res</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="1-频繁使用-ts-类型的几个地方"><a href="#1-频繁使用-ts-类型的几个地方" class="headerlink" title="1. 频繁使用 ts 类型的几个地方"></a>1. 频繁使用 ts 类型的几个地方</h4><ol>
<li><code>server/api.ts</code> 接口定义，接口通用 axios 实例类型返回动态类型</li>
<li><code>store/modules</code> <strong>state</strong> 定义，融合多个模块的类型</li>
<li><code>router/mpdules</code> <strong>routes</strong> 定义，扩展字段类型</li>
<li>全局类型定义：扩展原模块类型</li>
<li><code>*.vue</code>文件内 <code>setup</code> &amp; <code>composables/*.ts</code> 逻辑组件， 内部：函数声明，变量定义，赋值操作等</li>
</ol>
<h4 id="2-文件内频繁写错方向的类型：使用推导类型"><a href="#2-文件内频繁写错方向的类型：使用推导类型" class="headerlink" title="2. 文件内频繁写错方向的类型：使用推导类型"></a>2. 文件内频繁写错方向的类型：使用推导类型</h4><ol>
<li>凡是赋值操作，赋值右边带有类型推导的，类型一律由右边决定，不必在左边写 <code>any</code></li>
<li>凡是简单类型赋值操作，ref内部的，都不必声明类型 <code>const a = ref(&#39;some str&#39;); // a 一定会被推导为 Ref&lt;string&gt;</code></li>
<li>函数操作（useStore/useRoute/数组操作（map,forEach,for(of,in)）/自定义函数，此处只是执行操作的函数），类型由函数定义时返回的参数类型决定</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以上写法可以改成？</span></span><br></pre></td></tr></table></figure>

<h4 id="3-定义函数-变量时如何返回需要的类型"><a href="#3-定义函数-变量时如何返回需要的类型" class="headerlink" title="3. 定义函数/变量时如何返回需要的类型"></a>3. 定义函数/变量时如何返回需要的类型</h4><ol>
<li><p>扩展全局模块类型： router/store/axios</p>
<blockquote>
<p>衍生问题，如何知道 router 上有 RouteMeta 类型？（或者说如何知道 Router 有哪些类型）</p>
</blockquote>
 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展全局模块类型router/store/axios，以router为例</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 模块导出的2种方式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 方法一：全局导出声明</span></span><br><span class="line"><span class="comment">// 确保是模块</span></span><br><span class="line"><span class="comment">// export &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// declare module &#x27;vue-router&#x27; &#123;</span></span><br><span class="line"><span class="comment">//   // 自定义元字段声明</span></span><br><span class="line"><span class="comment">//   interface RouteMeta &#123;</span></span><br><span class="line"><span class="comment">//     // is optional</span></span><br><span class="line"><span class="comment">//     isAdmin?: boolean</span></span><br><span class="line"><span class="comment">//     requiresAuth?: boolean,</span></span><br><span class="line"><span class="comment">//     // must be declared by every route</span></span><br><span class="line"><span class="comment">//     title?: string</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二：模块导出声明</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">interface</span> RouteMeta &#123;</span><br><span class="line">  <span class="comment">// is optional</span></span><br><span class="line">  isAdmin?: <span class="built_in">boolean</span></span><br><span class="line">  requiresAuth?: <span class="built_in">boolean</span></span><br><span class="line">  <span class="comment">// must be declared by every route</span></span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>composables/directives/server</p>
</li>
</ol>
<blockquote>
<p>Method 是什么类型？<br>如何修改 request 的定义，使得可以在使用 <code>getData</code> 是返回与后端确定好的结构？在修改过程中碰到哪些问题？请举例</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server/index</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosRequestConfig, Method &#125; <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="comment">// 这种写法会导致什么问题？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">method: Method, url: <span class="built_in">string</span>, config: AxiosRequestConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    instance</span><br><span class="line">      .request(&#123;</span><br><span class="line">        method: method,</span><br><span class="line">        url: url,</span><br><span class="line">        ...config</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve(res)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        reject(err)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义 get 请求方法</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url: <span class="built_in">string</span>, params?: <span class="built_in">any</span>, responseType?: resType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(<span class="string">&#x27;GET&#x27;</span>, url, &#123; params, responseType &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">const</span> getData = <span class="keyword">async</span> (data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> get(<span class="string">&#x27;path/to/get/some/data&#x27;</span>, data)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">&#x27;getData error&#x27;</span>, error)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// *.vue 使用getData函数时能否拿到返回的res 类型？？</span></span><br><span class="line"><span class="keyword">import</span> &#123; getData &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/api.ts&#x27;</span></span><br><span class="line"><span class="keyword">const</span> res = getData()</span><br></pre></td></tr></table></figure>

<h2 id="如何在快速迭代的项目中书写正确可用的类型"><a href="#如何在快速迭代的项目中书写正确可用的类型" class="headerlink" title="如何在快速迭代的项目中书写正确可用的类型"></a>如何在快速迭代的项目中书写正确可用的类型</h2><h3 id="1-渐进式类型更新：比-any-更好一点的写法"><a href="#1-渐进式类型更新：比-any-更好一点的写法" class="headerlink" title="1. 渐进式类型更新：比 any 更好一点的写法"></a>1. 渐进式类型更新：比 any 更好一点的写法</h3><h4 id="引用类型reactive"><a href="#引用类型reactive" class="headerlink" title="引用类型reactive"></a>引用类型reactive</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一开始可能只知道某个变量的几个属性，大致结构，不确定后续属性的新增/减少，可以这样写</span></span><br><span class="line"><span class="comment">// 第一步</span></span><br><span class="line"><span class="comment">// 类型文件B.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> typeAfromB = &#123;</span><br><span class="line">  [k: <span class="built_in">string</span>]: unknown</span><br><span class="line">  <span class="comment">// [k: string]: any</span></span><br><span class="line">&#125; <span class="comment">// unknown &amp; any 的区别： unknown 类型的变量赋值可以赋值给 any 和 unknown， 有类型检查更安全， any 可以赋值给任意类型(包括null &amp; undefined)，没有类型检查</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二步</span></span><br><span class="line"><span class="comment">// 组件A.vue</span></span><br><span class="line"><span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; typeAfromB &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/B.ts&#x27;</span></span><br><span class="line"><span class="keyword">const</span> someTypeInSometimes = reactive&lt;typeAfromB&gt;(&#123;</span><br><span class="line">  propA: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">  propB: <span class="number">456</span>,</span><br><span class="line">  propC: &#123;&#125;,</span><br><span class="line">  propD: [],</span><br><span class="line">  propE: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="原始类型：联合类型、交叉类型、字面量类型"><a href="#原始类型：联合类型、交叉类型、字面量类型" class="headerlink" title="原始类型：联合类型、交叉类型、字面量类型"></a>原始类型：联合类型、交叉类型、字面量类型</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字面量类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> typeCfromB = <span class="string">&#x27;GET&#x27;</span> | <span class="string">&#x27;POST&#x27;</span> | <span class="string">&#x27;DELETE&#x27;</span> | <span class="string">&#x27;PUT&#x27;</span></span><br><span class="line"><span class="comment">// 联合类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> typeDfromB = <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line"><span class="comment">// 交叉类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> typeEfromB = <span class="built_in">string</span> &amp; <span class="built_in">number</span> <span class="comment">// 此处的 typeEfromB 是什么?考虑一种类型既是 `string` 又是`number`的类型 </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> typeEEfromB = <span class="built_in">string</span>[] &amp; <span class="built_in">number</span> <span class="comment">// 此处的 typeEfromB 是什么?考虑一种类型既是 `string[]` 又是`number`的类型 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件B.vue: 使用以上定义的类型</span></span><br><span class="line"><span class="keyword">const</span> cb = ref&lt;typeCfromB&gt;(<span class="string">&#x27;oh my god!&#x27;</span>) <span class="comment">// 这里正确吗？</span></span><br><span class="line"><span class="keyword">const</span> db = ref&lt;typeDfromB&gt;(<span class="number">124</span>)</span><br><span class="line">db.value = <span class="string">&#x27;124&#x27;</span> <span class="comment">// 这样写ok吗？</span></span><br><span class="line"><span class="keyword">const</span> copyDB = db.includes(<span class="string">&#x27;1&#x27;</span>) <span class="comment">// 这样行不行？</span></span><br><span class="line"><span class="keyword">const</span> eb = ref&lt;typeEfromB&gt;([<span class="string">&#x27;125&#x27;</span>, <span class="number">123</span>]) <span class="comment">// 有没有问题？</span></span><br><span class="line"><span class="keyword">const</span> copyEB = ref&lt;typeEEfromB&gt;()</span><br><span class="line"><span class="keyword">const</span> eeb = copyEB?.value.length <span class="comment">// 这样能行吗？eeb 的类型是什么，</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>把类型当作值的集合，理解 类型中的 union type - 交集 和 intersection type -并集</p>
</blockquote>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AA = &#123;aa: <span class="string">&#x27;A&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">type</span> BB = &#123;bb: <span class="string">&#x27;B&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">type</span> ABor = AA | BB</span><br><span class="line"><span class="keyword">type</span> ABand = AA &amp; BB</span><br><span class="line"><span class="keyword">type</span> AAkeys = keyof AA</span><br><span class="line"><span class="keyword">type</span> BBkeys = keyof BB</span><br><span class="line"><span class="keyword">type</span> ABandKeys = keyof ABand <span class="comment">// &#x27;aa&#x27; | &#x27;bb&#x27;</span></span><br><span class="line"><span class="keyword">type</span> ABorKeys = keyof ABor <span class="comment">// never</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aaa: ABand = &#123;</span><br><span class="line">  aa: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">  bb: <span class="string">&#x27;B&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-项目中需要的类型基本上可由：联合类型（-）、交叉类型（-amp-）、-字面量类型、泛型-以及枚举覆盖，不需要类型体操"><a href="#2-项目中需要的类型基本上可由：联合类型（-）、交叉类型（-amp-）、-字面量类型、泛型-以及枚举覆盖，不需要类型体操" class="headerlink" title="2. 项目中需要的类型基本上可由：联合类型（|）、交叉类型（&amp;）、 字面量类型、泛型 以及枚举覆盖，不需要类型体操"></a>2. 项目中需要的类型基本上可由：联合类型（|）、交叉类型（&amp;）、 字面量类型、泛型 以及枚举覆盖，不需要类型体操</h3><blockquote>
<p>从以上例子中考虑：<code>联合类型</code> 和 <code>交叉类型</code>的区别? 可以得出交叉类型的应用场景是什么？</p>
</blockquote>
<p>实际上，项目中使用最常见的还是联合类型和单一的type/interface, 使用 交叉类型 较多的场景是 <code>store</code>，为什么？</p>
<h4 id="项目中常见的需要利用泛型的几种类型：new-Promise-new-Map-new-Set等"><a href="#项目中常见的需要利用泛型的几种类型：new-Promise-new-Map-new-Set等" class="headerlink" title="项目中常见的需要利用泛型的几种类型：new Promise, new Map, new Set等"></a>项目中常见的需要利用泛型的几种类型：<code>new Promise</code>, <code>new Map</code>, <code>new Set</code>等</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>&lt;T&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> a = ref&lt;<span class="built_in">Map</span>&lt;tring, <span class="built_in">string</span>[]&gt;&gt;(<span class="keyword">new</span> <span class="built_in">Map</span>())</span><br></pre></td></tr></table></figure>

<h2 id="进阶：类型越来越多，每新增一个文件、每新增一个api、每新增一个函数都会面临类型不够用的情况"><a href="#进阶：类型越来越多，每新增一个文件、每新增一个api、每新增一个函数都会面临类型不够用的情况" class="headerlink" title="进阶：类型越来越多，每新增一个文件、每新增一个api、每新增一个函数都会面临类型不够用的情况"></a>进阶：类型越来越多，每新增一个文件、每新增一个api、每新增一个函数都会面临类型不够用的情况</h2><h3 id="1-梳理项目中的类型分类，文件结构"><a href="#1-梳理项目中的类型分类，文件结构" class="headerlink" title="1. 梳理项目中的类型分类，文件结构"></a>1. 梳理项目中的类型分类，文件结构</h3><blockquote>
<p>考虑众多的类型定义，引用，需要对所有类型进行划分，文件结构梳理，有哪几种方式？考虑以上涉及到的文件和使用地方，类型导出声明的几种方式，类型分布项目中的文件结构可能有哪几种？</p>
</blockquote>
<h3 id="2-先提炼类型最多，最频繁使用的文件：server-api-ts-store-modules-components-vue"><a href="#2-先提炼类型最多，最频繁使用的文件：server-api-ts-store-modules-components-vue" class="headerlink" title="2. 先提炼类型最多，最频繁使用的文件：server/api.ts, store/modules, components/*.vue"></a>2. 先提炼类型最多，最频繁使用的文件：<code>server/api.ts</code>, <code>store/modules</code>, <code>components/*.vue</code></h3><ol>
<li><p>提炼相近的结构</p>
 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以api.ts为例：前置条件为 基础方法都已经封装完毕，直接使用即可：get, post, put等</span></span><br><span class="line"><span class="keyword">import</span> &#123; post, get &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/server/index&#x27;</span></span><br><span class="line"><span class="comment">// 管理后台项目考虑众多的list接口返回的结构基本都是一致的，所以以下泛型其实并不需要</span></span><br><span class="line"><span class="keyword">const</span> getList = &lt;T&gt;<span class="function">(<span class="params">data: &#123;idList: <span class="built_in">string</span>[]&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> get&lt;T&gt;(<span class="string">&#x27;/path/to/get/list&#x27;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 修改如下</span></span><br><span class="line"><span class="keyword">import</span> &#123; ListReturnType &#125; <span class="keyword">from</span> <span class="string">&#x27;/path/to/interfaceAPI&#x27;</span></span><br><span class="line"><span class="keyword">const</span> getList = &lt;ListReturnType&gt;<span class="function">(<span class="params">data: &#123;idList: <span class="built_in">string</span>[]&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> get&lt;ListReturnType&gt;(<span class="string">&#x27;/path/to/get/list&#x27;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// interfaceAPI.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ListReturnType &#123;</span><br><span class="line">  records: <span class="built_in">string</span>[] | <span class="built_in">number</span>[] | Record&lt;<span class="built_in">string</span>, unknown&gt;[]</span><br><span class="line">  page: <span class="built_in">number</span></span><br><span class="line">  total: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用泛型，先不考虑合理的问题</p>
 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 考虑一种情况，返回类型由参数类型决定，此时最简单的就是泛型</span></span><br><span class="line"><span class="keyword">import</span> &#123; post, get &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/server/index&#x27;</span></span><br><span class="line"><span class="keyword">const</span> getListTypeByParamsType = &lt;T&gt;<span class="function">(<span class="params">data: T</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> get&lt;T[]&gt;(<span class="string">&#x27;/path/to/get/list&#x27;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在组件A.vue中使用：一个异步函数中获取返回值的类型，以便后续的操作</span></span><br><span class="line"><span class="keyword">const</span> getListFinallyA = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// getListTypeByParamsType: number[]</span></span><br><span class="line">  <span class="keyword">const</span> getNumberList = <span class="keyword">await</span> getListTypeByParamsType&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line">  <span class="keyword">const</span> handleNumList = getNumberList.filter(<span class="function"><span class="params">v</span> =&gt;</span> v &gt; <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在组件B.vue中使用</span></span><br><span class="line"><span class="keyword">const</span> getListFinallyB = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// getStringList: string[]</span></span><br><span class="line">  <span class="keyword">const</span> getStringList = <span class="keyword">await</span> getListTypeByParamsType&lt;<span class="built_in">string</span>&gt;()</span><br><span class="line">  <span class="keyword">const</span> handleStrList = getStringList.map(<span class="function"><span class="params">v</span> =&gt;</span> v.length)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将所用类型分类拆分，大量使用联合类型、交叉类型</p>
 <figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 考虑一种实际业务情况，一位客户的公开信息由：基础信息 &amp; 会员信息 &amp; 订单信息组成</span></span><br><span class="line"><span class="comment">// 对应的接口在不同页面或不同条件下返回的可能会只有其中1种或多种，而且只能在页面使用时才能确定类型，那么此时的接口返回类型怎么写比较好呢？</span></span><br><span class="line"><span class="comment">// interfaceAPI.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> GenderType = <span class="string">&#x27;f&#x27;</span> | <span class="string">&#x27;m&#x27;</span> | <span class="number">1</span> | <span class="number">-1</span> | <span class="number">2</span>; <span class="comment">// 考虑兼容情况</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> GoodsType &#123;</span><br><span class="line">  name: <span class="built_in">string</span></span><br><span class="line">  amount: <span class="built_in">number</span></span><br><span class="line">  id: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">type</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> BaseInfo &#123;</span><br><span class="line">  nickName: <span class="built_in">string</span></span><br><span class="line">  anyAge: <span class="built_in">number</span></span><br><span class="line">  gender: GenderType</span><br><span class="line">  children?: BaseInfo[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> MemberInfo &#123;</span><br><span class="line">  level: <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> | <span class="number">4</span> | <span class="number">5</span></span><br><span class="line">  numMember: <span class="built_in">string</span> | <span class="built_in">number</span></span><br><span class="line">  bonusPoint: <span class="built_in">number</span></span><br><span class="line">  timesConnected: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> OrderInfo &#123;</span><br><span class="line">  channels: <span class="string">&#x27;jd&#x27;</span> | <span class="string">&#x27;tmall&#x27;</span> | <span class="string">&#x27;pdd&#x27;</span> | <span class="string">&#x27;amazon&#x27;</span></span><br><span class="line">  totalAmount: <span class="built_in">number</span></span><br><span class="line">  purchasedGoods: GoodsType[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; get &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/server/index&#x27;</span></span><br><span class="line"><span class="keyword">const</span> getCustomerInfo = &lt;T&gt;<span class="function">(<span class="params">data: &#123; id: <span class="built_in">string</span>; <span class="keyword">type</span>?: <span class="built_in">number</span> &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> get&lt;T&gt;(<span class="string">&#x27;/path/to/get/list&#x27;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getCustomerInfoA = <span class="function">(<span class="params">id: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> getCustomerInfo&lt;BaseInfo&gt;(&#123;id, <span class="keyword">type</span>: <span class="number">0</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getCustomerInfoB = <span class="function">(<span class="params">id: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> getCustomerInfo&lt;BaseInfo &amp; MemberInfo&gt;(&#123;id, <span class="keyword">type</span>: <span class="number">1</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getCustomerInfoC = <span class="function">(<span class="params">id: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> getCustomerInfo&lt;BaseInfo &amp; MemberInfo &amp; OrderInfo&gt;(&#123;id, <span class="keyword">type</span>: <span class="number">2</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resA = getCustomerInfoA(<span class="string">&#x27;123&#x27;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; nickName &#125; = res</span><br><span class="line">  <span class="built_in">console</span>.log(nickName)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resB = getCustomerInfoB(<span class="string">&#x27;123&#x27;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; nickName, level &#125; = res</span><br><span class="line">  <span class="built_in">console</span>.log(nickName, level)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resC = getCustomerInfoC(<span class="string">&#x27;123&#x27;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; nickName, level, purchasedGoods &#125; = res</span><br><span class="line">  <span class="built_in">console</span>.log(nickName, level, purchasedGoods)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用部分联合类型时，考虑用 <code>Pick</code> <code>Omit</code> 等方法 </p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可选</span></span><br><span class="line"><span class="comment">// Partial&lt;Type&gt;</span></span><br><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  dess: <span class="built_in">string</span></span><br><span class="line">  children: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> PartialTodo = Todo = Partial&lt;Todo&gt;</span><br><span class="line"><span class="comment">// Equal to</span></span><br><span class="line"><span class="keyword">type</span> PartialTodo = &#123;</span><br><span class="line">  title?: <span class="built_in">string</span></span><br><span class="line">  desc?: <span class="built_in">string</span></span><br><span class="line">  children?: <span class="built_in">string</span>[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 必选</span></span><br><span class="line"><span class="comment">// Required&lt;Type&gt;</span></span><br><span class="line"><span class="keyword">type</span> RequiredPartialTodo = Required&lt;PartialTodo&gt;</span><br><span class="line"><span class="comment">// Equal to Todo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读</span></span><br><span class="line"><span class="comment">// Readonly&lt;Type&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Freeze</span>&lt;<span class="title">T</span>&gt;(<span class="params">obj: T</span>): <span class="title">Readonly</span>&lt;<span class="title">T</span>&gt;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="title">Pick</span>&lt;<span class="title">Type</span>, <span class="title">Keys</span>&gt; 只使用部分属性 - <span class="title">Keys</span> = <span class="title">Type</span>里的字符串或者字符串集合（并集）：&#x27;<span class="title">name</span>&#x27;, &#x27;<span class="title">name</span>&#x27; | &#x27;<span class="title">title</span>&#x27; | &#x27;<span class="title">desc</span>&#x27; 这2种形式</span></span><br><span class="line"><span class="function">// <span class="title">Omit</span>&lt;<span class="title">Type</span>, <span class="title">Keys</span>&gt; 忽略部分属性 - <span class="title">Keys</span> = <span class="title">Type</span>里的字符串或者字符串集合（并集）：&#x27;<span class="title">name</span>&#x27;, &#x27;<span class="title">name</span>&#x27; | &#x27;<span class="title">title</span>&#x27; | &#x27;<span class="title">desc</span>&#x27; 与 <span class="title">Pick</span>&lt;<span class="title">Type</span>, <span class="title">Keys</span>&gt; 正好相反</span></span><br><span class="line"><span class="function"><span class="title">type</span> <span class="title">partProps</span> = &#x27;<span class="title">title</span>&#x27; | &#x27;<span class="title">desc</span>&#x27;</span></span><br><span class="line"><span class="function"><span class="title">type</span> <span class="title">TodoPreview</span> = <span class="title">Pick</span>&lt;<span class="title">Todo</span>, <span class="title">partProps</span>&gt;</span></span><br><span class="line"><span class="function"><span class="title">const</span> <span class="title">todoPreview</span>: <span class="title">TodoPreview</span> = </span>&#123;</span><br><span class="line">  titel: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">  desc: <span class="string">&#x27;555&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exclude&lt;Type, ExcludeUnion&gt; 排除联合类型内的某个或者某些类型</span></span><br><span class="line"><span class="keyword">type</span> T0 = Exclude&lt;<span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>&gt; <span class="comment">// type T0 = &#x27;a&#x27; | &#x27;b&#x27;</span></span><br><span class="line"><span class="keyword">type</span> T1 = Exclude&lt;<span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;c&#x27;</span>&gt; <span class="comment">// type T0 = &#x27;b&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Extract&lt;Type, Union&gt; 提取 Type 和 Union 的交集</span></span><br><span class="line"><span class="keyword">type</span> T2 = Extract&lt;<span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;b&#x27;</span> | <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span> | <span class="string">&#x27;f&#x27;</span>&gt; <span class="comment">// type T2 = &#x27;a&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 与函数相关的实用方法</span></span><br><span class="line"><span class="comment">// Parameters&lt;Type&gt; 提取函数参数类型</span></span><br><span class="line"><span class="comment">// ConstructorParameters&lt;Type&gt; 提取构造函数参数类型：ErrorConstructor, FunctionConstructor, RegExpConstructor 等</span></span><br><span class="line"><span class="comment">// ReturenType&lt;Type&gt; 提取函数返回类型</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不常用到的实用方法</span></span><br><span class="line"><span class="comment">// ThisParameterType&lt;Type&gt; 提取`有this`的函数参数类型，或者提不到就是 unknown</span></span><br><span class="line"><span class="comment">// ThisType&lt;Type&gt; 不返回转换类型，只作为一个上下文相关的 this 类型 的标记，必须`tsconfig.ts`开启 `noImplicitThis`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 内置字符串操作类型</span></span><br><span class="line"><span class="comment">// Uppercase&lt;StringType&gt; 全部大写</span></span><br><span class="line"><span class="comment">// Lowercase&lt;StringType&gt; 全部小写</span></span><br><span class="line"><span class="comment">// Capitalize&lt;StringType&gt; 首字母大写</span></span><br><span class="line"><span class="comment">// Uncapitalize&lt;StringType&gt; 非首字母大写</span></span><br></pre></td></tr></table></figure>


<h2 id="部分答案，仅供参考，如有错误，概不负责，请自行甄别"><a href="#部分答案，仅供参考，如有错误，概不负责，请自行甄别" class="headerlink" title="部分答案，仅供参考，如有错误，概不负责，请自行甄别"></a>部分答案，仅供参考，如有错误，概不负责，请自行甄别</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// some-detail.vue script.lang = ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive, ref, toRefs, PropType &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; useStore &#125; <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; key &#125; <span class="keyword">from</span> <span class="string">&#x27;path/to/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    list: <span class="built_in">Array</span> <span class="keyword">as</span> PropType&lt;<span class="built_in">string</span>[]&gt;, <span class="comment">// round 0: props 使用 PropType 强制转换类型为具体类型</span></span><br><span class="line">    <span class="keyword">default</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// setup 内部</span></span><br><span class="line">  <span class="comment">// round 1: 给props 提供具体的类型 &#123; list: string[] &#125;</span></span><br><span class="line">  setup: <span class="function">(<span class="params">props: &#123;list: <span class="built_in">string</span>[]&#125;</span>) =&gt;</span>  &#123;</span><br><span class="line">  <span class="comment">// round 2: </span></span><br><span class="line">    <span class="keyword">const</span> leftType = reactive&lt;&#123;</span><br><span class="line">      rightType: <span class="built_in">number</span></span><br><span class="line">      list: &#123;label: <span class="built_in">string</span>;value: <span class="built_in">number</span> | <span class="built_in">string</span>; extraProps?: <span class="built_in">string</span>&#125;[]</span><br><span class="line">    &#125;&gt;(&#123;</span><br><span class="line">      rightType: <span class="number">0</span>,</span><br><span class="line">      list: []</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// round 3: v: &#123;label: &#x27;&#x27;, value: 0, extraProps?: &#x27;&#x27;&#125;</span></span><br><span class="line">    <span class="keyword">const</span> newArray = leftType.list.map(<span class="function"><span class="params">v</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...v,</span><br><span class="line">        extraProps: v.label</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// round 4: 只要没有明确 return 都是void, 特殊情况为 never</span></span><br><span class="line">    <span class="keyword">const</span> textFunc = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// do something but do not return anything</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// round 5: 简单类型可以自动推导</span></span><br><span class="line">    <span class="keyword">const</span> hasTrue = ref(<span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> isStr = ref(<span class="string">&#x27;initStr&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// round 6: props在setup引入的时候就应该定义list类型，此处是 string[]</span></span><br><span class="line">    <span class="keyword">const</span> &#123; list &#125; = toRefs(props) <span class="comment">// list: string[]</span></span><br><span class="line">    <span class="comment">// round 7: 在createStore 就已经定义完成，不必在左边加 any</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> key: InjectionKey&lt;Store&lt;LoginState &amp; PermissionState &amp; UserState&gt;&gt; = <span class="built_in">Symbol</span>(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> store = createStore&lt;LoginState &amp; UserState &amp; PermissionState&gt;(&#123;</span><br><span class="line">      modules</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// store 类型即推导出的类型</span></span><br><span class="line">    <span class="keyword">const</span> store = useStore(key)</span><br><span class="line">    <span class="comment">// round 8: 参照 api.ts 的修改</span></span><br><span class="line">    <span class="keyword">const</span> getData = getDataByAxiosApi().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> ret = res</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/04/15/using-es6-in-node-when-write-plugin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/using-es6-in-node-when-write-plugin/" class="post-title-link" itemprop="url">开发vite相关插件的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-15 15:50:22" itemprop="dateCreated datePublished" datetime="2021-04-15T15:50:22+08:00">2021-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-07 14:15:23" itemprop="dateModified" datetime="2021-12-07T14:15:23+08:00">2021-12-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>温馨提示： 先别替换 ant-design-vue 中的 moment 为 dayjs, 有bug, date-picker会坏掉，等作者修好再换</p>
</blockquote>
<p>本项目的技术栈是：<code>vite vue3 ant-desing-vue</code>。<br>项目中需要用到的<code>ant-desing-vue</code>UI 组件依赖<code>moment</code>,我看官网提示有插件可以改成<code>dayjs</code>,可以使整个包小一点，看了<code>antd-dayjs-webpack-plugin</code>的代码后发现没有针对<code>vite ant-desing-vue</code>的,就跃跃欲试想写一个<code>vite-plugin-vue-ant-desing-vue-dayjs</code>插件，专门用在<code>vite vue3 ant-desing-vue</code>项目中。后面其实发现没必要，当然，写完才发现-_-||</p>
<h2 id="主要问题"><a href="#主要问题" class="headerlink" title="主要问题"></a>主要问题</h2><h3 id="叠了-3-个-debuff-导致运行时出问题"><a href="#叠了-3-个-debuff-导致运行时出问题" class="headerlink" title="叠了 3 个 debuff 导致运行时出问题"></a>叠了 3 个 debuff 导致运行时出问题</h3><ol>
<li>由于我 fork 了一部分<code>antd-dayjs-webpack-plugin</code>代码，内部是<code>module.exports</code></li>
<li>同时入口文件里是直接<code>export default vitePluginVueAntDVueDayjs(Options=&#123;&#125;) &#123;...&#125;</code></li>
<li>而且是直接<code>yarn add git+ssh://git@github.com:xxx/some-project.git --dev</code>，这个<code>some-project</code>就是写的插件，<code>package.json</code>里暴露的直接是<code>main: src/index.js</code>,</li>
</ol>
<p>第一次写插件，心情十分激动结果刚运行就报错,搜了一下原来是 node 环境里不能直接加载<code>ES6</code>模块。。。于是我重新看了一次 es6 文档<code>node 环境如何加载es6模块</code>，然后查了一下<code>@vite/plugin-vue</code>的解决办法</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>完全采用 cjs 模块方式编写，一水儿的<code>module.export</code> -&gt; 针对入口文件非打包后的插件。如<code>package.json中的main: src/index.js</code></li>
<li>将 es6 模块打包编译成 node 模块（@vite/plugin-vue）就是这么做的：<code>esbuild src/index.ts --bundle --platform=node --target=node12 --external:@vue/compiler-sfc --outfile=dist/index.js</code> -&gt; 完全使用 es6 模块编写插件，然后使用打包后的 cjs 模块, <code>package.json中的main: dist/index.js</code></li>
</ol>
<h2 id="没必要写是因为直接配置即可"><a href="#没必要写是因为直接配置即可" class="headerlink" title="没必要写是因为直接配置即可"></a>没必要写是因为直接配置即可</h2><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行</span></span><br><span class="line"><span class="comment"># npm i dayjs</span></span><br><span class="line">yarn add dayjs</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js文件</span></span><br><span class="line">&#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      moment: <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> isSameOrBefore <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/isSameOrBefore&#x27;</span></span><br><span class="line"><span class="keyword">import</span> isSameOrAfter <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/isSameOrAfter&#x27;</span></span><br><span class="line"><span class="keyword">import</span> advancedFormat <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/advancedFormat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> customParseFormat <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/customParseFormat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> weekday <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/weekday&#x27;</span></span><br><span class="line"><span class="keyword">import</span> weekOfYear <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/weekOfYear&#x27;</span></span><br><span class="line"><span class="keyword">import</span> isMoment <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/isMoment&#x27;</span></span><br><span class="line"><span class="keyword">import</span> localeData <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/localeData&#x27;</span></span><br><span class="line"><span class="keyword">import</span> localizedFormat <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/localizedFormat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span> <span class="comment">// 导入本地化语言</span></span><br><span class="line"></span><br><span class="line">dayjs.extend(isSameOrBefore)</span><br><span class="line">dayjs.extend(isSameOrAfter)</span><br><span class="line">dayjs.extend(advancedFormat)</span><br><span class="line">dayjs.extend(customParseFormat)</span><br><span class="line">dayjs.extend(weekday)</span><br><span class="line">dayjs.extend(weekOfYear)</span><br><span class="line">dayjs.extend(isMoment)</span><br><span class="line">dayjs.extend(localeData)</span><br><span class="line">dayjs.extend(localizedFormat)</span><br><span class="line">dayjs.locale(<span class="string">&#x27;zh-cn&#x27;</span>) <span class="comment">// 使用本地化语言</span></span><br></pre></td></tr></table></figure></code></pre>
<h2 id="插件步骤"><a href="#插件步骤" class="headerlink" title="插件步骤"></a>插件步骤</h2><p>如果要写也不是不行：看上面的配置步骤即可知道思路，可参考项目<a href="https://github.com/MillyTang/vite-plugin-for-antd-dayjs">vite-plugin-vue-antd-dayjs</a></p>
<h3 id="第一种：-使用非打包插件"><a href="#第一种：-使用非打包插件" class="headerlink" title="第一种： 使用非打包插件"></a>第一种： 使用非打包插件</h3><blockquote>
<p>有个直接的好处，安装后可以直接修改包文件来测试代码逻辑是否正确，即改即用,我当时采用的就是这种写法</p>
</blockquote>
<h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目结构</span></span><br><span class="line">|-- src</span><br><span class="line">|----|--index.js</span><br><span class="line">|-- package.json</span><br><span class="line">|-- README.md</span><br></pre></td></tr></table></figure>

<h4 id="2-package-json-配置"><a href="#2-package-json-配置" class="headerlink" title="2. package.json 配置"></a>2. package.json 配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packgae.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;vite-plugin-xxx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Description of the vite-plugin-xxx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [<span class="string">&quot;vite-plugin&quot;</span>, <span class="string">&quot;vite-plugin-vue&quot;</span>, <span class="string">&quot;rollup-plugin&quot;</span>, <span class="string">&quot;xxx&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;engines&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;node&quot;</span>: <span class="string">&quot;&gt;=12.0.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;bugs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;your Name&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-入口文件"><a href="#3-入口文件" class="headerlink" title="3. 入口文件"></a>3. 入口文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">VitePluginVueXXX</span>(<span class="params">Options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFile = <span class="string">&quot;@virtual-file&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">&quot;vite-plugin-vue-xxx&quot;</span>,</span><br><span class="line">    enforce: <span class="string">&quot;pre&quot;</span>, <span class="comment">// 加载vite内置插件之前加载</span></span><br><span class="line">    config: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="string">&quot;resolve.alias&quot;</span>: &#123;</span><br><span class="line">        moment: <span class="string">&quot;dayjs&quot;</span>, <span class="comment">// set dayjs alias</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;), <span class="comment">// 在被解析之前修改 Vite 配置</span></span><br><span class="line">    configResolved(resolvedConfig) &#123;</span><br><span class="line">      <span class="comment">// 存储最终解析的配置</span></span><br><span class="line">      config = resolvedConfig;</span><br><span class="line">    &#125;, <span class="comment">// 在解析 Vite 配置后调用</span></span><br><span class="line">    resolveId(id) &#123;</span><br><span class="line">      <span class="comment">// 每个传入的模块请求时被调用</span></span><br><span class="line">      <span class="keyword">if</span> (id === virtualFile) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;resolveid id test&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    load(id) &#123;</span><br><span class="line">      <span class="comment">// 每个传入的模块请求时被调用</span></span><br><span class="line">      <span class="keyword">if</span> (id === virtualFile) &#123;</span><br><span class="line">        <span class="comment">// 在这里return上面main.js引入的插件和依赖</span></span><br><span class="line">        <span class="comment">// 如果需要知道哪些插件必须引入，直接查看dayjs官网的插件合集</span></span><br><span class="line">        <span class="comment">// return 出去的是 `@virtual-file`的文件内容，这里写成 `const xxx = require(&#x27;xxx&#x27;)` or `import xxx from &#x27;xxxx&#x27;`都是可以的，注意在`main.js`内的引用形式即可</span></span><br><span class="line">        <span class="comment">// 例如：isMoment plugin</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`const isMoment =  require(&#x27;dayjs/plugin/isMoment&#x27;); dayjs.extend(isMoment);module.exports = &#123;isMoment&#125;`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-安装-没有发布的包文件"><a href="#4-安装-没有发布的包文件" class="headerlink" title="4. 安装 没有发布的包文件"></a>4. 安装 没有发布的包文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 插件的 peerDependencies</span></span><br><span class="line">yarn add dayjs</span><br><span class="line"><span class="comment"># 安没有发布的装插件包</span></span><br><span class="line">yarn add git+ssh://git@github.com:xxx.git --dev</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 vite.config内配置</span></span><br><span class="line"><span class="comment">// 引入插件</span></span><br><span class="line">  <span class="keyword">const</span> vitePluginVueForAntdDayjs = <span class="built_in">require</span>(<span class="string">&#x27;vite-plugin-vue-antd-dayjs&#x27;</span>)</span><br><span class="line"> &#123;</span><br><span class="line">    plugins:  [vue(),vitePluginVueForAntdDayjs()],</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      alias: &#123;</span><br><span class="line">        moment: <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-在-main-js-里引入虚拟文件即可"><a href="#5-在-main-js-里引入虚拟文件即可" class="headerlink" title="5. 在 main.js 里引入虚拟文件即可"></a>5. 在 main.js 里引入虚拟文件即可</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以 isMoment 为例</span></span><br><span class="line"><span class="comment">// 在 mjs 内 引入 cjs 模块</span></span><br><span class="line"><span class="keyword">import</span> isMoment <span class="keyword">from</span> <span class="string">&quot;@virtual-file&quot;</span>;</span><br><span class="line"><span class="comment">// 如果模块很多，一次引入很多模块, 直接引入文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;@virtual-file&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动项目： <code>yarn dev</code>, vite 打包会发现有提示：<code>[vite] new dependencies found: dayjs/plugin/isSameOrAfter, dayjs/plugin/advancedFormat, dayjs/plugin/customParseFormat, dayjs/plugin/weekday, dayjs/plugin/weekYear, dayjs/plugin/weekOfYear, dayjs/plugin/isMoment, dayjs/plugin/localeData, dayjs/plugin/localizedFormat, dayjs/locale/zh-cn, updating...</code> 说明已经成功引入</p>
</blockquote>
<h4 id="6-打包比较前后包的差异"><a href="#6-打包比较前后包的差异" class="headerlink" title="6. 打包比较前后包的差异"></a>6. 打包比较前后包的差异</h4><h3 id="第二种：使用打包后的插件"><a href="#第二种：使用打包后的插件" class="headerlink" title="第二种：使用打包后的插件"></a>第二种：使用打包后的插件</h3><blockquote>
<p>步骤跟上面的差不多，只是写的时候使用 es6 模块,多一步打包&amp;入口文件有点不同，可参考项目<a href="https://github.com/MillyTang/vite-plugin-antd-vue-ts">vite-plugin-antd-vue-ts</a></p>
</blockquote>
<ol>
<li><p>packgae.json 的配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;dist/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;types&quot;</span>: <span class="string">&quot;dist/index.d.ts&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;build:boundle&quot;</span>: <span class="string">&quot;`esbuild src/index.ts --bundle --platform=node --target=node12 --external:dayjs --outfile=dist/index.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;esbuild&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>入口文件</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">VitePluginVueXXX</span>(<span class="params">Options = &#123;&#125;</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>执行打包命令</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build:boudle</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置 <code>vite.config.js</code> &amp; 在<code>main.js</code>引入文件步骤同上</li>
</ol>
<blockquote>
<p>如果要实现在入口文件的引用方式为 <code>import someplugin from &#39;path/to/all-plugin-file-name&#39;</code>,在插件内使用 <code>export default</code> 和 <code>module.exports</code>是一样的效果</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/02/18/vite2-vue3-ts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/18/vite2-vue3-ts/" class="post-title-link" itemprop="url">构建 vite2 & Vue3 & ts项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-18 17:27:53" itemprop="dateCreated datePublished" datetime="2021-02-18T17:27:53+08:00">2021-02-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-07 14:15:23" itemprop="dateModified" datetime="2021-12-07T14:15:23+08:00">2021-12-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="步骤总览"><a href="#步骤总览" class="headerlink" title="步骤总览"></a>步骤总览</h2><h3 id="开发前配置"><a href="#开发前配置" class="headerlink" title="开发前配置"></a>开发前配置</h3><ol>
<li>命令行使用 vite 生成项目模板</li>
<li>配置 TypeScript:<ol>
<li>tsconfig 配置</li>
<li>安装 ts 类型检查</li>
</ol>
</li>
<li>集中处理请求【Axios 库】</li>
<li>分支管理保护与自动化的2种方式，1个必要</li>
</ol>
<h3 id="开始开发"><a href="#开始开发" class="headerlink" title="开始开发"></a>开始开发</h3><ol>
<li>配置环境文件</li>
<li>配置别名【可选】</li>
<li>配置路由</li>
<li>选择&amp;调研组件库</li>
<li>配置主题文件</li>
<li>安装 CSS 预处理器</li>
<li>开发过程中与 vue3 开发文档相关的一些知识点</li>
<li>开发过程中常见的问题</li>
<li><a target="_blank" rel="noopener" href="https://millytang.github.io/2021/09/12/ts-in-vue3/">在项目中写出可维护可拓展的类型</a></li>
</ol>
<blockquote>
<p>结尾提供了其他相关链接</p>
</blockquote>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><blockquote>
<p>使用 nvm 切换不同版本的 node 来适用不同项目</p>
</blockquote>
<h3 id="命令行使用-vite-生成项目模板"><a href="#命令行使用-vite-生成项目模板" class="headerlink" title="命令行使用 vite 生成项目模板"></a>命令行使用 vite 生成项目模板</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line"><span class="comment"># v8.9.4</span></span><br><span class="line">nvm use 12</span><br><span class="line"><span class="comment"># Now using node v12.19.0 (npm v6.14.8)</span></span><br><span class="line">yarn create @vitejs/app</span><br><span class="line"><span class="comment"># 选择 vue-ts 预设模板</span></span><br><span class="line"><span class="built_in">cd</span> my-vue3-vite2-app</span><br><span class="line">yarn</span><br><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<h3 id="配置-TypeScript"><a href="#配置-TypeScript" class="headerlink" title="配置 TypeScript"></a>配置 TypeScript</h3><h4 id="tsconfig-json-文件-增加-2-项配置"><a href="#tsconfig-json-文件-增加-2-项配置" class="headerlink" title="tsconfig.json 文件 增加 2 项配置"></a>tsconfig.json 文件 增加 2 项配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;vite/client&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="安装-ts-类型检查"><a href="#安装-ts-类型检查" class="headerlink" title="安装 ts 类型检查"></a>安装 ts 类型检查</h4><blockquote>
<p>打开 vite.config.ts 文件时 控制台就会报 failed to load the eslint library for the vite.config.ts 错误，这是因为本地 eslint 无法解析 ts 文件，需要安装 ts 依赖 &amp; vite 不提供 ts 类型检查</p>
</blockquote>
<ul>
<li>详见<a href="https://github.com/typescript-eslint/typescript-eslint/blob/master/docs/getting-started/linting/README.md">typescript-eslint 配置</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装ts eslint 依赖</span></span><br><span class="line"><span class="comment"># node version &gt;= 12</span></span><br><span class="line"><span class="comment"># 注意：以下包不提供对 *.vue 文件的检查</span></span><br><span class="line">yarn add -D eslint typescript @typescript-eslint/parser @typescript-eslint/eslint-plugin</span><br><span class="line"><span class="comment"># 如需在开发过程中对 *.vue 文件进行类型检查，请增加以下包支持</span></span><br><span class="line"><span class="comment"># yarn add -D eslint-plugin-vue</span></span><br><span class="line"><span class="comment"># 安装node变量的类型声明</span></span><br><span class="line">npm i --save-dev @types/node</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下载额外的<code>npm</code>包需要添加其他类型定义：1.安装<code>npm i --save-dev @types/xxx</code>；2.在<code>tsconfig.json</code>中添加``types`的配置『 <strong><em>由于 vite2 创建的 ts 项目中已添加默认的 types 定义，标明只使用该类型定义，所以如果需要其他类型（不在@vite/client 中），需要增加配置</em></strong> 』</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line"><span class="comment">// 在 node 后面增加一项xxx即可</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;vite/client&quot;</span>, <span class="string">&quot;node&quot;</span>, <span class="string">&quot;xxx&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本项目使用 eslint:recommended 规范，如需修改请参照 tslint 官方提示</p>
</blockquote>
<ol>
<li><p>工作目录下新增 <code>.eslintrc.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不含  eslint-plugin-vue 插件的配置</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parser: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">  plugins: [<span class="string">&quot;@typescript-eslint&quot;</span>],</span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>, <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 包含  eslint-plugin-vue 插件的配置</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parser: <span class="string">&quot;vue-eslint-parser&quot;</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">    ecmaVersion: <span class="number">2020</span>,</span><br><span class="line">    sourceType: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">    ecmaFeatures: &#123;</span><br><span class="line">      jsx: <span class="literal">true</span>,</span><br><span class="line">      tsx: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="string">&quot;@typescript-eslint&quot;</span>],</span><br><span class="line">  <span class="keyword">extends</span>: [</span><br><span class="line">    <span class="string">&quot;plugin:vue/vue3-recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>工作目录下新增 <code>.eslintignore</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># don&#39;t ever lint node_modules</span><br><span class="line">node_modules</span><br><span class="line"># don&#39;t lint build output (make sure it&#39;s set to your correct build folder name)</span><br><span class="line">dist</span><br><span class="line"># don&#39;t lint nyc coverage output</span><br><span class="line">coverage</span><br><span class="line"># don&#39;t lint .vscode</span><br><span class="line">.vscode</span><br><span class="line"># don&#39;t lint .eslintrc.js</span><br><span class="line">.eslintrc.js</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="配置请求-Axios-集中处理请求"><a href="#配置请求-Axios-集中处理请求" class="headerlink" title="配置请求 Axios 集中处理请求"></a>配置请求 Axios 集中处理请求</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server/index.ts 文件</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosRequestConfig, Method &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&quot;qs&quot;</span>;</span><br><span class="line"><span class="comment">// 请求常量配置</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="keyword">import</span>.meta.env.VITE_APP_BASE_URL <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">const</span> SEUCCESS_CODE = [<span class="string">&quot;200&quot;</span>]; <span class="comment">// 多个code可兼容历史api的成功返回值</span></span><br><span class="line"><span class="keyword">const</span> SPECIAL_CODE_403 = []; <span class="comment">// 添加业务要求的 无权限的code码</span></span><br><span class="line"><span class="keyword">const</span> LOGOUT_CODE = []; <span class="comment">// 添加业务要求登出的code码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> resType = <span class="string">&quot;json&quot;</span> | <span class="string">&quot;blob&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">  baseURL: BASE_URL,</span><br><span class="line">  timeout: <span class="number">30000</span>,</span><br><span class="line">  withCredentials: <span class="literal">true</span>, <span class="comment">// 表示跨域请求时是否需要使用凭证</span></span><br><span class="line">  validateStatus: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt;= <span class="number">304</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  paramsSerializer: <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> qs.stringify(params);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 创建一个基本函数，后续的 post &amp; get方法都基于baseFunc</span></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">instance.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如需自定义config,可在调用api时传入，在此处修改、增加、覆盖</span></span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">      ...config,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        ...config.headers,</span><br><span class="line">        <span class="comment">// &#x27;X-TOKEN&#x27;: config.headers[&#x27;X-TOKEN&#x27;] || &#x27;default value or test token for testing&#x27; // 请求头自定义token, 重置 responseType || Content-Type</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">instance.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; status, data &#125;: &#123; status: <span class="built_in">number</span>; data: <span class="built_in">any</span> &#125; = response;</span><br><span class="line">    <span class="comment">// 特殊处理返回类型是 blob 类型的请求</span></span><br><span class="line">    <span class="keyword">if</span> (status === <span class="number">200</span> &amp;&amp; response.config.responseType === <span class="string">&quot;blob&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = data;</span><br><span class="line">    <span class="keyword">if</span> (SEUCCESS_CODE.includes(code + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 符合请求成功标准</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data.data || &#123;&#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (SPECIAL_CODE_403.includes(code + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 403需要重新授权</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LOGOUT_CODE.includes(code + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 意外登出，重新登录</span></span><br><span class="line">      <span class="comment">// reLogin</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data);</span><br><span class="line">      <span class="comment">// return Promise.resolve(data)</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 统一弹窗提示错误</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 集中处理超时错误</span></span><br><span class="line">    <span class="comment">// 或者 统一向上抛出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 基本配置</span></span><br><span class="line"><span class="comment">// 这里有2种方式可以返回 使用api时配置的返回类型</span></span><br><span class="line"><span class="comment">// 1. 直接在根目录下添加 Axios 的类型声明，改写返回类型</span></span><br><span class="line"><span class="comment">// 2. 引入Axios是点击查看 Axios 定义的类型，在使用 `instance.request` 时改成返回传入泛型即可</span></span><br><span class="line"><span class="comment">// 这里我们使用第二种方式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>&lt;<span class="title">T</span>&gt;(<span class="params">method: Method, url: <span class="built_in">string</span>, config: AxiosRequestConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>&lt;T&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    instance</span><br><span class="line">      .request&lt;T, T&gt;(&#123;</span><br><span class="line">        method: method,</span><br><span class="line">        url: url,</span><br><span class="line">        ...config,</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve(res);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 后续根据具体参数类型返回</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">put</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;PUT&quot;</span>, url, &#123; data &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span>, responseType?: resType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;POST&quot;</span>, url, &#123; data, responseType &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">del</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;DELETE&quot;</span>, url, &#123; data &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, params?: <span class="built_in">any</span>, responseType?: resType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;GET&quot;</span>, url, &#123; params, responseType &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> instance;</span><br></pre></td></tr></table></figure>

<h4 id="使用定义好的-post-get等方法"><a href="#使用定义好的-post-get等方法" class="headerlink" title="使用定义好的 post, get等方法"></a>使用定义好的 <code>post, get</code>等方法</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const-api-path.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> POST_SOME_LIST = <span class="string">&quot;/path/to/some/list&quot;</span>;</span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; post, get &#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; POST_SOME_LIST &#125; <span class="keyword">from</span> <span class="string">&quot;./const-api-path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ListReturnType, ListParamType &#125; <span class="keyword">from</span> <span class="string">&quot;./api-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSomeList = <span class="function">(<span class="params">data: ListParamType</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> post&lt;ListReturnType&gt;(POST_SOME_LIST, data);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h3 id="分支管理保护与自动化"><a href="#分支管理保护与自动化" class="headerlink" title="分支管理保护与自动化"></a>分支管理保护与自动化</h3><blockquote>
<p>测试环境的发布分支只有 2 个： dev, hotfix</p>
</blockquote>
<h4 id="分支管理、保护的2种方式，1个必要"><a href="#分支管理、保护的2种方式，1个必要" class="headerlink" title="分支管理、保护的2种方式，1个必要"></a>分支管理、保护的2种方式，1个必要</h4><blockquote>
<p>基础仓库影响范围较大，分别对应多个项目的不同阶段，则需要对该项目进行分支管理和保护，通常只保护3个主要分支： main, dev,hotfix</p>
</blockquote>
<h5 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h5><blockquote>
<p>一个新需求的全部工作流程</p>
</blockquote>
<ol>
<li>新建功能分支，以 <code>feature-</code> 开头</li>
<li>功能开发结束给 <code>dev</code> 提 <code>merge request</code></li>
<li>代码审核结束成功合并到 <code>dev</code>后，开始测试</li>
<li>通过测试后提交 <code>merge request</code> 到 <code>main</code>分支准备发布</li>
<li>发布成功且线上验收成功后，在最新提交上打 <code>tag</code>, 并推送 tags</li>
<li>保留该功能分支 2 周删除该分支对应的远程分支，以防后续开发功能分支越来越多</li>
</ol>
<blockquote>
<p>一个紧急修复的全部流程</p>
</blockquote>
<ol>
<li><code>git checkout hotfix</code></li>
<li><code>git pull</code></li>
<li>开始修复，修复结束后提交代码发布到测试环境测试</li>
<li>通过测试后提交 mr 到 <code>main</code>分支准备发布</li>
<li>发布成功且线上验收成功后，在最新提交上打 <code>tag</code>, 并推送 tags</li>
</ol>
<h5 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h5><blockquote>
<p>一个主仓库分别由各个开发fork到自己的group, 主仓库只保留3个分支：main(稳定版本-线上环境), hotfix(紧急修复-发布测试环境), dev(开发时-发布测试环境), fork仓库完全由开发者自行管理</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fork后的项目新增一个 remote</span></span><br><span class="line">git remote add source-hub-name source-hub-ssh-path-or-https-path</span><br><span class="line"><span class="comment"># 拉取 主仓库所有分支</span></span><br><span class="line">git fetch source-hub-name</span><br><span class="line"><span class="comment"># 建立开发进度对应分支</span></span><br><span class="line">git checkout -b dev-source-hub-name</span><br><span class="line"><span class="comment"># 拉取 主仓库 dev 分支所有commit</span></span><br><span class="line">git pull source-hub-name dev</span><br><span class="line"><span class="comment"># 回到dev分支，合并主仓库进度</span></span><br><span class="line">git checkout dev</span><br><span class="line"><span class="comment"># 或者仅pick部分提交</span></span><br><span class="line">git merge dev-source-hub-name</span><br></pre></td></tr></table></figure>

<h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><h3 id="配置环境文件"><a href="#配置环境文件" class="headerlink" title="配置环境文件"></a>配置环境文件</h3><ul>
<li>构建包文件会通过环境文件来确定环境变量，在项目下新增:<ul>
<li><code>.env.production</code>文件</li>
<li><code>.env.development</code>文件</li>
<li><code>.env.stagging</code>文件</li>
</ul>
</li>
</ul>
<h3 id="配置别名【可选】"><a href="#配置别名【可选】" class="headerlink" title="配置别名【可选】"></a>配置别名【可选】</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [vue()],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.resolve(__dirname, <span class="string">&quot;./src&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add vue-router@4</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HelloWorld <span class="keyword">from</span> <span class="string">&quot;@/components/hello-world.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory, RouteRecordRaw &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由懒加载</span></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../components/about.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> routes: RouteRecordRaw[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    component: HelloWorld, <span class="comment">// 非懒加载</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    component: About,</span><br><span class="line">    <span class="comment">// meta类型需要额外声明，此声明在 src/typings/augmenation.d.ts内</span></span><br><span class="line">    meta: &#123;</span><br><span class="line">      isAdmin: <span class="literal">false</span>,</span><br><span class="line">      title: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<h4 id="添加额外的-meta-字段的类型声明"><a href="#添加额外的-meta-字段的类型声明" class="headerlink" title="添加额外的 meta 字段的类型声明"></a>添加额外的 meta 字段的类型声明</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// augmenation.d.ts</span></span><br><span class="line"><span class="comment">// Ensure this file is parsed as a module regardless of dependencies.</span></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> &quot;vue-router&quot; &#123;</span><br><span class="line">  <span class="comment">// 自定义元字段声明</span></span><br><span class="line">  <span class="keyword">interface</span> RouteMeta &#123;</span><br><span class="line">    <span class="comment">// is optional</span></span><br><span class="line">    isAdmin?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="comment">// is optional</span></span><br><span class="line">    requiresAuth?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="comment">// must be declared by every route</span></span><br><span class="line">    title: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加路由元信息声明"><a href="#添加路由元信息声明" class="headerlink" title="添加路由元信息声明"></a>添加路由元信息声明</h4><h3 id="选择组件库-☞-本项目使用-ant-design-vue-所以选用-less-方便覆盖默认主题"><a href="#选择组件库-☞-本项目使用-ant-design-vue-所以选用-less-方便覆盖默认主题" class="headerlink" title="选择组件库 ☞ 本项目使用 ant-design-vue, 所以选用 less, 方便覆盖默认主题"></a>选择组件库 ☞ 本项目使用 <code>ant-design-vue</code>, 所以选用 less, 方便覆盖默认主题</h3><h4 id="配置主题文件"><a href="#配置主题文件" class="headerlink" title="配置主题文件"></a>配置主题文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用插件转换文件</span></span><br><span class="line"><span class="keyword">import</span> lessToJS <span class="keyword">from</span> <span class="string">&#x27;less-vars-to-js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> themeVariables = lessToJS(</span><br><span class="line">  fs.readFileSync(path.resolve(__dirname, <span class="string">&#x27;./src/styles/variable.less&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    preprocessorOptions: &#123;</span><br><span class="line">      <span class="comment">// 在这里覆盖css全局变量, 可覆盖变量可在varible.less中查看</span></span><br><span class="line">      less: &#123;</span><br><span class="line">        modifyVars: themeVariables,</span><br><span class="line">        javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安装-CSS-预处理器"><a href="#安装-CSS-预处理器" class="headerlink" title="安装 CSS 预处理器"></a>安装 CSS 预处理器</h3><blockquote>
<p>请匹配 组件库 的选择</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .scss and .sass</span></span><br><span class="line">npm install -D sass</span><br><span class="line"><span class="comment"># .less</span></span><br><span class="line">npm install -D less</span><br><span class="line"><span class="comment"># .styl and .stylus</span></span><br><span class="line">npm install -D stylus</span><br></pre></td></tr></table></figure>

<h4 id="替换-moment-为-dayjs"><a href="#替换-moment-为-dayjs" class="headerlink" title="替换 moment 为 dayjs"></a>替换 moment 为 dayjs</h4><ol>
<li><p><code>yarn add dayjs</code> or <code>npm i dayjs</code></p>
</li>
<li><p>在 <code>vite.config</code>中添加 alias</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      moment: <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>main.ts</code>文件里添加相关插件, 添加前后分别打包进行比较</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&quot;dayjs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isSameOrBefore <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/isSameOrBefore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isSameOrAfter <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/isSameOrAfter&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> advancedFormat <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/advancedFormat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> customParseFormat <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/customParseFormat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> weekday <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/weekday&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> weekOfYear <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/weekOfYear&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isMoment <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/isMoment&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> localeData <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/localeData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> localizedFormat <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/localizedFormat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;dayjs/locale/zh-cn&quot;</span>; <span class="comment">// 导入本地化语言</span></span><br><span class="line"></span><br><span class="line">dayjs.extend(isSameOrBefore);</span><br><span class="line">dayjs.extend(isSameOrAfter);</span><br><span class="line">dayjs.extend(advancedFormat);</span><br><span class="line">dayjs.extend(customParseFormat);</span><br><span class="line">dayjs.extend(weekday);</span><br><span class="line">dayjs.extend(weekOfYear);</span><br><span class="line">dayjs.extend(isMoment);</span><br><span class="line">dayjs.extend(localeData);</span><br><span class="line">dayjs.extend(localizedFormat);</span><br><span class="line">dayjs.locale(<span class="string">&quot;zh-cn&quot;</span>); <span class="comment">// 使用本地化语言</span></span><br></pre></td></tr></table></figure>

<h2 id="开发过程中与-vue3-开发文档相关的一些知识点"><a href="#开发过程中与-vue3-开发文档相关的一些知识点" class="headerlink" title="开发过程中与 vue3 开发文档相关的一些知识点"></a>开发过程中与 vue3 开发文档相关的一些知识点</h2><h3 id="响应式-API"><a href="#响应式-API" class="headerlink" title="响应式 API"></a>响应式 API</h3><ul>
<li><code>reaåctive()</code>: 返回对象的响应式副本</li>
</ul>
<h3 id="SetUp-amp-ref-unRef-amp-toRefs"><a href="#SetUp-amp-ref-unRef-amp-toRefs" class="headerlink" title="SetUp &amp; ref() || unRef() &amp; toRefs()"></a>SetUp &amp; ref() || unRef() &amp; toRefs()</h3><p><strong><em>SetUp(props, context)</em></strong> 逻辑块组合，可组合:<code>生命周期函数/watch/computed</code>，返回<strong>对象</strong>，对象可包含 <code>data/methods/computed</code></p>
<h4 id="生命周期映射关系"><a href="#生命周期映射关系" class="headerlink" title="生命周期映射关系"></a>生命周期映射关系</h4><ul>
<li><del><code>beforeCreate</code></del> -&gt; use <code>setup()</code></li>
<li><del><code>created</code></del> -&gt; use <code>setup()</code></li>
<li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li>
<li><code>mounted</code> -&gt; <code>onMounted</code></li>
<li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li>
<li><code>updated</code> -&gt; <code>onUpdated</code></li>
<li><code>beforeUnmount</code> -&gt; <code>onBeforeUnmount</code></li>
<li><code>unmounted</code> -&gt; <code>onUnmounted</code></li>
<li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li>
<li><code>renderTracked</code> -&gt; <code>onRenderTracked</code></li>
<li><code>renderTriggered</code> -&gt; <code>onRenderTriggered</code></li>
</ul>
<blockquote>
<p>由于 <code>props</code> 是响应式的，所以不能使用<code>ES6解构</code>，因为 <strong><em>解构是浅复制，非引用类型属性拷贝后会跟原 prop 属性脱离，是一个新的变量，没有响应性，引用类型的属性（数组，对象，函数）还会保持引用，这 2 种情况下解构后的变量响应性不统一</em></strong> 所以会消除 prop 的响应性，如果需要解构 prop,使用 <code>toRefs</code></p>
</blockquote>
<blockquote>
<p>若要获取传递给 setup() 的参数的类型推断，请使用 <code>defineComponent</code></p>
</blockquote>
<h4 id="在-Setup-中使用-Router"><a href="#在-Setup-中使用-Router" class="headerlink" title="在 Setup 中使用 Router"></a>在 Setup 中使用 Router</h4><blockquote>
<p>请使用<code>useRouter()</code> || <code>useRoute()</code>, 模板中可以访问 <code>$router</code> 和 <code>$route</code>，所以不需要在 setup 中返回 <code>router</code> 或 <code>route</code></p>
</blockquote>
<ul>
<li><code>userLink &amp; RouterLink</code>: 内部行为已经作为一个组合式 API 函数公开</li>
</ul>
<h3 id="ts-相关"><a href="#ts-相关" class="headerlink" title="ts 相关"></a>ts 相关</h3><ul>
<li><code>setup()</code> 函数中，不需要将类型传递给 props 参数，因为它将从 props 组件选项推断类型</li>
<li><code>refs()</code> 1.初始值推断类型;2.传递一个泛型参数;3. 使用<code>Ref&lt;T&gt;</code>替代<code>ref</code></li>
<li><code>readtive()</code> 使用接口(<code>Interface</code>)</li>
<li><code>computed</code>自动推断</li>
</ul>
<h4 id="与-Options-api-一起使用"><a href="#与-Options-api-一起使用" class="headerlink" title="与 Options api 一起使用"></a>与 Options api 一起使用</h4><ul>
<li>复杂的类型或接口使用 <strong>as</strong> 强制转换</li>
</ul>
<h4 id="注解返回类型"><a href="#注解返回类型" class="headerlink" title="注解返回类型"></a>注解返回类型</h4><ul>
<li>computed 的类型难以推断 需要注解</li>
</ul>
<h4 id="注解-props"><a href="#注解-props" class="headerlink" title="注解 props"></a>注解 props</h4><ul>
<li>使用 PropType 强制转换构造函数</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, PropType &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是接口，也可以是type</span></span><br><span class="line"><span class="keyword">interface</span> Book &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  author: <span class="built_in">string</span>;</span><br><span class="line">  year: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Component = defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    success: &#123; <span class="keyword">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">    callback: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Function</span> <span class="keyword">as</span> PropType&lt;<span class="function">() =&gt;</span> <span class="built_in">void</span>&gt;,</span><br><span class="line">    &#125;,</span><br><span class="line">    book: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;Book&gt;,</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>由于 ts 的设计限制：涉及到为了对函数表达式进行类型推理，你必须注意·对象和数组的<code>validators</code> 和 <code>default</code> 值</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, PropType &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Book &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  year?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Component = defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    bookA: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;Book&gt;,</span><br><span class="line">      <span class="comment">// 请务必使用箭头函数</span></span><br><span class="line">      <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        title: <span class="string">&quot;Arrow Function Expression&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      validator: <span class="function">(<span class="params">book: Book</span>) =&gt;</span> !!book.title,</span><br><span class="line">    &#125;,</span><br><span class="line">    bookB: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;Book&gt;,</span><br><span class="line">      <span class="comment">// 或者提供一个明确的 this 参数</span></span><br><span class="line">      <span class="keyword">default</span>(<span class="built_in">this</span>: <span class="built_in">void</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          title: <span class="string">&quot;Function Expression&quot;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      validator(<span class="built_in">this</span>: <span class="built_in">void</span>, book: Book) &#123;</span><br><span class="line">        <span class="keyword">return</span> !!book.title;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="注解-emit"><a href="#注解-emit" class="headerlink" title="注解 emit"></a>注解 emit</h4><ul>
<li>为触发的事件注解一个有效载荷。另外，所有未声明的触发事件在调用时都会抛出一个类型错误。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Component = defineComponent(&#123;</span><br><span class="line">  emits: &#123;</span><br><span class="line">    addBook(payload: &#123; bookName: <span class="built_in">string</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// perform runtime 验证</span></span><br><span class="line">      <span class="keyword">return</span> payload.bookName.length &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSubmit() &#123;</span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">&quot;addBook&quot;</span>, &#123;</span><br><span class="line">        bookName: <span class="number">123</span>, <span class="comment">// 类型错误！</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">&quot;non-declared-event&quot;</span>); <span class="comment">// 类型错误！</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="类型声明-refs"><a href="#类型声明-refs" class="headerlink" title="类型声明 refs"></a>类型声明 refs</h4><ul>
<li>有时我们可能需要为 ref 的内部值指定复杂类型。我们可以在调用 ref 重写默认推理时简单地传递一个泛型参数</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> year = ref&lt;<span class="built_in">string</span> | <span class="built_in">number</span>&gt;(<span class="string">&quot;2020&quot;</span>); <span class="comment">// year&#x27;s type: Ref&lt;string | number&gt;</span></span><br><span class="line">year.value = <span class="number">2020</span>; <span class="comment">// ok!</span></span><br><span class="line"><span class="comment">// 如果泛型的类型未知，建议将 ref 转换为 Ref&lt;T&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="类型声明-reactive"><a href="#类型声明-reactive" class="headerlink" title="类型声明 reactive"></a>类型声明 reactive</h4><blockquote>
<p>与 <code>ref</code> 的区别： 当变量基础类型时使用<code>ref</code>, 引用类型-对象/数组等使用 <code>reactive</code></p>
</blockquote>
<ul>
<li>当声明类型 reactive property，我们可以使用接口</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Book &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  year?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">&quot;HelloWorld&quot;</span>,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> book = reactive&lt;Book&gt;(&#123; title: <span class="string">&quot;Vue 3 Guide&quot;</span> &#125;);</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="keyword">const</span> book: Book = reactive(&#123; title: <span class="string">&quot;Vue 3 Guide&quot;</span> &#125;);</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="keyword">const</span> book = reactive(&#123; title: <span class="string">&quot;Vue 3 Guide&quot;</span> &#125;) <span class="keyword">as</span> Book;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="开发过程中遇到的问题-TroubleShooting"><a href="#开发过程中遇到的问题-TroubleShooting" class="headerlink" title="开发过程中遇到的问题[TroubleShooting]"></a>开发过程中遇到的问题[TroubleShooting]</h3><h4 id="注意：vite2-自动构建-typescript-模板项目文件，部分同学会在-build-阶段报错，详情请移步"><a href="#注意：vite2-自动构建-typescript-模板项目文件，部分同学会在-build-阶段报错，详情请移步" class="headerlink" title="注意：vite2 自动构建 typescript 模板项目文件，部分同学会在 build 阶段报错，详情请移步"></a>注意：vite2 自动构建 typescript 模板项目文件，部分同学会在 build 阶段报错，详情请移步</h4><ul>
<li><a href="https://github.com/znck/vue-developer-experience/issues/208">error VueDX/TS: context.imports.add is not a function</a></li>
<li><a href="https://github.com/znck/vue-developer-experience/issues/144">@vuedx/typecheck vite build error with <code>const FSP = require(&#39;fs/promises&#39;);</code></a></li>
</ul>
<blockquote>
<p>windows 系统的同学可将 build 打包命令由<code>vuedx-typecheck . &amp;&amp; vite build</code> 改为 <code>vite build &amp;&amp; tsc</code>,ci 脚本内加一条：<code>run: npx --no-install vuedx-typecheck</code></p>
</blockquote>
<h4 id="在ts文件内使用-const-xxx-require-39-xxx-39-报错：require-is-not-defined"><a href="#在ts文件内使用-const-xxx-require-39-xxx-39-报错：require-is-not-defined" class="headerlink" title="在ts文件内使用 const xxx = require(&#39;xxx&#39;)报错：require is not defined"></a>在<code>ts</code>文件内使用 <code>const xxx = require(&#39;xxx&#39;)</code>报错：<code>require is not defined</code></h4><blockquote>
<p>已解决: <code>vite@2.4.1</code>已修复该错误，升级即可</p>
</blockquote>
<ul>
<li><a href="https://github.com/vitejs/vite/issues/2161">Error: require is mot defined</a></li>
</ul>
<h4 id="UI-组件的问题"><a href="#UI-组件的问题" class="headerlink" title="UI 组件的问题"></a>UI 组件的问题</h4><ul>
<li><p>ant-design-vue 按需加载问题:<br>查看<a href="https://github.com/vueComponent/ant-design-vue/issues/3570">Imports using @ant-design/icons-vue should be importing the ESM version</a></p>
</li>
<li><p>and-design-vue 版本问题！！！现发现 <code>form &amp; input</code>组件在引入 es 包时一直报错<code>The requesed module &#39;/node_modules/is-mobile/index.js&#39; is dose not provide an export named &#39;isMobile&#39;</code>，遂升级至 2.1.1 版本，同时删除 vite.config 里 optimizeDeps 的 exclude 的配置,才能使用:<br>详见<a href="https://github.com/vueComponent/ant-design-vue/issues/1936">组件库依赖的 ismobilejs 存在兼容性问题</a></p>
</li>
<li><p>Element-plus 包问题:<br>查看<a href="https://github.com/element-plus/element-plus/issues/1632">element plus issues: [Bug Report] error: [ vite:dep-scan ] Failed to resolve entry for package “element-plus”. The package may have incorrect main/module/exports specified in its package.json</a></p>
</li>
</ul>
<h3 id="依赖强缓存"><a href="#依赖强缓存" class="headerlink" title="依赖强缓存"></a>依赖强缓存</h3><ul>
<li>通过浏览器 devtools 的 Network 选项卡暂时禁用缓存；</li>
<li>重启 Vite dev server，使用 –force 标志重新打包依赖；</li>
<li>重新载入页面。</li>
</ul>
<h2 id="esbuild-预构建"><a href="#esbuild-预构建" class="headerlink" title="esbuild 预构建"></a>esbuild 预构建</h2><h2 id="相关文档链接"><a href="#相关文档链接" class="headerlink" title="相关文档链接"></a>相关文档链接</h2><ul>
<li><a href="https://github.com/typescript-eslint/typescript-eslint/blob/master/docs/getting-started/linting/README.md">tslint 配置</a></li>
<li><a target="_blank" rel="noopener" href="https://esbuild.github.io/getting-started/#bundling-for-the-browser">esbuild</a></li>
<li><a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/">vite</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">主体-客体联合创作</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">主体-客体联合创作</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
