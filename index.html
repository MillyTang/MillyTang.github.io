<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"github.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Comfortably Numb">
<meta property="og:url" content="https://github.com/MillyTang/MillyTang.github.io/index.html">
<meta property="og:site_name" content="Comfortably Numb">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="主体-客体联合创作">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://github.com/MillyTang/MillyTang.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Comfortably Numb</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Comfortably Numb</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">反方向的钟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/07/19/ui/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/19/ui/" class="post-title-link" itemprop="url">vue3 composables 组件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-07-19 14:36:15" itemprop="dateCreated datePublished" datetime="2021-07-19T14:36:15+08:00">2021-07-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-07 13:21:35" itemprop="dateModified" datetime="2021-09-07T13:21:35+08:00">2021-09-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>施工🚧中，敬请期待</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/06/26/ts-type-challenges/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/26/ts-type-challenges/" class="post-title-link" itemprop="url">TypeScript 类型体操</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-26 16:48:14" itemprop="dateCreated datePublished" datetime="2021-06-26T16:48:14+08:00">2021-06-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-01 12:54:40" itemprop="dateModified" datetime="2021-09-01T12:54:40+08:00">2021-09-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>挑战类型体操答案合集，一部分是自己做的，一部分是自己抄的</p>
</blockquote>
<h2 id="热身运动"><a href="#热身运动" class="headerlink" title="热身运动"></a>热身运动</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 期望是一个 string 类型</span></span><br><span class="line"><span class="comment">// any -&gt; string</span></span><br><span class="line"><span class="keyword">type</span> HelloWorld = <span class="built_in">string</span></span><br><span class="line"><span class="comment">// 你需要使得如下这行不会抛出异常</span></span><br><span class="line"><span class="keyword">type</span> test = Expect&lt;Equal&lt;HelloWorld, <span class="built_in">string</span>&gt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="实现Pick"><a href="#实现Pick" class="headerlink" title="实现Pick"></a>实现Pick</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  description: <span class="built_in">string</span></span><br><span class="line">  completed: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyPick&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P] </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = MyPick&lt;Todo, <span class="string">&#x27;title&#x27;</span> | <span class="string">&#x27;completed&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: TodoPreview = &#123;</span><br><span class="line">    title: <span class="string">&#x27;Clean room&#x27;</span>,</span><br><span class="line">    completed: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a>Readonly</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  description: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyReadonly&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: MyReadonly&lt;Todo&gt; = &#123;</span><br><span class="line">  title: <span class="string">&quot;Hey&quot;</span>,</span><br><span class="line">  description: <span class="string">&quot;foobar&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">todo.title = <span class="string">&quot;Hello&quot;</span> <span class="comment">// Error: cannot reassign a readonly property</span></span><br><span class="line">todo.description = <span class="string">&quot;barFoo&quot;</span> <span class="comment">// Error: cannot reassign a readonly property</span></span><br></pre></td></tr></table></figure>

<h2 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Todo &#123;</span><br><span class="line">  title: <span class="built_in">string</span></span><br><span class="line">  description: <span class="built_in">string</span></span><br><span class="line">  completed: <span class="built_in">boolean</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MyOmit&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T <span class="keyword">as</span> P <span class="keyword">extends</span> K ? <span class="built_in">never</span>: P]: T[P]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TodoPreview = MyOmit&lt;Todo, <span class="string">&#x27;description&#x27;</span> | <span class="string">&#x27;title&#x27;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todo: TodoPreview = &#123;</span><br><span class="line">  completed: <span class="literal">false</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Exclude"><a href="#Exclude" class="headerlink" title="Exclude"></a>Exclude</h2><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从T中排除可分配给U的类型</span></span><br><span class="line"><span class="comment">// T, U 都是类型</span></span><br><span class="line"><span class="comment">// MyExclude&lt;&#x27;a&#x27; | &#x27;b&#x27; | &#x27;c&#x27;, &#x27;a&#x27;&gt; // 输出 &#x27;b&#x27; | &#x27;c&#x27;</span></span><br><span class="line"><span class="keyword">type</span> MyExclude&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T</span><br></pre></td></tr></table></figure>

<!-- ## PromiseAll

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> PromiseAll&lt;&gt;</span><br><span class="line"><span class="keyword">const</span> promise1 = <span class="built_in">Promise</span>.resolve(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">const</span> promise2 = <span class="number">42</span>;</span><br><span class="line"><span class="keyword">const</span> promise3 = <span class="keyword">new</span> <span class="built_in">Promise</span>&lt;<span class="built_in">string</span>&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(resolve, <span class="number">100</span>, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// expected to be `Promise&lt;[number, number, string]&gt;`</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.all([promise1, promise2, promise3] <span class="keyword">as</span> <span class="keyword">const</span>) --&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/04/15/using-es6-in-node-when-write-plugin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/15/using-es6-in-node-when-write-plugin/" class="post-title-link" itemprop="url">开发vite相关插件的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-15 15:50:22" itemprop="dateCreated datePublished" datetime="2021-04-15T15:50:22+08:00">2021-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-27 10:46:29" itemprop="dateModified" datetime="2021-04-27T10:46:29+08:00">2021-04-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>温馨提示： 先别替换 ant-design-vue 中的 moment 为 dayjs, 有bug, date-picker会坏掉，等作者修好再换</p>
</blockquote>
<p>本项目的技术栈是：<code>vite vue3 ant-desing-vue</code>。<br>项目中需要用到的<code>ant-desing-vue</code>UI 组件依赖<code>moment</code>,我看官网提示有插件可以改成<code>dayjs</code>,可以使整个包小一点，看了<code>antd-dayjs-webpack-plugin</code>的代码后发现没有针对<code>vite ant-desing-vue</code>的,就跃跃欲试想写一个<code>vite-plugin-vue-ant-desing-vue-dayjs</code>插件，专门用在<code>vite vue3 ant-desing-vue</code>项目中。后面其实发现没必要，当然，写完才发现-_-||</p>
<h2 id="主要问题"><a href="#主要问题" class="headerlink" title="主要问题"></a>主要问题</h2><h3 id="叠了-3-个-debuff-导致运行时出问题"><a href="#叠了-3-个-debuff-导致运行时出问题" class="headerlink" title="叠了 3 个 debuff 导致运行时出问题"></a>叠了 3 个 debuff 导致运行时出问题</h3><ol>
<li>由于我 fork 了一部分<code>antd-dayjs-webpack-plugin</code>代码，内部是<code>module.exports</code></li>
<li>同时入口文件里是直接<code>export default vitePluginVueAntDVueDayjs(Options=&#123;&#125;) &#123;...&#125;</code></li>
<li>而且是直接<code>yarn add git+ssh://git@github.com:xxx/some-project.git --dev</code>，这个<code>some-project</code>就是写的插件，<code>package.json</code>里暴露的直接是<code>main: src/index.js</code>,</li>
</ol>
<p>第一次写插件，心情十分激动结果刚运行就报错,搜了一下原来是 node 环境里不能直接加载<code>ES6</code>模块。。。于是我重新看了一次 es6 文档<code>node 环境如何加载es6模块</code>，然后查了一下<code>@vite/plugin-vue</code>的解决办法</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><ol>
<li>完全采用 cjs 模块方式编写，一水儿的<code>module.export</code> -&gt; 针对入口文件非打包后的插件。如<code>package.json中的main: src/index.js</code></li>
<li>将 es6 模块打包编译成 node 模块（@vite/plugin-vue）就是这么做的：<code>esbuild src/index.ts --bundle --platform=node --target=node12 --external:@vue/compiler-sfc --outfile=dist/index.js</code> -&gt; 完全使用 es6 模块编写插件，然后使用打包后的 cjs 模块, <code>package.json中的main: dist/index.js</code></li>
</ol>
<h2 id="没必要写是因为直接配置即可"><a href="#没必要写是因为直接配置即可" class="headerlink" title="没必要写是因为直接配置即可"></a>没必要写是因为直接配置即可</h2><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行</span></span><br><span class="line"><span class="comment"># npm i dayjs</span></span><br><span class="line">yarn add dayjs</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js文件</span></span><br><span class="line">&#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      moment: <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line"><span class="keyword">import</span> isSameOrBefore <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/isSameOrBefore&#x27;</span></span><br><span class="line"><span class="keyword">import</span> isSameOrAfter <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/isSameOrAfter&#x27;</span></span><br><span class="line"><span class="keyword">import</span> advancedFormat <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/advancedFormat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> customParseFormat <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/customParseFormat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> weekday <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/weekday&#x27;</span></span><br><span class="line"><span class="keyword">import</span> weekOfYear <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/weekOfYear&#x27;</span></span><br><span class="line"><span class="keyword">import</span> isMoment <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/isMoment&#x27;</span></span><br><span class="line"><span class="keyword">import</span> localeData <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/localeData&#x27;</span></span><br><span class="line"><span class="keyword">import</span> localizedFormat <span class="keyword">from</span> <span class="string">&#x27;dayjs/plugin/localizedFormat&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dayjs/locale/zh-cn&#x27;</span> <span class="comment">// 导入本地化语言</span></span><br><span class="line"></span><br><span class="line">dayjs.extend(isSameOrBefore)</span><br><span class="line">dayjs.extend(isSameOrAfter)</span><br><span class="line">dayjs.extend(advancedFormat)</span><br><span class="line">dayjs.extend(customParseFormat)</span><br><span class="line">dayjs.extend(weekday)</span><br><span class="line">dayjs.extend(weekOfYear)</span><br><span class="line">dayjs.extend(isMoment)</span><br><span class="line">dayjs.extend(localeData)</span><br><span class="line">dayjs.extend(localizedFormat)</span><br><span class="line">dayjs.locale(<span class="string">&#x27;zh-cn&#x27;</span>) <span class="comment">// 使用本地化语言</span></span><br></pre></td></tr></table></figure></code></pre>
<h2 id="插件步骤"><a href="#插件步骤" class="headerlink" title="插件步骤"></a>插件步骤</h2><p>如果要写也不是不行：看上面的配置步骤即可知道思路，可参考项目<a href="https://github.com/MillyTang/vite-plugin-for-antd-dayjs">vite-plugin-vue-antd-dayjs</a></p>
<h3 id="第一种：-使用非打包插件"><a href="#第一种：-使用非打包插件" class="headerlink" title="第一种： 使用非打包插件"></a>第一种： 使用非打包插件</h3><blockquote>
<p>有个直接的好处，安装后可以直接修改包文件来测试代码逻辑是否正确，即改即用,我当时采用的就是这种写法</p>
</blockquote>
<h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目结构</span></span><br><span class="line">|-- src</span><br><span class="line">|----|--index.js</span><br><span class="line">|-- package.json</span><br><span class="line">|-- README.md</span><br></pre></td></tr></table></figure>

<h4 id="2-package-json-配置"><a href="#2-package-json-配置" class="headerlink" title="2. package.json 配置"></a>2. package.json 配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// packgae.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;vite-plugin-xxx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Description of the vite-plugin-xxx&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span>: [<span class="string">&quot;vite-plugin&quot;</span>, <span class="string">&quot;vite-plugin-vue&quot;</span>, <span class="string">&quot;rollup-plugin&quot;</span>, <span class="string">&quot;xxx&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;engines&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;node&quot;</span>: <span class="string">&quot;&gt;=12.0.0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;bugs&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;your Name&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-入口文件"><a href="#3-入口文件" class="headerlink" title="3. 入口文件"></a>3. 入口文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">VitePluginVueXXX</span>(<span class="params">Options = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> virtualFile = <span class="string">&quot;@virtual-file&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    name: <span class="string">&quot;vite-plugin-vue-xxx&quot;</span>,</span><br><span class="line">    enforce: <span class="string">&quot;pre&quot;</span>, <span class="comment">// 加载vite内置插件之前加载</span></span><br><span class="line">    config: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">      <span class="string">&quot;resolve.alias&quot;</span>: &#123;</span><br><span class="line">        moment: <span class="string">&quot;dayjs&quot;</span>, <span class="comment">// set dayjs alias</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;), <span class="comment">// 在被解析之前修改 Vite 配置</span></span><br><span class="line">    configResolved(resolvedConfig) &#123;</span><br><span class="line">      <span class="comment">// 存储最终解析的配置</span></span><br><span class="line">      config = resolvedConfig;</span><br><span class="line">    &#125;, <span class="comment">// 在解析 Vite 配置后调用</span></span><br><span class="line">    resolveId(id) &#123;</span><br><span class="line">      <span class="comment">// 每个传入的模块请求时被调用</span></span><br><span class="line">      <span class="keyword">if</span> (id === virtualFile) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;resolveid id test&quot;</span>, id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    load(id) &#123;</span><br><span class="line">      <span class="comment">// 每个传入的模块请求时被调用</span></span><br><span class="line">      <span class="keyword">if</span> (id === virtualFile) &#123;</span><br><span class="line">        <span class="comment">// 在这里return上面main.js引入的插件和依赖</span></span><br><span class="line">        <span class="comment">// 如果需要知道哪些插件必须引入，直接查看dayjs官网的插件合集</span></span><br><span class="line">        <span class="comment">// return 出去的是 `@virtual-file`的文件内容，这里写成 `const xxx = require(&#x27;xxx&#x27;)` or `import xxx from &#x27;xxxx&#x27;`都是可以的，注意在`main.js`内的引用形式即可</span></span><br><span class="line">        <span class="comment">// 例如：isMoment plugin</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`const isMoment =  require(&#x27;dayjs/plugin/isMoment&#x27;); dayjs.extend(isMoment);module.exports = &#123;isMoment&#125;`</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="4-安装-没有发布的包文件"><a href="#4-安装-没有发布的包文件" class="headerlink" title="4. 安装 没有发布的包文件"></a>4. 安装 没有发布的包文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 插件的 peerDependencies</span></span><br><span class="line">yarn add dayjs</span><br><span class="line"><span class="comment"># 安没有发布的装插件包</span></span><br><span class="line">yarn add git+ssh://git@github.com:xxx.git --dev</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 vite.config内配置</span></span><br><span class="line"><span class="comment">// 引入插件</span></span><br><span class="line">  <span class="keyword">const</span> vitePluginVueForAntdDayjs = <span class="built_in">require</span>(<span class="string">&#x27;vite-plugin-vue-antd-dayjs&#x27;</span>)</span><br><span class="line"> &#123;</span><br><span class="line">    plugins:  [vue(),vitePluginVueForAntdDayjs()],</span><br><span class="line">    resolve: &#123;</span><br><span class="line">      alias: &#123;</span><br><span class="line">        moment: <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-在-main-js-里引入虚拟文件即可"><a href="#5-在-main-js-里引入虚拟文件即可" class="headerlink" title="5. 在 main.js 里引入虚拟文件即可"></a>5. 在 main.js 里引入虚拟文件即可</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以 isMoment 为例</span></span><br><span class="line"><span class="comment">// 在 mjs 内 引入 cjs 模块</span></span><br><span class="line"><span class="keyword">import</span> isMoment <span class="keyword">from</span> <span class="string">&quot;@virtual-file&quot;</span>;</span><br><span class="line"><span class="comment">// 如果模块很多，一次引入很多模块, 直接引入文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;@virtual-file&quot;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动项目： <code>yarn dev</code>, vite 打包会发现有提示：<code>[vite] new dependencies found: dayjs/plugin/isSameOrAfter, dayjs/plugin/advancedFormat, dayjs/plugin/customParseFormat, dayjs/plugin/weekday, dayjs/plugin/weekYear, dayjs/plugin/weekOfYear, dayjs/plugin/isMoment, dayjs/plugin/localeData, dayjs/plugin/localizedFormat, dayjs/locale/zh-cn, updating...</code> 说明已经成功引入</p>
</blockquote>
<h4 id="6-打包比较前后包的差异"><a href="#6-打包比较前后包的差异" class="headerlink" title="6. 打包比较前后包的差异"></a>6. 打包比较前后包的差异</h4><h3 id="第二种：使用打包后的插件"><a href="#第二种：使用打包后的插件" class="headerlink" title="第二种：使用打包后的插件"></a>第二种：使用打包后的插件</h3><blockquote>
<p>步骤跟上面的差不多，只是写的时候使用 es6 模块,多一步打包&amp;入口文件有点不同，可参考项目<a href="https://github.com/MillyTang/vite-plugin-antd-vue-ts">vite-plugin-antd-vue-ts</a></p>
</blockquote>
<ol>
<li><p>packgae.json 的配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;dist/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;types&quot;</span>: <span class="string">&quot;dist/index.d.ts&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;build:boundle&quot;</span>: <span class="string">&quot;`esbuild src/index.ts --bundle --platform=node --target=node12 --external:dayjs --outfile=dist/index.js&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;esbuild&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;peerDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;dayjs&quot;</span>: <span class="string">&quot;*&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>入口文件</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">VitePluginVueXXX</span>(<span class="params">Options = &#123;&#125;</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>执行打包命令</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build:boudle</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置 <code>vite.config.js</code> &amp; 在<code>main.js</code>引入文件步骤同上</li>
</ol>
<blockquote>
<p>如果要实现在入口文件的引用方式为 <code>import someplugin from &#39;path/to/all-plugin-file-name&#39;</code>,在插件内使用 <code>export default</code> 和 <code>module.exports</code>是一样的效果</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/02/18/vite2-vue3-ts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/18/vite2-vue3-ts/" class="post-title-link" itemprop="url">构建 vite2 & Vue3 & ts项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-18 17:27:53" itemprop="dateCreated datePublished" datetime="2021-02-18T17:27:53+08:00">2021-02-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-02 17:02:56" itemprop="dateModified" datetime="2021-09-02T17:02:56+08:00">2021-09-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="步骤总览"><a href="#步骤总览" class="headerlink" title="步骤总览"></a>步骤总览</h2><h3 id="开发前配置"><a href="#开发前配置" class="headerlink" title="开发前配置"></a>开发前配置</h3><ol>
<li>命令行使用 vite 生成项目模板</li>
<li>配置 TypeScript:<ol>
<li>tsconfig 配置</li>
<li>安装 ts 类型检查</li>
</ol>
</li>
<li>集中处理请求【Axios 库】</li>
<li>分支管理保护与自动化的2种方式，1个必要</li>
</ol>
<h3 id="开始开发"><a href="#开始开发" class="headerlink" title="开始开发"></a>开始开发</h3><ol>
<li>配置环境文件</li>
<li>配置别名【可选】</li>
<li>配置路由</li>
<li>选择&amp;调研组件库</li>
<li>配置主题文件</li>
<li>安装 CSS 预处理器</li>
<li>开发过程中与 vue3 开发文档相关的一些知识点</li>
<li>开发过程中常见的问题</li>
<li><a href="https://github.com/MillyTang/ts-in-vue3-project">在项目中写出可维护可拓展的类型</a></li>
</ol>
<blockquote>
<p>结尾提供了其他相关链接</p>
</blockquote>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><blockquote>
<p>使用 nvm 切换不同版本的 node 来适用不同项目</p>
</blockquote>
<h3 id="命令行使用-vite-生成项目模板"><a href="#命令行使用-vite-生成项目模板" class="headerlink" title="命令行使用 vite 生成项目模板"></a>命令行使用 vite 生成项目模板</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line"><span class="comment"># v8.9.4</span></span><br><span class="line">nvm use 12</span><br><span class="line"><span class="comment"># Now using node v12.19.0 (npm v6.14.8)</span></span><br><span class="line">yarn create @vitejs/app</span><br><span class="line"><span class="comment"># 选择 vue-ts 预设模板</span></span><br><span class="line"><span class="built_in">cd</span> my-vue3-vite2-app</span><br><span class="line">yarn</span><br><span class="line">yarn dev</span><br></pre></td></tr></table></figure>

<h3 id="配置-TypeScript"><a href="#配置-TypeScript" class="headerlink" title="配置 TypeScript"></a>配置 TypeScript</h3><h4 id="tsconfig-json-文件-增加-2-项配置"><a href="#tsconfig-json-文件-增加-2-项配置" class="headerlink" title="tsconfig.json 文件 增加 2 项配置"></a>tsconfig.json 文件 增加 2 项配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;vite/client&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="安装-ts-类型检查"><a href="#安装-ts-类型检查" class="headerlink" title="安装 ts 类型检查"></a>安装 ts 类型检查</h4><blockquote>
<p>打开 vite.config.ts 文件时 控制台就会报 failed to load the eslint library for the vite.config.ts 错误，这是因为本地 eslint 无法解析 ts 文件，需要安装 ts 依赖 &amp; vite 不提供 ts 类型检查</p>
</blockquote>
<ul>
<li>详见<a href="https://github.com/typescript-eslint/typescript-eslint/blob/master/docs/getting-started/linting/README.md">typescript-eslint 配置</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装ts eslint 依赖</span></span><br><span class="line"><span class="comment"># node version &gt;= 12</span></span><br><span class="line"><span class="comment"># 注意：以下包不提供对 *.vue 文件的检查</span></span><br><span class="line">yarn add -D eslint typescript @typescript-eslint/parser @typescript-eslint/eslint-plugin</span><br><span class="line"><span class="comment"># 如需在开发过程中对 *.vue 文件进行类型检查，请增加以下包支持</span></span><br><span class="line"><span class="comment"># yarn add -D eslint-plugin-vue</span></span><br><span class="line"><span class="comment"># 安装node变量的类型声明</span></span><br><span class="line">npm i --save-dev @types/node</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下载额外的<code>npm</code>包需要添加其他类型定义：1.安装<code>npm i --save-dev @types/xxx</code>；2.在<code>tsconfig.json</code>中添加``types`的配置『 <strong><em>由于 vite2 创建的 ts 项目中已添加默认的 types 定义，标明只使用该类型定义，所以如果需要其他类型（不在@vite/client 中），需要增加配置</em></strong> 』</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json</span></span><br><span class="line"><span class="comment">// 在 node 后面增加一项xxx即可</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;types&quot;</span>: [<span class="string">&quot;vite/client&quot;</span>, <span class="string">&quot;node&quot;</span>, <span class="string">&quot;xxx&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本项目使用 eslint:recommended 规范，如需修改请参照 tslint 官方提示</p>
</blockquote>
<ol>
<li><p>工作目录下新增 <code>.eslintrc.js</code> 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不含  eslint-plugin-vue 插件的配置</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parser: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">  plugins: [<span class="string">&quot;@typescript-eslint&quot;</span>],</span><br><span class="line">  <span class="keyword">extends</span>: [<span class="string">&quot;eslint:recommended&quot;</span>, <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 包含  eslint-plugin-vue 插件的配置</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parser: <span class="string">&quot;vue-eslint-parser&quot;</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">&quot;@typescript-eslint/parser&quot;</span>,</span><br><span class="line">    ecmaVersion: <span class="number">2020</span>,</span><br><span class="line">    sourceType: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">    ecmaFeatures: &#123;</span><br><span class="line">      jsx: <span class="literal">true</span>,</span><br><span class="line">      tsx: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [<span class="string">&quot;@typescript-eslint&quot;</span>],</span><br><span class="line">  <span class="keyword">extends</span>: [</span><br><span class="line">    <span class="string">&quot;plugin:vue/vue3-recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eslint:recommended&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plugin:@typescript-eslint/recommended&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>工作目录下新增 <code>.eslintignore</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># don&#39;t ever lint node_modules</span><br><span class="line">node_modules</span><br><span class="line"># don&#39;t lint build output (make sure it&#39;s set to your correct build folder name)</span><br><span class="line">dist</span><br><span class="line"># don&#39;t lint nyc coverage output</span><br><span class="line">coverage</span><br><span class="line"># don&#39;t lint .vscode</span><br><span class="line">.vscode</span><br><span class="line"># don&#39;t lint .eslintrc.js</span><br><span class="line">.eslintrc.js</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="配置请求-Axios-集中处理请求"><a href="#配置请求-Axios-集中处理请求" class="headerlink" title="配置请求 Axios 集中处理请求"></a>配置请求 Axios 集中处理请求</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server/index.ts 文件</span></span><br><span class="line"><span class="keyword">import</span> axios, &#123; AxiosRequestConfig, Method &#125; <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">&quot;qs&quot;</span>;</span><br><span class="line"><span class="comment">// 请求常量配置</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="keyword">import</span>.meta.env.VITE_APP_BASE_URL <span class="keyword">as</span> <span class="built_in">string</span>;</span><br><span class="line"><span class="keyword">const</span> SEUCCESS_CODE = [<span class="string">&quot;200&quot;</span>]; <span class="comment">// 多个code可兼容历史api的成功返回值</span></span><br><span class="line"><span class="keyword">const</span> SPECIAL_CODE_403 = []; <span class="comment">// 添加业务要求的 无权限的code码</span></span><br><span class="line"><span class="keyword">const</span> LOGOUT_CODE = []; <span class="comment">// 添加业务要求登出的code码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> resType = <span class="string">&quot;json&quot;</span> | <span class="string">&quot;blob&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> instance = axios.create(&#123;</span><br><span class="line">  baseURL: BASE_URL,</span><br><span class="line">  timeout: <span class="number">30000</span>,</span><br><span class="line">  withCredentials: <span class="literal">true</span>, <span class="comment">// 表示跨域请求时是否需要使用凭证</span></span><br><span class="line">  validateStatus: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt;= <span class="number">304</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  paramsSerializer: <span class="function"><span class="keyword">function</span> (<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> qs.stringify(params);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 创建一个基本函数，后续的 post &amp; get方法都基于baseFunc</span></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">instance.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 如需自定义config,可在调用api时传入，在此处修改、增加、覆盖</span></span><br><span class="line">    <span class="keyword">const</span> options = &#123;</span><br><span class="line">      ...config,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        ...config.headers,</span><br><span class="line">        <span class="comment">// &#x27;X-TOKEN&#x27;: config.headers[&#x27;X-TOKEN&#x27;] || &#x27;default value or test token for testing&#x27; // 请求头自定义token, 重置 responseType || Content-Type</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> options;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加响应拦截器</span></span><br><span class="line">instance.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; status, data &#125;: &#123; status: <span class="built_in">number</span>; data: <span class="built_in">any</span> &#125; = response;</span><br><span class="line">    <span class="comment">// 特殊处理返回类型是 blob 类型的请求</span></span><br><span class="line">    <span class="keyword">if</span> (status === <span class="number">200</span> &amp;&amp; response.config.responseType === <span class="string">&quot;blob&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; code &#125; = data;</span><br><span class="line">    <span class="keyword">if</span> (SEUCCESS_CODE.includes(code + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 符合请求成功标准</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data.data || &#123;&#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (SPECIAL_CODE_403.includes(code + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 403需要重新授权</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(data);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LOGOUT_CODE.includes(code + <span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 意外登出，重新登录</span></span><br><span class="line">      <span class="comment">// reLogin</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data);</span><br><span class="line">      <span class="comment">// return Promise.resolve(data)</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 统一弹窗提示错误</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(data);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 集中处理超时错误</span></span><br><span class="line">    <span class="comment">// 或者 统一向上抛出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 基本配置</span></span><br><span class="line"><span class="comment">// 这里有2种方式可以返回 使用api时配置的返回类型</span></span><br><span class="line"><span class="comment">// 1. 直接在根目录下添加 Axios 的类型声明，改写返回类型</span></span><br><span class="line"><span class="comment">// 2. 引入Axios是点击查看 Axios 定义的类型，在使用 `instance.request` 时改成返回传入泛型即可</span></span><br><span class="line"><span class="comment">// 这里我们使用第二种方式</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">request</span>&lt;<span class="title">T</span>&gt;(<span class="params">method: Method, url: <span class="built_in">string</span>, config: AxiosRequestConfig</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>&lt;T&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    instance</span><br><span class="line">      .request&lt;T, T&gt;(&#123;</span><br><span class="line">        method: method,</span><br><span class="line">        url: url,</span><br><span class="line">        ...config,</span><br><span class="line">      &#125;)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve(res);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 后续根据具体参数类型返回</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">put</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;PUT&quot;</span>, url, &#123; data &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span>, responseType?: resType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;POST&quot;</span>, url, &#123; data, responseType &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">del</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, data?: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;DELETE&quot;</span>, url, &#123; data &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>&lt;<span class="title">T</span>&gt;(<span class="params">url: <span class="built_in">string</span>, params?: <span class="built_in">any</span>, responseType?: resType</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;T&gt;(<span class="string">&quot;GET&quot;</span>, url, &#123; params, responseType &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> instance;</span><br></pre></td></tr></table></figure>

<h4 id="使用定义好的-post-get等方法"><a href="#使用定义好的-post-get等方法" class="headerlink" title="使用定义好的 post, get等方法"></a>使用定义好的 <code>post, get</code>等方法</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const-api-path.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> POST_SOME_LIST = <span class="string">&quot;/path/to/some/list&quot;</span>;</span><br><span class="line"><span class="comment">// api.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; post, get &#125; <span class="keyword">from</span> <span class="string">&quot;./index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; POST_SOME_LIST &#125; <span class="keyword">from</span> <span class="string">&quot;./const-api-path&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ListReturnType, ListParamType &#125; <span class="keyword">from</span> <span class="string">&quot;./api-types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getSomeList = <span class="function">(<span class="params">data: ListParamType</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> post&lt;ListReturnType&gt;(POST_SOME_LIST, data);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h3 id="分支管理保护与自动化"><a href="#分支管理保护与自动化" class="headerlink" title="分支管理保护与自动化"></a>分支管理保护与自动化</h3><blockquote>
<p>测试环境的发布分支只有 2 个： dev, hotfix</p>
</blockquote>
<h4 id="分支管理、保护的2种方式，1个必要"><a href="#分支管理、保护的2种方式，1个必要" class="headerlink" title="分支管理、保护的2种方式，1个必要"></a>分支管理、保护的2种方式，1个必要</h4><blockquote>
<p>基础仓库影响范围较大，分别对应多个项目的不同阶段，则需要对该项目进行分支管理和保护，通常只保护3个主要分支： main, dev,hotfix</p>
</blockquote>
<h5 id="第一种方式"><a href="#第一种方式" class="headerlink" title="第一种方式"></a>第一种方式</h5><blockquote>
<p>一个新需求的全部工作流程</p>
</blockquote>
<ol>
<li>新建功能分支，以 <code>feature-</code> 开头</li>
<li>功能开发结束给 <code>dev</code> 提 <code>merge request</code></li>
<li>代码审核结束成功合并到 <code>dev</code>后，开始测试</li>
<li>通过测试后提交 <code>merge request</code> 到 <code>main</code>分支准备发布</li>
<li>发布成功且线上验收成功后，在最新提交上打 <code>tag</code>, 并推送 tags</li>
<li>保留该功能分支 2 周删除该分支对应的远程分支，以防后续开发功能分支越来越多</li>
</ol>
<blockquote>
<p>一个紧急修复的全部流程</p>
</blockquote>
<ol>
<li><code>git checkout hotfix</code></li>
<li><code>git pull</code></li>
<li>开始修复，修复结束后提交代码发布到测试环境测试</li>
<li>通过测试后提交 mr 到 <code>main</code>分支准备发布</li>
<li>发布成功且线上验收成功后，在最新提交上打 <code>tag</code>, 并推送 tags</li>
</ol>
<h5 id="第二种方式"><a href="#第二种方式" class="headerlink" title="第二种方式"></a>第二种方式</h5><blockquote>
<p>一个主仓库分别由各个开发fork到自己的group, 主仓库只保留3个分支：main(稳定版本-线上环境), hotfix(紧急修复-发布测试环境), dev(开发时-发布测试环境), fork仓库完全由开发者自行管理</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fork后的项目新增一个 remote</span></span><br><span class="line">git remote add source-hub-name source-hub-ssh-path-or-https-path</span><br><span class="line"><span class="comment"># 拉取 主仓库所有分支</span></span><br><span class="line">git fetch source-hub-name</span><br><span class="line"><span class="comment"># 建立开发进度对应分支</span></span><br><span class="line">git checkout -b dev-source-hub-name</span><br><span class="line"><span class="comment"># 拉取 主仓库 dev 分支所有commit</span></span><br><span class="line">git pull source-hub-name dev</span><br><span class="line"><span class="comment"># 回到dev分支，合并主仓库进度</span></span><br><span class="line">git checkout dev</span><br><span class="line"><span class="comment"># 或者仅pick部分提交</span></span><br><span class="line">git merge dev-source-hub-name</span><br></pre></td></tr></table></figure>

<h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><h3 id="配置环境文件"><a href="#配置环境文件" class="headerlink" title="配置环境文件"></a>配置环境文件</h3><ul>
<li>构建包文件会通过环境文件来确定环境变量，在项目下新增:<ul>
<li><code>.env.production</code>文件</li>
<li><code>.env.development</code>文件</li>
<li><code>.env.stagging</code>文件</li>
</ul>
</li>
</ul>
<h3 id="配置别名【可选】"><a href="#配置别名【可选】" class="headerlink" title="配置别名【可选】"></a>配置别名【可选】</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [vue()],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.resolve(__dirname, <span class="string">&quot;./src&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="配置路由"><a href="#配置路由" class="headerlink" title="配置路由"></a>配置路由</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add vue-router@4</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HelloWorld <span class="keyword">from</span> <span class="string">&quot;@/components/hello-world.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory, RouteRecordRaw &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由懒加载</span></span><br><span class="line"><span class="keyword">const</span> About = <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;../components/about.vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> routes: RouteRecordRaw[] = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    component: HelloWorld, <span class="comment">// 非懒加载</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">    component: About,</span><br><span class="line">    <span class="comment">// meta类型需要额外声明，此声明在 src/typings/augmenation.d.ts内</span></span><br><span class="line">    meta: &#123;</span><br><span class="line">      isAdmin: <span class="literal">false</span>,</span><br><span class="line">      title: <span class="string">&quot;关于&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<h4 id="添加额外的-meta-字段的类型声明"><a href="#添加额外的-meta-字段的类型声明" class="headerlink" title="添加额外的 meta 字段的类型声明"></a>添加额外的 meta 字段的类型声明</h4><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// augmenation.d.ts</span></span><br><span class="line"><span class="comment">// Ensure this file is parsed as a module regardless of dependencies.</span></span><br><span class="line"><span class="keyword">export</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> &quot;vue-router&quot; &#123;</span><br><span class="line">  <span class="comment">// 自定义元字段声明</span></span><br><span class="line">  <span class="keyword">interface</span> RouteMeta &#123;</span><br><span class="line">    <span class="comment">// is optional</span></span><br><span class="line">    isAdmin?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="comment">// is optional</span></span><br><span class="line">    requiresAuth?: <span class="built_in">boolean</span>;</span><br><span class="line">    <span class="comment">// must be declared by every route</span></span><br><span class="line">    title: <span class="built_in">string</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加路由元信息声明"><a href="#添加路由元信息声明" class="headerlink" title="添加路由元信息声明"></a>添加路由元信息声明</h4><h3 id="选择组件库-☞-本项目使用-ant-design-vue-所以选用-less-方便覆盖默认主题"><a href="#选择组件库-☞-本项目使用-ant-design-vue-所以选用-less-方便覆盖默认主题" class="headerlink" title="选择组件库 ☞ 本项目使用 ant-design-vue, 所以选用 less, 方便覆盖默认主题"></a>选择组件库 ☞ 本项目使用 <code>ant-design-vue</code>, 所以选用 less, 方便覆盖默认主题</h3><h4 id="配置主题文件"><a href="#配置主题文件" class="headerlink" title="配置主题文件"></a>配置主题文件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用插件转换文件</span></span><br><span class="line"><span class="keyword">import</span> lessToJS <span class="keyword">from</span> <span class="string">&#x27;less-vars-to-js&#x27;</span></span><br><span class="line"><span class="keyword">const</span> themeVariables = lessToJS(</span><br><span class="line">  fs.readFileSync(path.resolve(__dirname, <span class="string">&#x27;./src/styles/variable.less&#x27;</span>), <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">  css: &#123;</span><br><span class="line">    preprocessorOptions: &#123;</span><br><span class="line">      <span class="comment">// 在这里覆盖css全局变量, 可覆盖变量可在varible.less中查看</span></span><br><span class="line">      less: &#123;</span><br><span class="line">        modifyVars: themeVariables,</span><br><span class="line">        javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="安装-CSS-预处理器"><a href="#安装-CSS-预处理器" class="headerlink" title="安装 CSS 预处理器"></a>安装 CSS 预处理器</h3><blockquote>
<p>请匹配 组件库 的选择</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .scss and .sass</span></span><br><span class="line">npm install -D sass</span><br><span class="line"><span class="comment"># .less</span></span><br><span class="line">npm install -D less</span><br><span class="line"><span class="comment"># .styl and .stylus</span></span><br><span class="line">npm install -D stylus</span><br></pre></td></tr></table></figure>

<h4 id="替换-moment-为-dayjs"><a href="#替换-moment-为-dayjs" class="headerlink" title="替换 moment 为 dayjs"></a>替换 moment 为 dayjs</h4><ol>
<li><p><code>yarn add dayjs</code> or <code>npm i dayjs</code></p>
</li>
<li><p>在 <code>vite.config</code>中添加 alias</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      moment: <span class="string">&#x27;dayjs&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <code>main.ts</code>文件里添加相关插件, 添加前后分别打包进行比较</p>
</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">&quot;dayjs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isSameOrBefore <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/isSameOrBefore&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isSameOrAfter <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/isSameOrAfter&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> advancedFormat <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/advancedFormat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> customParseFormat <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/customParseFormat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> weekday <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/weekday&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> weekOfYear <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/weekOfYear&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isMoment <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/isMoment&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> localeData <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/localeData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> localizedFormat <span class="keyword">from</span> <span class="string">&quot;dayjs/plugin/localizedFormat&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;dayjs/locale/zh-cn&quot;</span>; <span class="comment">// 导入本地化语言</span></span><br><span class="line"></span><br><span class="line">dayjs.extend(isSameOrBefore);</span><br><span class="line">dayjs.extend(isSameOrAfter);</span><br><span class="line">dayjs.extend(advancedFormat);</span><br><span class="line">dayjs.extend(customParseFormat);</span><br><span class="line">dayjs.extend(weekday);</span><br><span class="line">dayjs.extend(weekOfYear);</span><br><span class="line">dayjs.extend(isMoment);</span><br><span class="line">dayjs.extend(localeData);</span><br><span class="line">dayjs.extend(localizedFormat);</span><br><span class="line">dayjs.locale(<span class="string">&quot;zh-cn&quot;</span>); <span class="comment">// 使用本地化语言</span></span><br></pre></td></tr></table></figure>

<h2 id="开发过程中与-vue3-开发文档相关的一些知识点"><a href="#开发过程中与-vue3-开发文档相关的一些知识点" class="headerlink" title="开发过程中与 vue3 开发文档相关的一些知识点"></a>开发过程中与 vue3 开发文档相关的一些知识点</h2><h3 id="响应式-API"><a href="#响应式-API" class="headerlink" title="响应式 API"></a>响应式 API</h3><ul>
<li><code>reaåctive()</code>: 返回对象的响应式副本</li>
</ul>
<h3 id="SetUp-amp-ref-unRef-amp-toRefs"><a href="#SetUp-amp-ref-unRef-amp-toRefs" class="headerlink" title="SetUp &amp; ref() || unRef() &amp; toRefs()"></a>SetUp &amp; ref() || unRef() &amp; toRefs()</h3><p><strong><em>SetUp(props, context)</em></strong> 逻辑块组合，可组合:<code>生命周期函数/watch/computed</code>，返回<strong>对象</strong>，对象可包含 <code>data/methods/computed</code></p>
<h4 id="生命周期映射关系"><a href="#生命周期映射关系" class="headerlink" title="生命周期映射关系"></a>生命周期映射关系</h4><ul>
<li><del><code>beforeCreate</code></del> -&gt; use <code>setup()</code></li>
<li><del><code>created</code></del> -&gt; use <code>setup()</code></li>
<li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li>
<li><code>mounted</code> -&gt; <code>onMounted</code></li>
<li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li>
<li><code>updated</code> -&gt; <code>onUpdated</code></li>
<li><code>beforeUnmount</code> -&gt; <code>onBeforeUnmount</code></li>
<li><code>unmounted</code> -&gt; <code>onUnmounted</code></li>
<li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li>
<li><code>renderTracked</code> -&gt; <code>onRenderTracked</code></li>
<li><code>renderTriggered</code> -&gt; <code>onRenderTriggered</code></li>
</ul>
<blockquote>
<p>由于 <code>props</code> 是响应式的，所以不能使用<code>ES6解构</code>，因为 <strong><em>解构是浅复制，非引用类型属性拷贝后会跟原 prop 属性脱离，是一个新的变量，没有响应性，引用类型的属性（数组，对象，函数）还会保持引用，这 2 种情况下解构后的变量响应性不统一</em></strong> 所以会消除 prop 的响应性，如果需要解构 prop,使用 <code>toRefs</code></p>
</blockquote>
<blockquote>
<p>若要获取传递给 setup() 的参数的类型推断，请使用 <code>defineComponent</code></p>
</blockquote>
<h4 id="在-Setup-中使用-Router"><a href="#在-Setup-中使用-Router" class="headerlink" title="在 Setup 中使用 Router"></a>在 Setup 中使用 Router</h4><blockquote>
<p>请使用<code>useRouter()</code> || <code>useRoute()</code>, 模板中可以访问 <code>$router</code> 和 <code>$route</code>，所以不需要在 setup 中返回 <code>router</code> 或 <code>route</code></p>
</blockquote>
<ul>
<li><code>userLink &amp; RouterLink</code>: 内部行为已经作为一个组合式 API 函数公开</li>
</ul>
<h3 id="ts-相关"><a href="#ts-相关" class="headerlink" title="ts 相关"></a>ts 相关</h3><ul>
<li><code>setup()</code> 函数中，不需要将类型传递给 props 参数，因为它将从 props 组件选项推断类型</li>
<li><code>refs()</code> 1.初始值推断类型;2.传递一个泛型参数;3. 使用<code>Ref&lt;T&gt;</code>替代<code>ref</code></li>
<li><code>readtive()</code> 使用接口(<code>Interface</code>)</li>
<li><code>computed</code>自动推断</li>
</ul>
<h4 id="与-Options-api-一起使用"><a href="#与-Options-api-一起使用" class="headerlink" title="与 Options api 一起使用"></a>与 Options api 一起使用</h4><ul>
<li>复杂的类型或接口使用 <strong>as</strong> 强制转换</li>
</ul>
<h4 id="注解返回类型"><a href="#注解返回类型" class="headerlink" title="注解返回类型"></a>注解返回类型</h4><ul>
<li>computed 的类型难以推断 需要注解</li>
</ul>
<h4 id="注解-props"><a href="#注解-props" class="headerlink" title="注解 props"></a>注解 props</h4><ul>
<li>使用 PropType 强制转换构造函数</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, PropType &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里是接口，也可以是type</span></span><br><span class="line"><span class="keyword">interface</span> Book &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  author: <span class="built_in">string</span>;</span><br><span class="line">  year: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Component = defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    success: &#123; <span class="keyword">type</span>: <span class="built_in">String</span> &#125;,</span><br><span class="line">    callback: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Function</span> <span class="keyword">as</span> PropType&lt;<span class="function">() =&gt;</span> <span class="built_in">void</span>&gt;,</span><br><span class="line">    &#125;,</span><br><span class="line">    book: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;Book&gt;,</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>由于 ts 的设计限制：涉及到为了对函数表达式进行类型推理，你必须注意·对象和数组的<code>validators</code> 和 <code>default</code> 值</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, PropType &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Book &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  year?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Component = defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    bookA: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;Book&gt;,</span><br><span class="line">      <span class="comment">// 请务必使用箭头函数</span></span><br><span class="line">      <span class="keyword">default</span>: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">        title: <span class="string">&quot;Arrow Function Expression&quot;</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">      validator: <span class="function">(<span class="params">book: Book</span>) =&gt;</span> !!book.title,</span><br><span class="line">    &#125;,</span><br><span class="line">    bookB: &#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="built_in">Object</span> <span class="keyword">as</span> PropType&lt;Book&gt;,</span><br><span class="line">      <span class="comment">// 或者提供一个明确的 this 参数</span></span><br><span class="line">      <span class="keyword">default</span>(<span class="built_in">this</span>: <span class="built_in">void</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          title: <span class="string">&quot;Function Expression&quot;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;,</span><br><span class="line">      validator(<span class="built_in">this</span>: <span class="built_in">void</span>, book: Book) &#123;</span><br><span class="line">        <span class="keyword">return</span> !!book.title;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="注解-emit"><a href="#注解-emit" class="headerlink" title="注解 emit"></a>注解 emit</h4><ul>
<li>为触发的事件注解一个有效载荷。另外，所有未声明的触发事件在调用时都会抛出一个类型错误。</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Component = defineComponent(&#123;</span><br><span class="line">  emits: &#123;</span><br><span class="line">    addBook(payload: &#123; bookName: <span class="built_in">string</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// perform runtime 验证</span></span><br><span class="line">      <span class="keyword">return</span> payload.bookName.length &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onSubmit() &#123;</span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">&quot;addBook&quot;</span>, &#123;</span><br><span class="line">        bookName: <span class="number">123</span>, <span class="comment">// 类型错误！</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">this</span>.$emit(<span class="string">&quot;non-declared-event&quot;</span>); <span class="comment">// 类型错误！</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="类型声明-refs"><a href="#类型声明-refs" class="headerlink" title="类型声明 refs"></a>类型声明 refs</h4><ul>
<li>有时我们可能需要为 ref 的内部值指定复杂类型。我们可以在调用 ref 重写默认推理时简单地传递一个泛型参数</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> year = ref&lt;<span class="built_in">string</span> | <span class="built_in">number</span>&gt;(<span class="string">&quot;2020&quot;</span>); <span class="comment">// year&#x27;s type: Ref&lt;string | number&gt;</span></span><br><span class="line">year.value = <span class="number">2020</span>; <span class="comment">// ok!</span></span><br><span class="line"><span class="comment">// 如果泛型的类型未知，建议将 ref 转换为 Ref&lt;T&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="类型声明-reactive"><a href="#类型声明-reactive" class="headerlink" title="类型声明 reactive"></a>类型声明 reactive</h4><blockquote>
<p>与 <code>ref</code> 的区别： 当变量基础类型时使用<code>ref</code>, 引用类型-对象/数组等使用 <code>reactive</code></p>
</blockquote>
<ul>
<li>当声明类型 reactive property，我们可以使用接口</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineComponent, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Book &#123;</span><br><span class="line">  title: <span class="built_in">string</span>;</span><br><span class="line">  year?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">  name: <span class="string">&quot;HelloWorld&quot;</span>,</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> book = reactive&lt;Book&gt;(&#123; title: <span class="string">&quot;Vue 3 Guide&quot;</span> &#125;);</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="keyword">const</span> book: Book = reactive(&#123; title: <span class="string">&quot;Vue 3 Guide&quot;</span> &#125;);</span><br><span class="line">    <span class="comment">// or</span></span><br><span class="line">    <span class="keyword">const</span> book = reactive(&#123; title: <span class="string">&quot;Vue 3 Guide&quot;</span> &#125;) <span class="keyword">as</span> Book;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="开发过程中遇到的问题-TroubleShooting"><a href="#开发过程中遇到的问题-TroubleShooting" class="headerlink" title="开发过程中遇到的问题[TroubleShooting]"></a>开发过程中遇到的问题[TroubleShooting]</h3><h4 id="注意：vite2-自动构建-typescript-模板项目文件，部分同学会在-build-阶段报错，详情请移步"><a href="#注意：vite2-自动构建-typescript-模板项目文件，部分同学会在-build-阶段报错，详情请移步" class="headerlink" title="注意：vite2 自动构建 typescript 模板项目文件，部分同学会在 build 阶段报错，详情请移步"></a>注意：vite2 自动构建 typescript 模板项目文件，部分同学会在 build 阶段报错，详情请移步</h4><ul>
<li><a href="https://github.com/znck/vue-developer-experience/issues/208">error VueDX/TS: context.imports.add is not a function</a></li>
<li><a href="https://github.com/znck/vue-developer-experience/issues/144">@vuedx/typecheck vite build error with <code>const FSP = require(&#39;fs/promises&#39;);</code></a></li>
</ul>
<blockquote>
<p>windows 系统的同学可将 build 打包命令由<code>vuedx-typecheck . &amp;&amp; vite build</code> 改为 <code>vite build &amp;&amp; tsc</code>,ci 脚本内加一条：<code>run: npx --no-install vuedx-typecheck</code></p>
</blockquote>
<h4 id="在ts文件内使用-const-xxx-require-39-xxx-39-报错：require-is-not-defined"><a href="#在ts文件内使用-const-xxx-require-39-xxx-39-报错：require-is-not-defined" class="headerlink" title="在ts文件内使用 const xxx = require(&#39;xxx&#39;)报错：require is not defined"></a>在<code>ts</code>文件内使用 <code>const xxx = require(&#39;xxx&#39;)</code>报错：<code>require is not defined</code></h4><blockquote>
<p>已解决: <code>vite@2.4.1</code>已修复该错误，升级即可</p>
</blockquote>
<ul>
<li><a href="https://github.com/vitejs/vite/issues/2161">Error: require is mot defined</a></li>
</ul>
<h4 id="UI-组件的问题"><a href="#UI-组件的问题" class="headerlink" title="UI 组件的问题"></a>UI 组件的问题</h4><ul>
<li><p>ant-design-vue 按需加载问题:<br>查看<a href="https://github.com/vueComponent/ant-design-vue/issues/3570">Imports using @ant-design/icons-vue should be importing the ESM version</a></p>
</li>
<li><p>and-design-vue 版本问题！！！现发现 <code>form &amp; input</code>组件在引入 es 包时一直报错<code>The requesed module &#39;/node_modules/is-mobile/index.js&#39; is dose not provide an export named &#39;isMobile&#39;</code>，遂升级至 2.1.1 版本，同时删除 vite.config 里 optimizeDeps 的 exclude 的配置,才能使用:<br>详见<a href="https://github.com/vueComponent/ant-design-vue/issues/1936">组件库依赖的 ismobilejs 存在兼容性问题</a></p>
</li>
<li><p>Element-plus 包问题:<br>查看<a href="https://github.com/element-plus/element-plus/issues/1632">element plus issues: [Bug Report] error: [ vite:dep-scan ] Failed to resolve entry for package “element-plus”. The package may have incorrect main/module/exports specified in its package.json</a></p>
</li>
</ul>
<h3 id="依赖强缓存"><a href="#依赖强缓存" class="headerlink" title="依赖强缓存"></a>依赖强缓存</h3><ul>
<li>通过浏览器 devtools 的 Network 选项卡暂时禁用缓存；</li>
<li>重启 Vite dev server，使用 –force 标志重新打包依赖；</li>
<li>重新载入页面。</li>
</ul>
<h2 id="esbuild-预构建"><a href="#esbuild-预构建" class="headerlink" title="esbuild 预构建"></a>esbuild 预构建</h2><h2 id="相关文档链接"><a href="#相关文档链接" class="headerlink" title="相关文档链接"></a>相关文档链接</h2><ul>
<li><a href="https://github.com/typescript-eslint/typescript-eslint/blob/master/docs/getting-started/linting/README.md">tslint 配置</a></li>
<li><a target="_blank" rel="noopener" href="https://esbuild.github.io/getting-started/#bundling-for-the-browser">esbuild</a></li>
<li><a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/">vite</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/01/18/security-cryptography/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/18/security-cryptography/" class="post-title-link" itemprop="url">Security & Cryptography</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-18 13:54:14" itemprop="dateCreated datePublished" datetime="2021-01-18T13:54:14+08:00">2021-01-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-14 13:07:37" itemprop="dateModified" datetime="2021-02-14T13:07:37+08:00">2021-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>熵(Entropy), 单位：bit, 信息熵的计算公式：H(X)= -</p>
</blockquote>
<h2 id="散列函数"><a href="#散列函数" class="headerlink" title="散列函数"></a>散列函数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hash</span>(value: array&lt;byte&gt;) -&gt; vector&lt;byte, N&gt; (N对于该函数固定)</span><br></pre></td></tr></table></figure>

<h2 id="SHA-1-git-中使用的"><a href="#SHA-1-git-中使用的" class="headerlink" title="SHA-1,git 中使用的"></a>SHA-1,git 中使用的</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2021/01/10/command-line/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/10/command-line/" class="post-title-link" itemprop="url">命令行环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-10 15:41:14" itemprop="dateCreated datePublished" datetime="2021-01-10T15:41:14+08:00">2021-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-07 17:53:24" itemprop="dateModified" datetime="2021-04-07T17:53:24+08:00">2021-04-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Vim「作为编辑器的使用功能」"><a href="#Vim「作为编辑器的使用功能」" class="headerlink" title="Vim「作为编辑器的使用功能」"></a>Vim「作为编辑器的使用功能」</h2><h3 id="编辑模式"><a href="#编辑模式" class="headerlink" title="编辑模式"></a>编辑模式</h3><ol>
<li><p>正常：移动光标修改</p>
</li>
<li><p>插入文本： 键入 <strong><em>i</em></strong> 进入插入模式</p>
</li>
<li><p>替换文本：键入 <strong><em>R</em></strong> 进入替换模式</p>
</li>
<li><p>可视化： 选中文本块，键入 <strong><em>v</em></strong> 进入可视化一般模式，<strong><em>V</em></strong> 进入可视化行模式，<strong><em>Ctrl+v</em></strong> 可视化块模式</p>
</li>
<li><p>执行命令：键入 <strong><em>:</em></strong> 进入命令模式：</p>
<ul>
<li><code>:q</code> 退出关闭窗口</li>
<li><code>:w</code> 保存（写）</li>
<li><code>:wq</code> 保存并退出</li>
<li><code>:e &#123;file-name&#125;</code> 打开要编辑的文件</li>
<li><code>:ls</code> 显示打开的缓存</li>
<li><code>:help &#123;标题&#125;</code> 打开帮助文档：<ul>
<li><code>:help :w</code> 打开<code>:w</code>命令的帮助文档</li>
<li><code>:help w</code> 打开<code>w</code>移动的帮助文档</li>
</ul>
</li>
</ul>
</li>
</ol>
<blockquote>
<p>键入 <code>ESC</code> 切换为正常模式</p>
</blockquote>
<h2 id="vim「作为编程语言」"><a href="#vim「作为编程语言」" class="headerlink" title="vim「作为编程语言」"></a>vim「作为编程语言」</h2><h3 id="移动-在缓存中导航"><a href="#移动-在缓存中导航" class="headerlink" title="移动-在缓存中导航"></a>移动-在缓存中导航</h3><ol>
<li>基本移动：<code>hjkl(左下右上-逆时针)</code></li>
<li>词：<code>w</code>-下一个词，<code>b</code>-词初，<code>e</code>-词尾</li>
<li>行：<code>0</code>行初，<code>^</code>-第一个非空格字符，<code>$</code>行尾</li>
<li>屏幕：<code>H</code>-屏幕首行，<code>M</code>-屏幕中间，<code>L</code>-屏幕底部</li>
<li>翻页：<code>Ctrl+u</code>上翻，<code>Ctrl+d</code>下翻</li>
<li>文件： <code>gg</code>-文件头，<code>G</code>文件尾部</li>
<li>杂项：<code>:&#123;line number&#125;&lt;CR&gt;</code> or <code>&#123;line number&#125;G</code></li>
<li>查找：<code>f&#123;character&#125;, t&#123;character&#125;, F&#123;character&#125;, T&#123;character&#125;</code>, (f/F = find, t/T = to, 小写是 forward, 大写是 backward)<ul>
<li>find/to forward/backward {character} on the current line</li>
<li><code>,</code> or <code>;</code>用于导航匹配</li>
</ul>
</li>
<li>搜索：<code>/&#123;regex&#125;</code>向后搜索，<code>n</code> or <code>N</code>用于导航匹配</li>
</ol>
<h3 id="编辑-动词"><a href="#编辑-动词" class="headerlink" title="编辑-动词"></a>编辑-动词</h3><ul>
<li><code>i</code> - insert mode</li>
<li><code>o</code>/<code>O</code> insert line below / above 向下、上插入行</li>
<li><code>d&#123;motion&#125;</code>删除{移动命令}，<code>dw</code>删除词,<code>d$</code>删除到行尾,<code>d0</code>-删除到行头</li>
<li><code>c&#123;motion&#125;</code>改变{移动命令}，<code>cw</code>改变词，<code>d&#123;motion&#125;</code>再<code>i</code></li>
<li><code>x</code>删除字符，等同于<code>dl</code></li>
<li><code>s</code>替换字符，等同于<code>xi</code></li>
<li>可视化模式 + 操作<ul>
<li>选中文字，<code>d</code>删除或者<code>c</code>改变</li>
</ul>
</li>
<li><code>u</code>撤销，<code>&lt;C-r&gt;</code>重做</li>
<li><code>y</code> to copy / “yank” (some other commands like d also copy)</li>
<li><code>p</code> 粘贴</li>
<li><code>~</code> 改变字符大小写</li>
</ul>
<h3 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h3><blockquote>
<p><code>3w</code>向前移动 3 个词，<code>5j</code>向下移动 5 行，<code>7dw</code>删除 7 个词</p>
</blockquote>
<h3 id="修饰语：用修饰语改变语义"><a href="#修饰语：用修饰语改变语义" class="headerlink" title="修饰语：用修饰语改变语义"></a>修饰语：用修饰语改变语义</h3><blockquote>
<p><code>i</code>, <code>a</code>表示在内部，在周围</p>
</blockquote>
<ul>
<li><code>ci(</code>改变当前括号内容</li>
<li><code>ci[</code>改变当前方括号内容</li>
<li><code>da&#39;</code>删除一个单引号字符串，包括周围的单引号</li>
</ul>
<h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><blockquote>
<p>宏(macro)：批处理，命令集合</p>
</blockquote>
<ol>
<li><p>搜索&amp;替换：<code>:s</code>替换</p>
</li>
<li><p>多窗口：<code>:sp</code> or <code>:vsp</code>分割窗口，同一个缓存可以在多个窗口显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下载的 vimrc 文件为例</span></span><br><span class="line">vim vimrc</span><br><span class="line">:sp</span><br><span class="line"><span class="comment"># 此时会有2个窗口查看或编辑vimrc文件</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>宏：<code>q&#123;character&#125;</code>开始在寄存器<code>&#123;character&#125;</code>中录制宏，<code>q</code>停止录制，<code>@</code>重放宏</p>
</li>
<li><p>执行宏 <code>&#123;次数&#125;@&#123;字符&#125;</code>，执行宏<code>&#123;次数&#125;</code>次</p>
</li>
<li><p>宏递归：</p>
<ol>
<li><code>q&#123;character&#125;q</code>清除宏</li>
<li>录制该宏，用@{character}来递归调用该宏</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自动加末尾行注释宏**@t**</span></span><br><span class="line">touch new-practice-vimrc</span><br><span class="line">vim new-practice-vimrc</span><br><span class="line"><span class="comment"># 录制宏t</span></span><br><span class="line">qt</span><br><span class="line"><span class="comment"># i进入编辑模式,编辑器底部显示： --INSERT --Recording @t</span></span><br><span class="line">i</span><br><span class="line"><span class="comment"># 输入通用行尾注释</span></span><br><span class="line"><span class="comment"># esc退出到编辑模式,底部显示 --Recording @t</span></span><br><span class="line"><span class="comment"># q停止宏录制</span></span><br><span class="line">q</span><br><span class="line"><span class="comment"># :wq!保存退出编辑模式，结束</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="vscode-配置-vim-插件"><a href="#vscode-配置-vim-插件" class="headerlink" title="vscode 配置 vim 插件"></a>vscode 配置 vim 插件</h2><ul>
<li>下载插件 Vim</li>
<li>配置 setting.json</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;vim.easymotion&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;vim.suround&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;vim.incsearch&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;vim.useSystemClipboard&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;vim.useCtrlKeys&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;vim.hlsearch&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;vim.insertModeKeyBindings&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;before&quot;</span>: [<span class="string">&quot;j&quot;</span>, <span class="string">&quot;j&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;after&quot;</span>: [<span class="string">&quot;&lt;Esc&gt;&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;vim.normalModeKeyBindingsNonRecursive&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;before&quot;</span>: [<span class="string">&quot;&lt;leader&gt;&quot;</span>, <span class="string">&quot;d&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;after&quot;</span>: [<span class="string">&quot;d&quot;</span>, <span class="string">&quot;d&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;before&quot;</span>: [<span class="string">&quot;&lt;C-n&gt;&quot;</span>],</span><br><span class="line">      <span class="attr">&quot;commands&quot;</span>: [<span class="string">&quot;:nohl&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;vim.leader&quot;</span>: <span class="string">&quot;&lt;space&gt;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;vim.handleKeys&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;&lt;C-a&gt;&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;&lt;C-f&gt;&quot;</span>: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="练习-见missing-semester-文件夹"><a href="#练习-见missing-semester-文件夹" class="headerlink" title="练习-见missing-semester 文件夹"></a>练习-见<a href="https://github.com/MillyTang/missing-semester">missing-semester 文件夹</a></h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2020/11/07/three-easy-pieces/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/07/three-easy-pieces/" class="post-title-link" itemprop="url">three-easy-pieces</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-07 16:15:53" itemprop="dateCreated datePublished" datetime="2020-11-07T16:15:53+08:00">2020-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-02 17:08:32" itemprop="dateModified" datetime="2021-09-02T17:08:32+08:00">2021-09-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="操作系统阅读笔记-Three-Easy-Pieces"><a href="#操作系统阅读笔记-Three-Easy-Pieces" class="headerlink" title="操作系统阅读笔记 - Three Easy Pieces"></a>操作系统阅读笔记 - Three Easy Pieces</h1><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="http://pages.cs.wisc.edu/~remzi/OSTEP/">免费书籍 PDF 版本</a></li>
<li><a target="_blank" rel="noopener" href="http://pages.cs.wisc.edu/~remzi/OSTEP/Homework/homework.html">Homework</a></li>
<li><a href="https://github.com/remzi-arpacidusseau/ostep-projects">Projects</a></li>
<li><code>其余教辅资料</code>请向<code>contact@epubit.com.cn</code>发送邮件获取</li>
<li><a href="https://github.com/remzi-arpacidusseau/ostep-projects">ostep-Projects</a></li>
</ol>
<h2 id="第一章-虚拟化"><a href="#第一章-虚拟化" class="headerlink" title="第一章 - 虚拟化"></a>第一章 - 虚拟化</h2><h3 id="第一节-CPU-虚拟化-时分共享-进程（和空分共享-磁盘）"><a href="#第一节-CPU-虚拟化-时分共享-进程（和空分共享-磁盘）" class="headerlink" title="第一节 - CPU 虚拟化: 时分共享-进程（和空分共享-磁盘）"></a>第一节 - CPU 虚拟化: 时分共享-进程（和空分共享-磁盘）</h3><h4 id="进程-操作系统为正在运行的程序提供的抽象"><a href="#进程-操作系统为正在运行的程序提供的抽象" class="headerlink" title="进程: 操作系统为正在运行的程序提供的抽象"></a>进程: 操作系统为正在运行的程序提供的抽象</h4><ol>
<li>进程的机器状态组成：</li>
</ol>
<ul>
<li>内存</li>
<li>寄存器<ul>
<li>类型：程序计数器 &amp; 栈指针 &amp; 帧指针</li>
<li>3 部分组成：状态，数据，指令</li>
</ul>
</li>
</ul>
<ol start="2">
<li><p>启动程序的过程：操作系统将程序的 <code>代码</code>和<code>静态数据</code>从磁盘加载到内存中，同时为程序的<code>运行时栈</code>和动态内存<code>堆</code>分配内存，最后启动程序，通常是程序入口（以<code>c</code>为例通常是 main(）函数）。</p>
</li>
<li><p>默认情况下进程都有<code>3个文件描述符</code></p>
</li>
</ol>
<ul>
<li>标准输入<code>0</code></li>
<li>标准输出<code>1</code></li>
<li>标准错误<code>2</code></li>
</ul>
<ol start="4">
<li>进程状态</li>
</ol>
<ul>
<li>initial: 创建进程时的状态</li>
<li>running</li>
<li>ready</li>
<li>blocked</li>
<li>final: 僵死状态，待回收，有时候会出现 parent progress 已经被回收但是 child progress 还在僵死状态时，此时有高一级的 init 进程回收，或者直接关机也行（有些垃圾程序只能关机。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进程主要状态</span></span><br><span class="line">running  &lt;----------- 调度|取消调度 ----------&gt; ready</span><br><span class="line">  |                                             |</span><br><span class="line">  |---I/O: start---&gt; blocked --I/O: finished---&gt;|</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>上下文切换：操作系统保存和恢复该进程的寄存器内容的过程</li>
</ol>
<h4 id="进程-API-系统调用陷入内核模式-区别于用户模式）"><a href="#进程-API-系统调用陷入内核模式-区别于用户模式）" class="headerlink" title="进程 API(系统调用陷入内核模式,区别于用户模式）"></a>进程 API(系统调用陷入内核模式,区别于用户模式）</h4><blockquote>
<p>暂时只考虑单 CPU 的情况，不管是什么进程，CPU 都有可能不断中断，切换任意进程，记住就算是亲子（进程）也是不存在尊老爱幼的，谁先运行取决于 CPU 调度程序，所以执行顺序是不确定的。⚠️ 这种不确定性贯穿全文</p>
</blockquote>
<ol>
<li>fork()：调用一次返回两次，争先恐后</li>
</ol>
<ul>
<li>fork()虽然复制了 parent progress，但是由于写时复制拥有私有虚拟内存（用户栈），但是调用时返回值却不相同，child progress 的返回值是 0，parent progress 的返回值是 child progress 的 pid。</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 有必要理解一下返回2次, 示例代码（c）如下：</span></span><br><span class="line"><span class="comment">// 头文件省略</span></span><br><span class="line"><span class="comment">// 让我们先假定child progress先运行</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;您好，当前运行进程pid:%d&quot;</span>, <span class="keyword">int</span> getpid());</span><br><span class="line">  <span class="keyword">int</span> rc = fork()</span><br><span class="line">  <span class="comment">// 不考虑fork失败</span></span><br><span class="line">  <span class="keyword">if</span> (rc == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// child process, 这里根据 rc 的返回值运行一次 - !!返回一次</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rc &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// parent process, 这里根据 rc 的返回值再运行一次 - !!返回两次</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>‼️ 注意：nodejs child_process.fork()虽然调用的是 fork(2),但是却有所不同，衍生的 child progress 不会克隆当前 parent progress，只能通过 IPC 通信。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令行执行: node ./os-notes/chapter-5.js 输出结果:</span></span><br><span class="line">此消息最新显示</span><br><span class="line">衍生的child progress的 pid：95650</span><br><span class="line">此进程的 pid 是 95649</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>exec()：鸠占鹊巢，臭不要脸</li>
</ol>
<blockquote>
<p>其他变体：execl(), execle(), execlp(), execv(), execvp()等。‼️ 成功调用不会返回。</p>
</blockquote>
<ul>
<li>exec()会直接覆写当前进程的代码，堆，栈和其他内存空间等。所以新的程序的虚拟地址不变，进程 id 不变</li>
</ul>
<ol start="3">
<li>wait()：parent progress 可以通过调用<code>wait()</code>来确保自己后运行，此时 2 种情况：</li>
</ol>
<ul>
<li>child progress 先运行，然后 parent progress 运行，天意如此。</li>
<li>parent progress 先运行，马上调用<code>wait()</code>，该系统调用会在 child progress 运行结束后返回，然后 parent progress 输出。<br>总结：这 3 个系统调用可以用来实现 shell 的很多有用的功能，例如重定向输出，管道的实现方式等。</li>
</ul>
<blockquote>
<p>‼️ 问题：多进程程序是怎么抽象的？</p>
</blockquote>
<blockquote>
<p>进程是程序运行的一个实例，多进程就是程序运行的多个实例，<code>fork()</code>函数在新的 child progress 中运行相同的程序，child progress 是 parent progress 的复制品，进程上下文中将只有<code>栈</code>内数据不同（通过标记为私有的写时复制，复制时是完全相同的，运行后不同），<code>堆</code>、<code>代码</code>中的数据完全相同，因为 fork 复制进程时只是重新分配了一段虚拟内存复制原进程内容，并且标记为只读，可以通过绘制进程图来了解 fork()。而通过<code>exec()</code>是在当前进程中的上下文中运行另一个新程序，将覆盖当前进程的地址空间（该进程所在的虚拟内存），但是<code>PID</code>(进程 id)不变且继承了调用该函数时已打开的所有文件描述符（即包含<code>stdin</code>,<code>stdout</code>,<code>stderr</code>3 个描述符）。更多内容请参考<code>csapp第八章异常控制流</code>一起食用。</p>
</blockquote>
<h4 id="机制-受限直接执行-limited-direct-execution-简称-LDE-协议"><a href="#机制-受限直接执行-limited-direct-execution-简称-LDE-协议" class="headerlink" title="机制: 受限直接执行(limited direct execution, 简称 LDE 协议)"></a>机制: 受限直接执行(limited direct execution, 简称 LDE 协议)</h4><blockquote>
<p>LDE 协议的两个过程：1. 内核初始化陷阱表，并记住位置以便后续执行操作；2. 在进程中设置节点分配内存，用于保存陷入陷阱和返回的信息</p>
</blockquote>
<p>此协议下需要解决 2 个问题：</p>
<ol>
<li>受限制操作：引入<strong>用户模式(user mode)**，与之对应的是</strong>内核模式(kernel mode)**</li>
</ol>
<ul>
<li>用户模式 和 系统交互 通过 内核模式暴露一些关键功能，如：访问文件系统，创建或销毁进程，或与其他进程通信以及分配更多内存等，称为系统调用。暴露功能的方式为在启动时设置 <strong>陷阱表</strong> 系统可以在 <strong><em>用户模式和内核模式</em></strong>中反复横跳</li>
<li>例如：用户模式下进程不能发出 I/O 请求 ，否则会导致进程终止</li>
</ul>
<ol start="2">
<li>进程切换：</li>
</ol>
<ul>
<li>需要解决操作系统重新获取占据主动权的问题<ul>
<li>等待进程执行系统调用或者出错 - 该进程必须是个听话的好孩子才行</li>
<li>时钟中断</li>
</ul>
</li>
<li>保存进程上下文：2 种可能，存储位置，存储内容和存储方式均不相同<ul>
<li>时钟中断时：用户寄存器有硬件隐式保存，使用该进程的<strong>内核栈</strong>。</li>
<li>调度程序切换进程：内核寄存器被软件 OS 保存，并存储在该进程的进程结构的内存中（‼️ 用户栈吗？）。</li>
</ul>
</li>
</ul>
<ol start="3">
<li>进程并发：锁？中断中禁止中断 - 禁止套娃？信号？ =&gt; 并发章节会详细讨论</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进程的地址空间：</span></span><br><span class="line">-------------------------</span><br><span class="line">| 内核栈（代码，数据，堆，栈）|  ----&gt; 用户代码不可见的内存</span><br><span class="line">--------------------------</span><br><span class="line">|   用户栈（运行时创建）     |</span><br><span class="line">--------------------------</span><br><span class="line">|  共享库的内存映射区域      |</span><br><span class="line">---------------------------</span><br><span class="line">|    运行时堆              |</span><br><span class="line">--------------------------</span><br><span class="line">|    读/写段（.data,.bss） |   ----&gt; 从可执行文件加载</span><br><span class="line">--------------------------</span><br><span class="line">|       只读代码段         |   ----&gt; 从可执行文件加载</span><br><span class="line">|（.init,.text,.rodata）  |</span><br><span class="line">--------------------------</span><br></pre></td></tr></table></figure>

<h4 id="进程调度：介绍"><a href="#进程调度：介绍" class="headerlink" title="进程调度：介绍"></a>进程调度：介绍</h4><blockquote>
<p>如何开发调度策略？ 想一想什么情况下要使用调度策略？然后弄清楚评价调度策略的关键指标是什么？</p>
</blockquote>
<pre><code>工作负载假设：
1. 每一个进程运行相同的时间 -&gt; 完全公平
2. 所有工作同时到达 -&gt; 平均响应时间
3. 一旦开始，每个进程运行到完成 -&gt; 运行时独占CPU
4. 所有进程不涉及I/O -&gt; 进程任务单一
5. 已知每个进程的运行时间 -&gt; 平均周转时间

调度指标：
1. 周转时间 = T完成时间 - T到达时间 =&gt; 性能指标
2. 公平
3. 响应时间 = T首次运行 - T到达时间
让我们设置一个时间函数 T(参与进程, 策略, [放开的假设条件])</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 工作进程假设: 基于逐渐放开以上5个假设条件</span></span><br><span class="line"><span class="comment"># test1: 假定目前的进程为（随机排序执行）：A（10s完成），B（10s完成），C（10s完成）</span></span><br><span class="line"> 10s  10s  10s</span><br><span class="line">-----|||||/////30s</span><br><span class="line">  A    B    C</span><br><span class="line"><span class="comment"># test2: 假定目前的进程为（随机排序执行）：A（100s完成），B（10s完成），C（10s完成） - 假设1</span></span><br><span class="line">         100s                   10s  10s</span><br><span class="line">-------------------------------|||||/////120s</span><br><span class="line">  A    B    C</span><br><span class="line"><span class="comment"># test3: 假定目前的进程为（随机排序执行）：A（100s完成）0s到达，B（10s完成）10s到达，C（10s完成）10s到达 - 假设1&amp;2</span></span><br><span class="line">         100s                   10s  10s</span><br><span class="line">-------------------------------|||||/////120s</span><br><span class="line">  A    B    C</span><br><span class="line"><span class="comment"># test4: 假定目前的进程为（随机排序执行）：A（100s完成）0s到达，B（10s完成）10s到达，C（10s完成）10s到达 - 假设1&amp;2&amp;3</span></span><br><span class="line"> 10s  10s  10s         90s</span><br><span class="line">-----|||||/////--------------------------120s</span><br><span class="line">  A    B    C           A</span><br></pre></td></tr></table></figure>

<ol>
<li>先进先出<strong>FIFO</strong>：队列</li>
</ol>
<ul>
<li>平均周转时间：<ul>
<li>Tt(test1,FIFO,[]) = (10 + 20 + 30) / 3 = 20s</li>
<li>Tt(test2,FIFO,[1]) = (100 + 110 + 120) / 3 = 110s</li>
</ul>
</li>
</ul>
<ol start="2">
<li>最短任务优先<strong>SJF</strong>：FIFO 下一旦出现单个长任务周转时间就很长，改进一下策略</li>
</ol>
<ul>
<li>平均周转时间：<ul>
<li>Tt(test2,SJF,[1]) = (10 + 20 + 120) / 3 = 50s</li>
<li>Tt(test3,SJF,[1,2]) = (100 + 110-10 + 120-10 ) / 3 = 103.3s</li>
</ul>
</li>
</ul>
<ol start="3">
<li>最短完成时间优先<strong>STCF</strong>：SJF 下短任务后到达时，长任务的周转时间并没有改善</li>
</ol>
<ul>
<li><p>平均周转时间：</p>
<ul>
<li>Tt(test4,STCF,[1,2，3]) = (120 + 10 + 20) / 3 = 50s</li>
</ul>
<p>平均周转时间作为唯一指标的话，<strong>STCF</strong>表现良好。然鹅，引入分时系统后用户要求系统交互性好，所以引入响应时间作为新的指标<br>平均响应时间：Tr(test4,STCF,[1，2，3]) = (0 + 10 - 10 + 20 - 10) / 3 = 3.3s;<br>Tr(test1,FIFO,[]) = (0 + 10 - 10 + 20 - 10) / 3 = 3.3s;</p>
</li>
</ul>
<ol start="4">
<li>轮转<strong>RR(Round-Robin)</strong>: RR 在一个时间片内运行，然后切换到队列的下一个工作，反复切换执行直到所有任务完成。</li>
</ol>
<ul>
<li>时间片(time slice)的长度为时钟中断周期的倍数: 以下示例假设 RR 时间片为 1s</li>
<li>平均响应时间：Tr(test1,SJF,[3]) = (0 + 10 + 20) / 3 = 10</li>
<li>平均响应时间：Tr(test1,RR,[3]) = (0 + 1 + 2) / 3 = 1</li>
<li>假设 RR 时间片为 50ms: Tr(test1,RR,[3]) = (0 + 0.05 + 0.1) / 3 = 0.05s</li>
<li>RR 效率的关键就是时间片的大小，然鹅时间片太小会频繁切换进程上下文，影响整体性能</li>
<li>摊销技术：将时间片的大小与切换上下文时间比较，1ms/10ms _ 100% = 10% =&gt; 太大；1ms/100ms _ 100% = 1% =&gt; 可以考虑</li>
<li>平均周转时间：Tt(test1,RR,[3]) = (26 + 28 + 30) / 3 = 28s ‼️ 周转时间太可怕惹</li>
</ul>
<blockquote>
<p>两种调度程序：SJF,STCF 优化了周转时间，不利于响应时间；RR 优化了响应时间，不利于周转时间，接下来需要放开假设 4 和假设 5</p>
</blockquote>
<pre><code>结合I/O: 重叠，当一个进程被I/O阻塞，CPU可以切换其他进程运行
工作进程假设：A 50ms 运行10ms 发出I/O; B 50ms 没有I/O</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 没有重叠</span></span><br><span class="line">     A   A   A   A  A  B B B B B</span><br><span class="line">CPU: --  --  --  --  --||||||||||</span><br><span class="line">I/O:   --  --  --  --</span><br><span class="line"><span class="comment"># 重叠后</span></span><br><span class="line">CPU: --||--||--||--||--||</span><br><span class="line">I/O:   --  --  --  --</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实际上调度程序并不知道每个工作的长度，下一章将通过构建一个调度程序利用最近的使用情况预测未来从而解决未知工作长度的问题：多级反馈队列</p>
</blockquote>
<h4 id="多级反馈队列-Multi-level-Feedback-Queue"><a href="#多级反馈队列-Multi-level-Feedback-Queue" class="headerlink" title="多级反馈队列(Multi-level Feedback Queue)"></a>多级反馈队列(Multi-level Feedback Queue)</h4><p>这是我遇到的第二个多级，真是相当美妙的思想，第一个多级是多级页表（这本书它出现在第二章，我发誓我没有跳着看书 🐶）</p>
<blockquote>
<p>多级反馈队列要解决 2 个问题：优化周转时间 &amp;&amp; 降低响应时间 =&gt; 从历史中学习并预测</p>
</blockquote>
<pre><code>MLFQ基本规则：
MLFQ有许多独立的队列(queue),每个队列有不同的优先级(priority level)。一个进程只能在一个队列中，MLFQ总是优先执行较高优先级的进程，每个队列中的进程都拥有相同的优先级。
MLFQ的关键在于如何设置优先级。
规则1：若A的优先级 &gt; B的优先级，运行A
规则2：如果A的优先级 == B的优先级，RR（轮转）运行</code></pre>
<blockquote>
<p>刚定下 2 个规则就出现一个问题：AB 两个进程在高优先级队列中，CD 两个进程在低优先级队列中，假设 AB 任务一直运行，CD 岂不是等到死都没法运行</p>
</blockquote>
<pre><code>如何改变优先级：
先考虑工作负载的类型：1.运行时间短，频繁放弃CPU的交互型工作；2.需要更多CPU时间，响应时间不重要的长时间计算密集型工作。
所以调整算法，增加规则：
规则3：工作进入系统，放到最高优先级 - 单个长工作（密集计算型）
规则4a：工作用完整个时间片后，降低到下一个优先级 - 长工作运行一段时间来了一个短工作（交互型）
规则4b：如果工作在时间片内动释放CPU，则优先级不变 - 交互型短工作执行大量I/O操作
以上实例皆运行良好，但是会出现长工作的饥饿问题：
系统中出现了大量的交互型短工作，导致长工作无法得到CPU
||
提升优先级：S太高长工作会饿死，太低交互型工作得不到合适的CPU时间比例
规则5：周期性提升所有工作的优先级，经过一段时间S，将系统中的素有工作重新加入最高优先级队列
更好的计时方式：修改规则4a &amp; 4b:
规则4：一旦工作用来了某一层的时间配额（无论中间主动放弃了多少次CPU），就降低优先级 =&gt; 防止恶意程序愚弄CPU</code></pre>
<blockquote>
<p>MLFQ 调优及其他问题</p>
</blockquote>
<ol>
<li><p>配置多少优先级队列？</p>
</li>
<li><p>每一层队列的时间片设置为多大？</p>
</li>
<li><p>多久提升一次进程的优先级？</p>
<p>大多数的 MLFQ 变体都支持不同队列可变的时间片长度。高优先级队列通常只有较短的时间片，因此这一层的交互工作可以更快的切换，相反，低优先级队列更多的是密集型工作</p>
</li>
</ol>
<h4 id="比例份额"><a href="#比例份额" class="headerlink" title="比例份额"></a>比例份额</h4><h4 id="多处理器调度"><a href="#多处理器调度" class="headerlink" title="多处理器调度"></a>多处理器调度</h4><h3 id="第二节-内存虚拟化"><a href="#第二节-内存虚拟化" class="headerlink" title="第二节 - 内存虚拟化"></a>第二节 - 内存虚拟化</h3><h4 id="地址空间"><a href="#地址空间" class="headerlink" title="地址空间"></a>地址空间</h4><h4 id="内存操作-API"><a href="#内存操作-API" class="headerlink" title="内存操作 API"></a>内存操作 API</h4><h4 id="地址转换"><a href="#地址转换" class="headerlink" title="地址转换"></a>地址转换</h4><ol>
<li>分段</li>
<li>分页</li>
</ol>
<ul>
<li>快速地址转换</li>
<li>较小的表</li>
</ul>
<ol start="3">
<li>交换空间</li>
</ol>
<ul>
<li>虚拟化磁盘空间</li>
<li>替换策略</li>
<li>虚拟内存技巧及示例</li>
</ul>
<h4 id="空闲空间管理"><a href="#空闲空间管理" class="headerlink" title="空闲空间管理"></a>空闲空间管理</h4><h2 id="第二章-并发"><a href="#第二章-并发" class="headerlink" title="第二章 - 并发"></a>第二章 - 并发</h2><h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><h3 id="基于并发的数据结构"><a href="#基于并发的数据结构" class="headerlink" title="基于并发的数据结构"></a>基于并发的数据结构</h3><h3 id="条件变量"><a href="#条件变量" class="headerlink" title="条件变量"></a>条件变量</h3><h3 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h3><h3 id="常见并发问题"><a href="#常见并发问题" class="headerlink" title="常见并发问题"></a>常见并发问题</h3><h3 id="基于事件的并发"><a href="#基于事件的并发" class="headerlink" title="基于事件的并发"></a>基于事件的并发</h3><h4 id="事件循环："><a href="#事件循环：" class="headerlink" title="事件循环："></a>事件循环：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 伪代码</span></span><br><span class="line"><span class="keyword">while</span>(1) &#123;</span><br><span class="line">  events = getEvents()</span><br><span class="line">  <span class="keyword">for</span> (e <span class="keyword">in</span> events)</span><br><span class="line">    processEvents(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>基于事件的服务器如何决定事件的发生顺序？尤其是网络和 I/O</p>
</blockquote>
<pre><code>这里我们有一个例子，来首先了解一下select()函数：这个例子是从CSAPP上抄来的，select真是令人印象深刻
假设有一个echo服务器，它很强，一边接收网络请求，一边也可以响应用户的命令行键入请求。肿么办捏，先处理哪一个？更具体的代码示例请参考`《CSAPP》第12章第2节基于I/O多路复用的并发编程`
基于I/O多路复用技术的并发：使用select(),要求内核挂起进程，只有在一个或者多个I/O发生后才将控制权返回给应用程序（说人话：多个I/O请求注册到同一个select, select搞一个集合存储他们的状态，只要有I/O触发那么就由系统调用转回应用程序（用户模式））。</code></pre>
<h4 id="重要-API-select-or-poll-系统调用"><a href="#重要-API-select-or-poll-系统调用" class="headerlink" title="重要 API: select() or poll() 系统调用"></a>重要 API: select() or poll() 系统调用</h4><pre><code>select() 检查I/O描述符集合, 地址通过`readfds`,`writefds`, `errorfds`传入；
在每个集合中检查前nfds个描述符。
返回时，select()用给定请求操作准备好的描述符组成的子集替换给定的描述符集合，返回所有集合中就绪描述符的总数。</code></pre>
<blockquote>
<p>请注意 select()的超时参数，常见用法是设置为 NULL,但会导致无限期阻塞，直到有可用的就绪描述符。更好的做法是将超时设置为 0，因此让调用的 select()立即返回，这种方式提供了一种构建非阻塞（异步）事件循环的方法。</p>
</blockquote>
<pre><code>补充：阻塞与非阻塞接口
阻塞（同步）接口：在返回给调用者之前完成所有工作，非阻塞（异步）接口开始一些工作但是立即返回，从而让所有需要完成的工作都在后台完成。
通常阻塞调用的就是某种I/O。
非阻塞接口可用于任何类型的编程（例如使用线程），但在基于事件的方法中非常重要，因为阻塞的调用会阻塞所有进展。</code></pre>
<blockquote>
<p>‼️ 要分清楚并不是所有的非阻塞=异步，I/O 就不是，非阻塞 I/O!==异步 I/O</p>
</blockquote>
<blockquote>
<p>使用单个 CPU 和基于事件的并发服务器，线程并发的程序中存在的抢占锁释放锁等问题不复存在，因为只有一个线程，不会被其他线程中断，但是请务必记住‼️ 不要阻塞基于事件的服务器，即 node 中，小心使用同步 api.</p>
</blockquote>
<blockquote>
<p>阻塞系统的调用：I/O 大 boss 如何解决？</p>
</blockquote>
<h4 id="异步-I-O-Asyncchronous-I-O"><a href="#异步-I-O-Asyncchronous-I-O" class="headerlink" title="异步 I/O(Asyncchronous I/O):"></a>异步 I/O(Asyncchronous I/O):</h4><ol>
<li>发出异步读取</li>
<li>如何才能知道 I/O 已经完成，并且缓冲区(aio_buf)已经有了数据: aio_error 系统调用检查 aiocbp 引用的请求是否已经完成，如果完成则函数返回成功 <strong><em>（用 0 表示）</em></strong>,否则返回 EINPROGRESS。对于每个未完成的 AIO，应用程序可以调用 aio_error 来周期性的轮询(poll)系统，以确定所述 I/O 是否完成。这条看着很累，看下一条，宝贝。</li>
<li>poll 一个 I/O 害行，1000 个捏恐怕要累屎惹，所以某些系统提供了 <strong>基于中断(interrupt)</strong> 的方法。使用 UNIX 信号(signal)在异步 I/O 完成时通知一下程序，从而消除了轮询的痛苦，从今以后幸福快乐 🥰。</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AIO control block</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">aiocb</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> aio_fildes; <span class="comment">/* file descriptor */</span></span><br><span class="line">  <span class="keyword">off_t</span> aio_offser; <span class="comment">/* file offset */</span></span><br><span class="line">  <span class="keyword">volatile</span> <span class="keyword">void</span> *aio_buf; <span class="comment">/* location of buffer */</span></span><br><span class="line">  <span class="keyword">size_t</span> aio_nbytes; <span class="comment">/* length of transfer */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// AIO 第一步： 向文件发出异步读取,发出成功后会立即返回并且应用程序可以继续工作</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_read</span><span class="params">(struct aiocb * aiocbp)</span></span>;</span><br><span class="line"><span class="comment">// AIO 第二步：</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_error</span><span class="params">(<span class="keyword">const</span> struct aiocb *aiocbp)</span></span></span><br></pre></td></tr></table></figure>

<pre><code>补充：UNIX信号
信号提供了一种与进程通信的方式，可以将信号传递给应用程序，进程将暂停当前工作开始运行信号处理程序。完成后，该进程就回复先前的行为。
每个信号都有名字，如：HUP(挂断),INT(中断),SEGV(段违规)
内核或者程序都可以发出信号
可以用kill命令行工具发出信号，例如：
prompt &gt; ./main &amp; [3] 36705
prompt &gt; kill -HUP 36705
stop wakin&#39; me up...</code></pre>
<blockquote>
<p>在没有异步 I/O 的系统中，纯基于事件的方法无法实现。然鹅可以使用某种混合方法，使用线程池来管理未完成的 I/O。参考《flash: an efficient and portable web server》来了解更多。</p>
</blockquote>
<h4 id="状态管理：基于事件的方法的另一个复杂问题"><a href="#状态管理：基于事件的方法的另一个复杂问题" class="headerlink" title="状态管理：基于事件的方法的另一个复杂问题"></a>状态管理：基于事件的方法的另一个复杂问题</h4><pre><code>当事件处理程序（事件循环中待处理的一个事件）发出异步I/O时，必须打包一些程序状态，以便下一个事件处理程序在I/O完成完成时使用。而基于线程的工作是不需要的，因为状态都保存在线程栈内。
node是如何处理这个问题的？
据鄙人看完的《深入浅出nodejs》后的一些笔记来看，node只是JS运行在单线程上，异步I/O另有线程：
部分线程通过阻塞或非阻塞&amp;轮询技术来完成数据获取，一个线程进行计算处理，通过线程间通信进行数据传递，实现异步I/O，也就是说node处理异步I/O是通过管理线程池来实现的。（没想到吧Σ(⊙▽⊙&quot;a）</code></pre>
<h4 id="太难了"><a href="#太难了" class="headerlink" title="太难了"></a>太难了</h4><p>当系统是多核 CPU 时，基于事件的一些简单性（不用加锁，不存在线程中断）就没有了，为了利用多个 CPU，事件服务器必须并行运行多个事件处理程序，这时会出现「缓存一致性」？「加锁！必须加锁!!」,「发生缺页肿么办！被堵死了」等各种问题，现在先不要心塞，后面心塞的还多着呢，抽屉里放点硝酸甘油片啥的 ❤️。</p>
<blockquote>
<p>思考：同步 I/O 包含非阻塞 I/O 吗？异步 I/O 呢？</p>
</blockquote>
<p>I/O 包含两步：请求和数据复制到缓冲区</p>
<table>
<thead>
<tr>
<th>I/O 类型</th>
<th>请求</th>
<th>数据复制到缓冲区（aio_buf）</th>
<th>检查 I/O 是否完成的方法</th>
</tr>
</thead>
<tbody><tr>
<td>同步 I/O</td>
<td>阻塞</td>
<td>阻塞</td>
<td>等前两步完成也就拿到了</td>
</tr>
<tr>
<td>非阻塞 I/O</td>
<td>异步</td>
<td>阻塞</td>
<td>轮询，CPU 很忙</td>
</tr>
<tr>
<td>I/O 多路复用</td>
<td>异步</td>
<td>阻塞</td>
<td>轮询，CPU 很忙（linux: epoll;）</td>
</tr>
<tr>
<td>异步 I/O</td>
<td>异步</td>
<td>异步</td>
<td>中断时发信号(windows:IOCP)</td>
</tr>
</tbody></table>
<h4 id="技术总结：组合使用用于网络的-select-接口和用于磁盘的-AIO-的调用（我猜-node-就是这样）"><a href="#技术总结：组合使用用于网络的-select-接口和用于磁盘的-AIO-的调用（我猜-node-就是这样）" class="headerlink" title="技术总结：组合使用用于网络的 select()接口和用于磁盘的 AIO 的调用（我猜 node 就是这样）"></a>技术总结：组合使用用于网络的 select()接口和用于磁盘的 AIO 的调用（我猜 node 就是这样）</h4><p>node 基于 I/O（AIO（通过线程池来实现异步 I/O））多路复用，所以是<strong>单线程（JS）、非阻塞、异步 I/O</strong>，JS 运行的单线程不会阻塞，但是 I/O 过程有可能是阻塞的，一旦遇到缺页就会卡住，就算主动去非洲客户也不会原谅你，OMG 生活真是苦涩。</p>
<blockquote>
<p>思考: node 单线程是怎么实现并发的？</p>
</blockquote>
<pre><code>nodejs使用cluster(集群)创建多个共享服务器端口的child progress来利用多核CPU系统
原理是：child_process.fork()衍生的是独立的child progress，和 parent progress只通过IPC管道来通信，可以根据需要随时关闭或者创建，不影响其他进程。
cluster分发连接：主进程负责监听接口，然后循环分发给各child progress。</code></pre>
<blockquote>
<p>思考：多个进程为什么可以共享服务器端口？</p>
</blockquote>
<pre><code>首先要知道监听描述符和已连接描述的区别，是并发服务器的基础，每次一个请求到达监听描述符时，可以在此时派发fork()一个新进程来连接已连接描述符与客户端通信。服务器调用server.listen(&#123;fd:7&#125;)将消息发给主进程，parent progress将监听监听描述符并将句柄（handle）派发给child progress，child progress调用server.listen(handle)会显式监听handle而不是与 parent progress通信，child progress还会调用server.listen(0)会收到相同的「随机端口」，随机端口在第一次随机分配，而后都是已知的。
如果需要独立端口，可根据child progress的PID来生成。</code></pre>
<blockquote>
<p>思考 again: nodejs 主进程挂了肿么办？所有相关 child progress 会一起被回收还是移交给主进程挂掉时立即重启一个新的 parent progress 呢？</p>
</blockquote>
<pre><code>child progress死亡不会影响 parent progress, 不过child progress死亡时（线程组的最后一个线程，通常是“领头”线程死亡时），会向它的 parent progress发送死亡信号. 反之 parent progress死亡, 一般情况下child progress也会随之死亡, 但如果此时child progress处于可运行态、僵死状态等等的话, child progress将被进程1（init 进程，由内核创建，是所有进程的祖先）收养，从而成为孤儿进程. 另外, child progress死亡的时候（处于“终止状态”），parent progress没有及时调用 wait() 或 waitpid() 来返回死亡进程的相关信息，此时child progress还有一个 PCB (Process Control Block进程控制结构)残留在进程表中，被称作僵尸进程.</code></pre>
<blockquote>
<p>思考：让我们来想想 <strong><em>nodejs 进程管理</em></strong> 是怎么实现的?</p>
</blockquote>
<h2 id="第三章-持久性"><a href="#第三章-持久性" class="headerlink" title="第三章 - 持久性"></a>第三章 - 持久性</h2><h3 id="I-O-设备"><a href="#I-O-设备" class="headerlink" title="I/O 设备"></a>I/O 设备</h3><h3 id="磁盘驱动器"><a href="#磁盘驱动器" class="headerlink" title="磁盘驱动器"></a>磁盘驱动器</h3><h3 id="RAID-冗余磁盘阵列"><a href="#RAID-冗余磁盘阵列" class="headerlink" title="RAID 冗余磁盘阵列"></a>RAID 冗余磁盘阵列</h3><h3 id="文件与目录"><a href="#文件与目录" class="headerlink" title="文件与目录"></a>文件与目录</h3><h3 id="文件系统的实现"><a href="#文件系统的实现" class="headerlink" title="文件系统的实现"></a>文件系统的实现</h3><h4 id="局部性和快速文件系统"><a href="#局部性和快速文件系统" class="headerlink" title="局部性和快速文件系统"></a>局部性和快速文件系统</h4><h4 id="崩溃一致性"><a href="#崩溃一致性" class="headerlink" title="崩溃一致性"></a>崩溃一致性</h4><h4 id="日志结构文件系统"><a href="#日志结构文件系统" class="headerlink" title="日志结构文件系统"></a>日志结构文件系统</h4><h4 id="数据完整性和保护"><a href="#数据完整性和保护" class="headerlink" title="数据完整性和保护"></a>数据完整性和保护</h4><h4 id="思考：数据库"><a href="#思考：数据库" class="headerlink" title="思考：数据库"></a>思考：数据库</h4><h2 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h2><h3 id="通信基础"><a href="#通信基础" class="headerlink" title="通信基础"></a>通信基础</h3><h3 id="Sun-的网络文件系统-NFS-Network-File-System"><a href="#Sun-的网络文件系统-NFS-Network-File-System" class="headerlink" title="Sun 的网络文件系统 NFS (Network File System)"></a>Sun 的网络文件系统 NFS (Network File System)</h3><h3 id="Andrew-文件系统-AFS"><a href="#Andrew-文件系统-AFS" class="headerlink" title="Andrew 文件系统 AFS"></a>Andrew 文件系统 AFS</h3><h3 id="思考：与计算机网络的联系"><a href="#思考：与计算机网络的联系" class="headerlink" title="思考：与计算机网络的联系"></a>思考：与计算机网络的联系</h3><h4 id="TCP-与-UDP-的比较"><a href="#TCP-与-UDP-的比较" class="headerlink" title="TCP 与 UDP 的比较"></a>TCP 与 UDP 的比较</h4><h4 id="TCP-握手挥手机制"><a href="#TCP-握手挥手机制" class="headerlink" title="TCP 握手挥手机制"></a>TCP 握手挥手机制</h4><h4 id="TCP-与-UDP-的丢包处理"><a href="#TCP-与-UDP-的丢包处理" class="headerlink" title="TCP 与 UDP 的丢包处理"></a>TCP 与 UDP 的丢包处理</h4><h4 id="实践：局部网络中的通信-wireless"><a href="#实践：局部网络中的通信-wireless" class="headerlink" title="实践：局部网络中的通信-wireless"></a>实践：局部网络中的通信-wireless</h4><!-- #### 推荐阅读：以操作系统为基础按顺序阅读以下书籍

1. CSAPP
2. unix环境高级编程
3. 图解TCP/IP && Wireshark网络分析就是这么简单
4. 深入浅出nodejs
5. 算法
6. 数据库概论
7. SQL基础教程
8. Redis深度历险：核心原理与应用实践
9. Redis设计与实现
10. 数据密集型应用系统设计 -->

<!-- ### 思考：与CDN的比较 -->

<!-- ## 梳理：数据结构和算法的应用
1. LRU... -->

<!-- ## 练习
### Homework(js版本)
### Projects(js版本) -->

<!-- ## 待补充：《UNIX环境高级编程》
### 文件I/O
### 终端I/O
### 文件与目录
### 进程
### 线程
### 信号
### IPC -->

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2020/11/07/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/07/Docker/" class="post-title-link" itemprop="url">Docker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-07 16:10:21" itemprop="dateCreated datePublished" datetime="2020-11-07T16:10:21+08:00">2020-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-10 18:38:42" itemprop="dateModified" datetime="2020-11-10T18:38:42+08:00">2020-11-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Set-up-your-Docker-environment"><a href="#Set-up-your-Docker-environment" class="headerlink" title="Set up your Docker environment"></a>Set up your Docker environment</h2><ul>
<li>准备工作： 下载</li>
<li>Dockerfile: 项目中根目录下增加一个Dockerfile配置文件，以前端项目为例</li>
<li>docker 几个概念和常用命令:<ul>
<li>概念：<ul>
<li><code>container</code>: 容器，一个被隔离的且有自己的文件系统，网络的正常的操作系统进程，进程树独立于主机</li>
<li><code>image</code>: 镜像，一个配置文件用来生成容器的</li>
</ul>
</li>
<li>常用命令：<ol>
<li><code>docker run your-Docker-image</code>,</li>
<li><code>docker ps --all</code></li>
<li>Build and test: <code>docker build --tag tagName:Vsesion .</code></li>
<li>Run your image as a container: <code>docker run --publish 8000:8080 --detach --name container-alias-name tagName:Vsesion</code></li>
<li>Delete container: <code>docker rm --force container-alias-name</code></li>
</ol>
</li>
</ul>
</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FORM: 从 node:12.18.1 这个线上的image继承</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">12.18</span>.<span class="number">1</span></span><br><span class="line"><span class="comment"># ENV 执行环境是生产环境还是开发环境</span></span><br><span class="line"><span class="keyword">ENV</span> NODE_ENV=production</span><br><span class="line"><span class="comment"># WORKDIR: 工作目录/app</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> [<span class="string">&quot;package.json&quot;</span>, <span class="string">&quot;package-lock.json*&quot;</span>, <span class="string">&quot;./&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install --production</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;server.js&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h2 id="Build-and-run-your-image-In-projects"><a href="#Build-and-run-your-image-In-projects" class="headerlink" title="Build and run your image: In projects"></a>Build and run your image: In projects</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2020/11/04/shell-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/shell-notes/" class="post-title-link" itemprop="url">Shell Notes</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 13:11:30" itemprop="dateCreated datePublished" datetime="2020-11-04T13:11:30+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 15:44:46" itemprop="dateModified" datetime="2021-06-26T15:44:46+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="第一章：概览"><a href="#第一章：概览" class="headerlink" title="第一章：概览"></a>第一章：概览</h2><p><code>shell:</code> 计算机提供给用户的一种文字接口，核心功能 - 允许用户执行程序，输入并获取某种半结构化的输出；<br>shell是一个编程环境，所以它具备变量、条件、循环和函数。<br>当你在 shell 中执行命令时，实际上是在执行一段 shell 可以解释执行的简短代码。<br>如果要求 shell 执行某个指令，但是该指令并不是 shell 所了解的编程关键字，那么它会去查询环境变量 $PATH，搜索由<code>:</code>分隔的一系列目录，基于名字搜索该执行程序</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><h4 id="shell的界面（bash-zsh）"><a href="#shell的界面（bash-zsh）" class="headerlink" title="shell的界面（bash@zsh）"></a>shell的界面（bash@zsh）</h4><p><code>#</code> 开头是注释，提示信息，<code>hostname</code>是主机名，<code>~</code>指当前工作目录是<code>home</code>，<code>$</code>表示当前用户不是<code>root</code>用户，<code>Last login...</code>打开一个新的window就会出现该提示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Last login: Tue Nov  3 17:59:22 on ttys007</span><br><span class="line"><span class="comment"># hostname @ MacBook-Air in ~ [13:34:52]</span></span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<h4 id="基础命令-使用-man-command-来了解这些命令的详细信息"><a href="#基础命令-使用-man-command-来了解这些命令的详细信息" class="headerlink" title="基础命令: 使用 man [command]来了解这些命令的详细信息"></a>基础命令: 使用 <code>man [command]</code>来了解这些命令的详细信息</h4><blockquote>
<p>内置命令&amp;变量: date, echo, which echo, $PATH, ls, cd, pwd, /(root path), ./(current path,relative), ../(parent path, relative), mv(用于重命名或移动文件), mkdir(新建文件夹), cp(复制文件)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="comment"># -l  use a long listing format</span></span><br><span class="line">$ ls -l /home</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   3 user  staff   96 12  9  2016 beginning</span><br><span class="line">  _3_           /|\</span><br><span class="line">   |_____________|</span><br><span class="line"><span class="comment"># d -&gt; directory</span></span><br><span class="line"><span class="comment"># 然后接下来的九个字符，每三个字符构成一组</span></span><br><span class="line"><span class="comment"># rwx -&gt; 指(user)文件所有者的权限</span></span><br><span class="line"><span class="comment"># r-x -&gt; 用户(staff)的权限，`-x`代表staff没有执行文件(x)的权限</span></span><br><span class="line"><span class="comment"># r-x -&gt; 其他客人用户的权限</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Last login: Fri Nov  6 18:13:54 on ttys007</span><br><span class="line"><span class="comment"># username @ MacBook-Air in ~ [13:34:52]</span></span><br><span class="line">$ date</span><br><span class="line">2020年11月 7日 星期六 16时09分15秒 CST</span><br><span class="line">$ <span class="built_in">echo</span> hello DaiYing</span><br><span class="line">hello DaiYing</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/Users/hostname/.yarn/bin:/Users/hostname/.config/yarn/global/node_modules/.bin:/Users/hostname/.avn/bin:/Users/hostname/.nvm/versions/node/v8.9.4/bin:/usr/<span class="built_in">local</span>/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Users/hostname/.rvm/bin</span><br><span class="line">$ <span class="built_in">which</span> <span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span>: shell built-in <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<h4 id="在程序间建立连接"><a href="#在程序间建立连接" class="headerlink" title="在程序间建立连接"></a>在程序间建立连接</h4><blockquote>
<p>输入流，输出流，重定向(重定向方向 &lt;, &gt;重定向方向, &gt;&gt;追加内容方向)<br>| (pipes)管道操作符，连接左边的输入到右边的输出<br>sudo(super user do)根用户</p>
</blockquote>
<h4 id="练习题：Mac-OSX系统"><a href="#练习题：Mac-OSX系统" class="headerlink" title="练习题：Mac OSX系统"></a>练习题：Mac OSX系统</h4><ul>
<li>新建tmp/missing/semester文件，按行向semester输入内容</li>
<li><a href="https://github.com/MillyTang/missing-semester/blob/main/first.sh">练习</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># username @ MacBook-Air in ~ [16:52:44]</span></span><br><span class="line">$ mkdir tmp</span><br><span class="line">$ <span class="built_in">cd</span> tmp/</span><br><span class="line">$ mkdir missing</span><br><span class="line">$ <span class="built_in">cd</span> missing/</span><br><span class="line">$ touch semester</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;#!/bin/sh&#x27;</span> &gt; semester</span><br><span class="line"><span class="comment"># 追加第二行内容</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;curl --head --silent https://missing.csail.mit.edu&#x27;</span> &gt;&gt; semester</span><br><span class="line">$ vim semester</span><br><span class="line"><span class="comment"># :q退出</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="第二章：-shell工具和脚本"><a href="#第二章：-shell工具和脚本" class="headerlink" title="第二章： shell工具和脚本"></a>第二章： shell工具和脚本</h2><h3 id="字符串区别"><a href="#字符串区别" class="headerlink" title="字符串区别"></a>字符串区别</h3><ul>
<li><code>&#39;&#39;</code>单引号可以转义</li>
<li><code>&quot;&quot;</code>双引号不行</li>
</ul>
<blockquote>
<p>shell访问变量: 前缀$+变量名；如：$foo</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foo=bar</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$foo</span>&quot;</span></span><br><span class="line">bar</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$foo&#x27;</span></span><br><span class="line"><span class="variable">$foo</span></span><br></pre></td></tr></table></figure>

<h3 id="shell脚本控制流"><a href="#shell脚本控制流" class="headerlink" title="shell脚本控制流"></a>shell脚本控制流</h3><blockquote>
<p>Here is an example of a func that creates a dir and  cd into it</p>
</blockquote>
<ul>
<li><code>$0</code>-script command</li>
<li><code>$1</code>~<code>$9</code>- script command的参数</li>
<li><code>$@</code> script command的所有参数</li>
<li><code>$#</code>- script command参数个数</li>
<li><code>$?</code>-上一个script command</li>
<li><code>$$</code>-当前scrippt command的PID(Process Identification number)</li>
<li><code>!!</code>-使用<code>sudo !!</code>执行上一个command(包含所有参数)</li>
<li><code>$_</code>-上一个命令的最后一个参数</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># testShellFunc.sh</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="function"><span class="title">mcd</span></span>() &#123;</span><br><span class="line">  mkdir -p <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">  <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># bash执行testShellFunc.sh文件</span></span><br><span class="line"><span class="comment"># source 可执行shell文件</span></span><br><span class="line"><span class="built_in">source</span> testShellFunc.sh</span><br><span class="line"><span class="comment"># cd 是在 mcd()内部，针对的是子shell, 不影响外部，所以不能直接执行 ./testShellFunc.sh</span></span><br></pre></td></tr></table></figure>

<h3 id="短路操作符"><a href="#短路操作符" class="headerlink" title="短路操作符"></a>短路操作符</h3><blockquote>
<p><code>||, &amp;&amp;, ;</code>, 同一行命令可以用<code>;</code>间隔，<code>true</code>的返回码是<code>0</code>,<code>false</code>的返回码是<code>1</code></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 和js的短路操作符结果相似，这里唯一特别的是「;」，始终能运行短路后面的语句</span></span><br><span class="line"><span class="literal">true</span> ; <span class="built_in">echo</span> <span class="string">&#x27;I can run!&#x27;</span></span><br><span class="line"><span class="comment"># 输出：I can run!</span></span><br><span class="line"><span class="literal">false</span> ; <span class="built_in">echo</span> <span class="string">&#x27;I can run again!&#x27;</span></span><br><span class="line"><span class="comment"># 输出：I can run again!</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>linux中： <code>| and ||, &amp; and &amp;&amp;, &amp;&gt; and &gt;</code> 的区别：<br><code>&amp;</code> 表示任务在后台执行，如要在后台运行<br><code>|</code> 表示管道，上一条命令的输出，作为下一条命令参数(输入)<br><code>&gt;</code>符号是指：将正常信息重定向; <code>&amp;&gt;</code>可以将错误信息或者普通信息都重定向输出</p>
</blockquote>
<h3 id="命令替换：以变量的形式获取一个命令的输出"><a href="#命令替换：以变量的形式获取一个命令的输出" class="headerlink" title="命令替换：以变量的形式获取一个命令的输出"></a>命令替换：以变量的形式获取一个命令的输出</h3><blockquote>
<p>执行<code>$(CMD)</code>,<code>CMD</code>的执行结果会替换<code>$(CMD)</code>的位置；<br>冷门应用-进程替换:<code>&lt;(CMD)</code>, 执行结果将会输出到一个临时文件而不是通过<code>STDIN</code>传递<br>特殊的进程标识符： 0标准输入(stdin),1标准输出(stdout),2标准错误(stderr)</p>
</blockquote>
<ul>
<li><code>2&gt;</code>重定向stderr；引申：<code>&amp;&gt;</code>重定向stderr, <code>&gt;&amp;2</code>，重定向<code>到</code>stderr</li>
<li><code>-ne</code> means <code>not equal to</code>, 查阅<code>bash 条件表达式</code>或<code>man test</code>(查test手册)</li>
<li>使用<code>shellcheck</code>工具检查shell script错误</li>
<li>详见<a target="_blank" rel="noopener" href="http://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html">bash 条件表达式</a></li>
<li><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man1/test.1.html">test手册</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># testfunc.bash, 注意后缀是bash,而不是sh,因为`[[`判断符与sh不兼容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Starting program at <span class="subst">$(date)</span>&quot;</span> <span class="comment"># date会被替换成日期和时间</span></span><br><span class="line"><span class="comment"># `$$`进程ID，`$#`参数个数，$0当前命令</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Running program <span class="variable">$0</span> with <span class="variable">$#</span> arguments with pid $$&quot;</span></span><br><span class="line"><span class="comment"># `$@`所有参数</span></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$@</span>; <span class="keyword">do</span></span><br><span class="line">    grep foobar <span class="variable">$file</span> &gt; /dev/null 2&gt; /dev/null</span><br><span class="line">    <span class="comment"># 如果模式没有找到，则grep退出状态为 1</span></span><br><span class="line">    <span class="comment"># 我们将标准输出流和标准错误流重定向到Null，因为我们并不关心这些信息</span></span><br><span class="line">    <span class="keyword">if</span> [[ $? -ne 0 ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;File <span class="variable">$file</span> does not have any foobar, adding one&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;# foobar&quot;</span> &gt;&gt; <span class="string">&quot;<span class="variable">$file</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment"># `source testfunc.bash`</span></span><br><span class="line"><span class="comment"># 输出： </span></span><br><span class="line"><span class="comment"># Starting program at 2020年12月20日 星期日 14时52分03秒 CST</span></span><br><span class="line"><span class="comment"># Running program ./testfunc.bash with 0 arguments with pid 10741</span></span><br><span class="line"><span class="comment"># 加点参数执行 `source testfunc.bash test1 test2`, 同时在同级目录下生成了 test1 &amp; test2文件并向文件中输入了 `# foobar`</span></span><br><span class="line">Starting program at 2020年12月20日 星期日 14时54分51秒 CST</span><br><span class="line">Running program ./testfunc.bash with 2 arguments with pid 10741</span><br><span class="line">File test1 does not have any foobar, adding one</span><br><span class="line">File test2 does not have any foobar, adding one</span><br></pre></td></tr></table></figure>

<h3 id="shell的-通配（-globbing）-正则"><a href="#shell的-通配（-globbing）-正则" class="headerlink" title="shell的 通配（ globbing）: {}, 正则"></a>shell的 通配（ globbing）: {}, 正则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">convert image.&#123;png,jpg&#125;</span><br><span class="line"><span class="comment"># 展开为: </span></span><br><span class="line">convert image.png image.jpg</span><br><span class="line">cp /path/to/project/&#123;foo,bar&#125;.sh /newpath</span><br><span class="line"><span class="comment"># 展开为: </span></span><br><span class="line">cp /path/to/project/foo.sh /path/to/project/bar.sh /newpath</span><br><span class="line">mv *&#123;.py,.sh&#125; folder</span><br><span class="line"><span class="comment"># 会移动所有 *.py 和 *.sh 文件</span></span><br><span class="line"><span class="comment"># 显示foo和bar文件的不同</span></span><br><span class="line">diff &lt;(ls foo) &lt;(ls bar)</span><br></pre></td></tr></table></figure>

<h3 id="shebang"><a href="#shebang" class="headerlink" title="shebang"></a>shebang</h3><blockquote>
<p><code>#!</code>语法使用脚本来指示解释器如何在<code>unix/linux</code>下执行<br>例如： <code>#!/bin/bash</code>;<code>#!/usr/bin/perl</code>;<code>#!/usr/bin/python</code>;<code>#!/usr/bin/python3</code>;<code>#!/usr/bin/env bash</code><br>如果不指定解释器，通常会默认为<code>#!/bin/sh</code>,不过官方推荐使用<code>#!/bin/bash</code>,<code>sh和bash</code>在某些语法上有些不兼容，如条件判断<code>[[]]</code></p>
</blockquote>
<ul>
<li>使用<code>env</code>来执行非<code>bash</code>脚本，<code>env</code>会利用<code>PATH</code>变量来定位脚本</li>
<li><a target="_blank" rel="noopener" href="https://bash.cyberciti.biz/guide/Shebang#:~:text=It%20is%20called%20a%20shebang%20or%20a%20%22bang%22,using%20the%20interpreter%20specified%20on%20a%20first%20line.">参考</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/local/bin/python</span></span><br><span class="line"><span class="comment"># 使用python来解析该脚本</span></span><br><span class="line">import sys</span><br><span class="line"><span class="keyword">for</span> arg <span class="keyword">in</span> reversed(sys.argv[1:]):</span><br><span class="line">    <span class="built_in">print</span>(arg)</span><br></pre></td></tr></table></figure>

<h4 id="查看命令"><a href="#查看命令" class="headerlink" title="查看命令"></a>查看命令</h4><ul>
<li><code>man -h</code>查看命令如何使用</li>
<li>使用<code>TLDR</code>，一个很好的替代品，<code>npm install -g tldr</code>全局安装</li>
</ul>
<h4 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h4><ul>
<li><code>find</code>工具</li>
<li><code>fd</code>更快更友好</li>
<li><code>locate</code>只能通过文件名来定位，且每天都会更新</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找所有名称为src的 文件夹:d</span></span><br><span class="line">find . -name src -<span class="built_in">type</span> d</span><br><span class="line"><span class="comment"># 查找所有文件夹路径中包含test的python 文件:f</span></span><br><span class="line">find . -path <span class="string">&#x27;**/test/**/*.py&#x27;</span> -<span class="built_in">type</span> f</span><br><span class="line"><span class="comment"># 查找前一天修改的所有文件</span></span><br><span class="line">find . -mtime -1</span><br><span class="line"><span class="comment"># 查找所有大小在500k至10M的tar.gz文件</span></span><br><span class="line">find . -size +500k -size -10M -name <span class="string">&#x27;*.tar.gz&#x27;</span></span><br><span class="line"><span class="comment"># Delete all files with .tmp extension</span></span><br><span class="line">find . -name <span class="string">&#x27;*.tmp&#x27;</span> -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br><span class="line"><span class="comment"># Find all PNG files and convert them to JPG</span></span><br><span class="line">find . -name <span class="string">&#x27;*.png&#x27;</span> -<span class="built_in">exec</span> convert &#123;&#125; &#123;&#125;.jpg \;</span><br></pre></td></tr></table></figure>

<h4 id="查找代码"><a href="#查找代码" class="headerlink" title="查找代码"></a>查找代码</h4><ul>
<li><code>grep</code>对输入文本进行匹配的通用工具, <code>ack</code>, <code>ag</code>等</li>
<li><code>rg</code>，ripgrep速度快，符合直觉</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查找所有使用了 requests 库的文件</span></span><br><span class="line">rg -t py <span class="string">&#x27;import requests&#x27;</span></span><br><span class="line"><span class="comment"># 查找所有没有写 shebang 的文件（包含隐藏文件）</span></span><br><span class="line">rg -u --files-without-match <span class="string">&quot;^#!&quot;</span></span><br><span class="line"><span class="comment"># 查找所有的foo字符串，并打印其之后的5行</span></span><br><span class="line">rg foo -A 5</span><br><span class="line"><span class="comment"># 打印匹配的统计信息（匹配的行和文件的数量）</span></span><br><span class="line">rg --stats PATTERN</span><br></pre></td></tr></table></figure>

<h4 id="查找shell命令"><a href="#查找shell命令" class="headerlink" title="查找shell命令"></a>查找shell命令</h4><ul>
<li><code>history</code>访问shell中输入的历史命令, <code>history | grep find</code> 会打印包含find子串的命令</li>
<li><code>Ctrl+R</code>命令历史记录进行回溯搜索，可以配合<code>fzf</code>使用，<code>fzf</code> 是一个通用对模糊查找工具</li>
<li>输入命令时，如果您在命令的开头加上一个空格，它就不会被加进shell记录中</li>
<li>bash_history或 .zhistory 来手动地从历史记录中移除</li>
</ul>
<h4 id="文件内导航"><a href="#文件内导航" class="headerlink" title="文件内导航"></a>文件内导航</h4><ul>
<li><code>fasd</code>可以查找最常用和/或最近使用的文件和目录。基于 <code>frecency</code> 对文件和文件排序，也就是说它会同时针对频率（frequency ）和时效（ recency）进行排序</li>
<li>概览目录结构： <code>tree</code>, <code>broot</code></li>
<li>文件管理器： <code>nnn</code>, <code>ranger</code></li>
</ul>
<h4 id="课后练习"><a href="#课后练习" class="headerlink" title="课后练习"></a>课后练习</h4><ul>
<li>第一题：<code>ls -AGulht</code></li>
<li>第二题：<a href="https://github.com/MillyTang/missing-semester/tree/main/second/macro.bash">macro.bash</a>; <a href="https://github.com/MillyTang/missing-semester/tree/main/second/polo.bash">polo.bash</a></li>
<li>第三题：<a href="https://github.com/MillyTang/missing-semester/tree/main/second/check_run.bash">check_run</a></li>
<li>第四题：<code>find . -name &#39;*.html&#39; | xargs -0 zip -r output.zip</code> 注意文件名不要相同，否则zip会抛错停止</li>
<li>第五题： <code>find . ctime 10</code></li>
</ul>
<h4 id="其他练习-amp-常用命令"><a href="#其他练习-amp-常用命令" class="headerlink" title="其他练习&amp;常用命令"></a>其他练习&amp;常用命令</h4><p>ssh本地上传包文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 压缩dist文件夹</span></span><br><span class="line">zip -r dist.zip dist</span><br><span class="line">scp dist.zip username@hostname:/path/<span class="keyword">in</span>/dir/</span><br><span class="line">username@hostname<span class="string">&#x27;&quot;s&#x27;</span> password:</span><br><span class="line"><span class="comment"># 登录服务器查看文件是否上传成功</span></span><br><span class="line">ssh username@hostname</span><br><span class="line">username@hostname<span class="string">&#x27;&quot;s&#x27;</span> password:</span><br><span class="line"><span class="built_in">cd</span> /path/<span class="keyword">in</span>/dir/</span><br><span class="line"><span class="comment"># 查看文件详细信息</span></span><br><span class="line">ll</span><br><span class="line"><span class="comment"># 解压上传的dist.zip</span></span><br><span class="line">unzip dist.zip</span><br><span class="line">mv old-dir save-old-dir</span><br><span class="line">mv dist old-dir</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://github.com/MillyTang/MillyTang.github.io/2020/11/03/sad-punk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="主体-客体联合创作">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Comfortably Numb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/03/sad-punk/" class="post-title-link" itemprop="url">The Adventure of DaiYing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-03 18:38:08" itemprop="dateCreated datePublished" datetime="2020-11-03T18:38:08+08:00">2020-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-09-07 13:21:20" itemprop="dateModified" datetime="2021-09-07T13:21:20+08:00">2021-09-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>施工🚧中，敬请期待</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">主体-客体联合创作</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">主体-客体联合创作</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
